<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>deps/curse/forms.zig - source view</title>
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAgklEQVR4AWMYWuD7EllJIM4G4g4g5oIJ/odhOJ8wToOxSTXgNxDHoeiBMfA4+wGShjyYOCkG/IGqWQziEzYAoUAeiF9D5U+DxEg14DRU7jWIT5IBIOdCxf+A+CQZAAoopEB7QJwBCBwHiip8UYmRdrAlDpIMgApwQZNnNii5Dq0MBgCxxycBnwEd+wAAAABJRU5ErkJggg=="/>
    <style>
      body{
        font-family: system-ui, -apple-system, Roboto, "Segoe UI", sans-serif;
        margin: 0;
        line-height: 1.5;
      }

      pre > code {
        display: block;
        overflow: auto;
        line-height: normal;
        margin: 0em;
      }
      .tok-kw {
          color: #333;
          font-weight: bold;
      }
      .tok-str {
          color: #d14;
      }
      .tok-builtin {
          color: #005C7A;
      }
      .tok-comment {
          color: #545454;
          font-style: italic;
      }
      .tok-fn {
          color: #900;
          font-weight: bold;
      }
      .tok-null {
          color: #005C5C;
      }
      .tok-number {
          color: #005C5C;
      }
      .tok-type {
          color: #458;
          font-weight: bold;
      }
      pre {
        counter-reset: line;
      }
      pre .line:before {
        counter-increment: line;
        content: counter(line);
        display: inline-block;
        padding-right: 1em;
        width: 2em;
        text-align: right;
        color: #999;
      }
      
      .line {
        width: 100%;
        display: inline-block;
      }
      .line:target {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        background: #fafafa;
      }

      @media (prefers-color-scheme: dark) {
        body{
            background:#222;
            color: #ccc;
        }
        pre > code {
            color: #ccc;
            background: #222;
            border: unset;
        }
        .line:target {
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            background: #333;
        }
        .tok-kw {
            color: #eee;
        }
        .tok-str {
            color: #2e5;
        }
        .tok-builtin {
            color: #ff894c;
        }
        .tok-comment {
            color: #aa7;
        }
        .tok-fn {
            color: #B1A0F8;
        }
        .tok-null {
            color: #ff8080;
        }
        .tok-number {
            color: #ff8080;
        }
        .tok-type {
            color: #68f;
        }
      }
    </style>
</head>
<body>
<pre><code><span class="line" id="L1"><span class="tok-kw">const</span> std = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>);</span>
<span class="line" id="L2"><span class="tok-kw">const</span> utf = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;std&quot;</span>).unicode;</span>
<span class="line" id="L3"></span>
<span class="line" id="L4"><span class="tok-kw">const</span> dds = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;dds&quot;</span>);</span>
<span class="line" id="L5"><span class="tok-kw">const</span> kbd = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;cursed&quot;</span>).kbd;</span>
<span class="line" id="L6"><span class="tok-kw">const</span> term= <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;cursed&quot;</span>);</span>
<span class="line" id="L7"><span class="tok-kw">const</span> utl = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;utils&quot;</span>);</span>
<span class="line" id="L8"><span class="tok-kw">const</span> reg = <span class="tok-builtin">@import</span>(<span class="tok-str">&quot;match&quot;</span>);</span>
<span class="line" id="L9"></span>
<span class="line" id="L10"><span class="tok-kw">const</span> os = std.os;</span>
<span class="line" id="L11"><span class="tok-kw">const</span> io = std.io;</span>
<span class="line" id="L12"></span>
<span class="line" id="L13"><span class="tok-comment">///-------------------------------</span></span>
<span class="line" id="L14"><span class="tok-comment">/// FORMS</span></span>
<span class="line" id="L15"><span class="tok-comment">///-------------------------------</span></span>
<span class="line" id="L16"></span>
<span class="line" id="L17"><span class="tok-kw">const</span> allocator = std.heap.page_allocator;</span>
<span class="line" id="L18"></span>
<span class="line" id="L19"><span class="tok-comment">// function special for developpeur</span>
</span>
<span class="line" id="L20"><span class="tok-kw">fn</span> <span class="tok-fn">mydebeug</span>(vline : <span class="tok-type">usize</span>, buf: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L21">  <span class="tok-kw">const</span> AtrDebug : dds.ZONATRB = .{</span>
<span class="line" id="L22">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L23">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L24">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L25">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L26">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L27">      .foregr = dds.ForegroundColor.fgYellow,</span>
<span class="line" id="L28">  };</span>
<span class="line" id="L29">  term.getCursor();</span>
<span class="line" id="L30">  term.gotoXY(<span class="tok-number">39</span>,<span class="tok-number">1</span>);</span>
<span class="line" id="L31">  <span class="tok-kw">var</span> msg =std.fmt.allocPrint(allocator,<span class="tok-str">&quot;linsrc:{d}  {s} &quot;</span>,.{vline, buf}) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L32">  term.writeStyled(msg,AtrDebug);</span>
<span class="line" id="L33">  _=term.kbd.getKEY();</span>
<span class="line" id="L34">  term.gotoXY(term.posCurs.x,term.posCurs.y);</span>
<span class="line" id="L35">            </span>
<span class="line" id="L36">}</span>
<span class="line" id="L37"></span>
<span class="line" id="L38"></span>
<span class="line" id="L39"></span>
<span class="line" id="L40"></span>
<span class="line" id="L41"><span class="tok-comment">// function special for developpeur</span>
</span>
<span class="line" id="L42"><span class="tok-comment">// activat fld.myMouse = true</span>
</span>
<span class="line" id="L43"><span class="tok-comment">// read ioField -&gt; getKEY()</span>
</span>
<span class="line" id="L44"><span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">mMouseXY</span>(vpnl : *pnl.PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L45">  <span class="tok-kw">const</span> AtrDebug : dds.ZONATRB = .{</span>
<span class="line" id="L46">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L47">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L48">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L49">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L50">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L51">      .foregr = dds.ForegroundColor.fgRed,</span>
<span class="line" id="L52">  };</span>
<span class="line" id="L53"></span>
<span class="line" id="L54"></span>
<span class="line" id="L55">  <span class="tok-kw">var</span> msg =std.fmt.allocPrint(allocator,<span class="tok-str">&quot;{d:0&gt;2}/{d:0&gt;3}&quot;</span>,.{term.MouseInfo.x,term.MouseInfo.y}) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L56">  term.gotoXY(vpnl.posx + vpnl.lines - <span class="tok-number">1</span>  , (vpnl.posy + vpnl.cols - <span class="tok-number">1</span>) - <span class="tok-number">7</span>);</span>
<span class="line" id="L57">  term.writeStyled(msg,AtrDebug);</span>
<span class="line" id="L58">  term.gotoXY(term.posCurs.x,term.posCurs.y);          </span>
<span class="line" id="L59">}</span>
<span class="line" id="L60"></span>
<span class="line" id="L61"></span>
<span class="line" id="L62"><span class="tok-comment">/// Errors that may occur when using String</span></span>
<span class="line" id="L63"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> ErrForms = <span class="tok-kw">error</span>{</span>
<span class="line" id="L64">        Invalide_append,</span>
<span class="line" id="L65">        Invalide_Panel,</span>
<span class="line" id="L66">        Invalide_Menu,</span>
<span class="line" id="L67">        Invalide_Grid,</span>
<span class="line" id="L68">        Invalide_Grid_Buf,</span>
<span class="line" id="L69">        grd_dltRows_Index_invalide,</span>
<span class="line" id="L70"></span>
<span class="line" id="L71">        lbl_getIndex_Name_Label_Invalide,</span>
<span class="line" id="L72">        lbl_getName_Index_invalide,</span>
<span class="line" id="L73">        lbl_getPosx_Index_invalide,</span>
<span class="line" id="L74">        lbl_getPosy_Index_invalide,</span>
<span class="line" id="L75">        lbl_getText_Index_invalide,</span>
<span class="line" id="L76">        lbl_getActif_Index_invalide,</span>
<span class="line" id="L77"> </span>
<span class="line" id="L78">        lbl_setText_Index_invalide,</span>
<span class="line" id="L79">        lbl_setActif_Index_invalide,</span>
<span class="line" id="L80">        lbl_updateText_Index_invalide,</span>
<span class="line" id="L81"></span>
<span class="line" id="L82">        lbl_dltRows_Index_invalide,</span>
<span class="line" id="L83"></span>
<span class="line" id="L84">        btn_getIndex_Key_Button_Invalide,</span>
<span class="line" id="L85">        btn_getName_Index_invalide,</span>
<span class="line" id="L86">        btn_getKey_Index_invalide,</span>
<span class="line" id="L87">        btn_getShow_Index_invalide,</span>
<span class="line" id="L88">        btn_getText_Index_invalide,</span>
<span class="line" id="L89">        btn_getCheck_Index_invalide,</span>
<span class="line" id="L90">        btn_getActif_Index_invalide,</span>
<span class="line" id="L91"></span>
<span class="line" id="L92">        btn_setShow_Index_invalide,</span>
<span class="line" id="L93">        btn_setText_Index_invalide,</span>
<span class="line" id="L94">        btn_setCheck_Index_invalide,  </span>
<span class="line" id="L95">        btn_setActif_Index_invalide,</span>
<span class="line" id="L96"></span>
<span class="line" id="L97"></span>
<span class="line" id="L98">        btn_dltRows_Index_invalide,</span>
<span class="line" id="L99"></span>
<span class="line" id="L100">        mnu_getIndex_Name_Menu_Invalide,</span>
<span class="line" id="L101">        mnu_getName_Index_invalide,</span>
<span class="line" id="L102">        mnu_getPosx_Index_invalide,</span>
<span class="line" id="L103">        mnu_getPosy_Index_invalide,</span>
<span class="line" id="L104">        mnu_getText_Index_invalide,</span>
<span class="line" id="L105">        mnu_getActif_Index_invalide,</span>
<span class="line" id="L106"></span>
<span class="line" id="L107">        mnu_dltRows_Index_invalide,</span>
<span class="line" id="L108"></span>
<span class="line" id="L109"></span>
<span class="line" id="L110">        fld_getIndex_Name_Field_Invalide,</span>
<span class="line" id="L111">        fld_getName_Index_invalide,</span>
<span class="line" id="L112">        fld_getPosx_Index_invalide,</span>
<span class="line" id="L113">        fld_getPosy_Index_invalide,</span>
<span class="line" id="L114">        fld_getRefType_Index_invalide,</span>
<span class="line" id="L115">        fld_getWidth_Index_invalide,</span>
<span class="line" id="L116">        fld_getScal_Index_invalide,</span>
<span class="line" id="L117">        fld_getNbrCar_Index_invalide,</span>
<span class="line" id="L118">        fld_gettofill_Index_invalide,</span>
<span class="line" id="L119">        fld_getProtect_Index_invalide,</span>
<span class="line" id="L120">        fld_getPading_Index_invalide,</span>
<span class="line" id="L121">        fld_getEdtcar_Index_invalide,</span>
<span class="line" id="L122">        fld_getRegex_Index_invalide,</span>
<span class="line" id="L123">        fld_getErrMsg_Index_invalide,</span>
<span class="line" id="L124">        fld_getHelp_Index_invalide,</span>
<span class="line" id="L125">        fld_getText_Index_invalide,</span>
<span class="line" id="L126">        fld_getSwitch_Index_invalide,</span>
<span class="line" id="L127">        fld_getErr_Index_invalide,</span>
<span class="line" id="L128">        fld_getFunc_Index_invalide,</span>
<span class="line" id="L129">        fld_getTask_Index_invalide,</span>
<span class="line" id="L130">        fld_getAttribut_Index_invalide,</span>
<span class="line" id="L131">        fld_getAtrProtect_Index_invalide,</span>
<span class="line" id="L132">        fld_getActif_Index_invalide,</span>
<span class="line" id="L133"></span>
<span class="line" id="L134">        fld_setText_Index_invalide,</span>
<span class="line" id="L135">        fld_setSwitch_Index_invalide,</span>
<span class="line" id="L136">        fld_setProtect_Index_invalide,</span>
<span class="line" id="L137">        fld_setEdtcar_Index_invalide,</span>
<span class="line" id="L138">        fld_setRegex_Index_invalide,</span>
<span class="line" id="L139">        fld_setActif_Index_invalide,</span>
<span class="line" id="L140"></span>
<span class="line" id="L141">        fld_dltRows_Index_invalide,</span>
<span class="line" id="L142"></span>
<span class="line" id="L143"></span>
<span class="line" id="L144">    };</span>
<span class="line" id="L145"></span>
<span class="line" id="L146"></span>
<span class="line" id="L147"><span class="tok-comment">// Shows serious programming errors</span>
</span>
<span class="line" id="L148"><span class="tok-kw">pub</span> <span class="tok-kw">const</span>  dsperr = <span class="tok-kw">struct</span> {    </span>
<span class="line" id="L149">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">errorForms</span>(errpgm :<span class="tok-type">anyerror</span> ) <span class="tok-type">void</span> { </span>
<span class="line" id="L150">    <span class="tok-comment">// define attribut default MSG Error</span>
</span>
<span class="line" id="L151">    <span class="tok-kw">const</span> MsgErr : dds.ZONATRB = .{</span>
<span class="line" id="L152">        .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleBlink),</span>
<span class="line" id="L153">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L154">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L155">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L156">        .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L157">        .foregr = dds.ForegroundColor.fgYellow,</span>
<span class="line" id="L158">    };</span>
<span class="line" id="L159">    <span class="tok-kw">const</span> xSize = term.getSize() <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L160">    <span class="tok-kw">var</span> msgerr:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;To report: {any} &quot;</span>,.{errpgm }) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>; </span>
<span class="line" id="L161">    <span class="tok-kw">var</span> x: <span class="tok-type">usize</span>  = xSize.height - <span class="tok-number">1</span> ;</span>
<span class="line" id="L162">    <span class="tok-kw">var</span> y: <span class="tok-type">usize</span>  = <span class="tok-number">2</span>; </span>
<span class="line" id="L163">    term.gotoXY( x , y    );</span>
<span class="line" id="L164">    term.writeStyled(msgerr,MsgErr);</span>
<span class="line" id="L165">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L166">      <span class="tok-kw">var</span> e_key = kbd.getKEY();</span>
<span class="line" id="L167">      <span class="tok-kw">switch</span> ( e_key.Key ) {</span>
<span class="line" id="L168">        .esc =&gt; <span class="tok-kw">break</span>,</span>
<span class="line" id="L169">      <span class="tok-kw">else</span> =&gt;  {},</span>
<span class="line" id="L170">      }</span>
<span class="line" id="L171">    } </span>
<span class="line" id="L172">  }</span>
<span class="line" id="L173">};</span>
<span class="line" id="L174"></span>
<span class="line" id="L175"></span>
<span class="line" id="L176"><span class="tok-comment">// buffer terminal MATRIX</span>
</span>
<span class="line" id="L177"><span class="tok-kw">const</span> TERMINAL_CHAR = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L178">  ch :   [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L179">  attribut:dds.ZONATRB,</span>
<span class="line" id="L180">  on:<span class="tok-type">bool</span></span>
<span class="line" id="L181">};</span>
<span class="line" id="L182"></span>
<span class="line" id="L183"></span>
<span class="line" id="L184"><span class="tok-comment">// defined Label</span>
</span>
<span class="line" id="L185"><span class="tok-kw">pub</span> <span class="tok-kw">const</span>  lbl = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L186"></span>
<span class="line" id="L187">  <span class="tok-comment">// define attribut default LABEL</span>
</span>
<span class="line" id="L188">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrLabel : dds.ZONATRB = .{</span>
<span class="line" id="L189">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L190">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.styleItalic),</span>
<span class="line" id="L191">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L192">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L193">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L194">      .foregr = dds.ForegroundColor.fgGreen,</span>
<span class="line" id="L195">  };</span>
<span class="line" id="L196"></span>
<span class="line" id="L197">  <span class="tok-comment">// define attribut default TITLE</span>
</span>
<span class="line" id="L198">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrTitle : dds.ZONATRB = .{</span>
<span class="line" id="L199">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleBold),</span>
<span class="line" id="L200">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L201">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L202">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L203">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L204">      .foregr = dds.ForegroundColor.fgGreen,</span>
<span class="line" id="L205">  };</span>
<span class="line" id="L206"></span>
<span class="line" id="L207">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LABEL = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L208">    name :  []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L209">    posx:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L210">    posy:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L211">    attribut:dds.ZONATRB,</span>
<span class="line" id="L212">    text:   []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L213">    title:  <span class="tok-type">bool</span>,</span>
<span class="line" id="L214">    actif:  <span class="tok-type">bool</span></span>
<span class="line" id="L215">    };</span>
<span class="line" id="L216"></span>
<span class="line" id="L217"></span>
<span class="line" id="L218">  <span class="tok-comment">// New LABEL</span>
</span>
<span class="line" id="L219">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newLabel</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>, vposx:<span class="tok-type">usize</span>, vposy:<span class="tok-type">usize</span>,</span>
<span class="line" id="L220">              vtext: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) LABEL {</span>
<span class="line" id="L221"></span>
<span class="line" id="L222">        <span class="tok-kw">const</span> xlabel = LABEL {</span>
<span class="line" id="L223">            .name = vname,</span>
<span class="line" id="L224">            .posx = vposx ,</span>
<span class="line" id="L225">            .posy = vposy,</span>
<span class="line" id="L226">            .attribut = AtrLabel,</span>
<span class="line" id="L227">            .text = vtext,</span>
<span class="line" id="L228">            .title = <span class="tok-null">true</span>,</span>
<span class="line" id="L229">            .actif = <span class="tok-null">true</span>,</span>
<span class="line" id="L230">        };</span>
<span class="line" id="L231"></span>
<span class="line" id="L232">        <span class="tok-kw">return</span> xlabel;</span>
<span class="line" id="L233">  }</span>
<span class="line" id="L234"></span>
<span class="line" id="L235"></span>
<span class="line" id="L236">  <span class="tok-comment">// New LABEL-TITLE</span>
</span>
<span class="line" id="L237">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newTitle</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>, vposx:<span class="tok-type">usize</span>, vposy:<span class="tok-type">usize</span>,</span>
<span class="line" id="L238">              vtext: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) LABEL {</span>
<span class="line" id="L239"></span>
<span class="line" id="L240">        <span class="tok-kw">const</span> xlabel = LABEL {</span>
<span class="line" id="L241">            .name = vname,</span>
<span class="line" id="L242">            .posx = vposx ,</span>
<span class="line" id="L243">            .posy = vposy,</span>
<span class="line" id="L244">            .attribut = AtrTitle,</span>
<span class="line" id="L245">            .text = vtext,</span>
<span class="line" id="L246">            .title = <span class="tok-null">true</span>,</span>
<span class="line" id="L247">            .actif = <span class="tok-null">true</span>,</span>
<span class="line" id="L248">        };</span>
<span class="line" id="L249"></span>
<span class="line" id="L250">        <span class="tok-kw">return</span> xlabel;</span>
<span class="line" id="L251">  }</span>
<span class="line" id="L252"></span>
<span class="line" id="L253"></span>
<span class="line" id="L254">  <span class="tok-comment">// return index-label  ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L255">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getIndex</span>(vpnl: *pnl.PANEL , name: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> )  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L256">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L257">    <span class="tok-kw">for</span> (vpnl.label.items) |l| {</span>
<span class="line" id="L258">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, l.name, name)) <span class="tok-kw">return</span> idx ;</span>
<span class="line" id="L259">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L260">    }</span>
<span class="line" id="L261">    <span class="tok-kw">return</span> ErrForms.lbl_getIndex_Name_Label_Invalide;</span>
<span class="line" id="L262">  }</span>
<span class="line" id="L263"></span>
<span class="line" id="L264">  <span class="tok-comment">// return name-label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L265">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getName</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L266">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len) <span class="tok-kw">return</span> vpnl.label.items[n].name;</span>
<span class="line" id="L267">    <span class="tok-kw">return</span> ErrForms.lbl_getName_Index_invalide ;</span>
<span class="line" id="L268"></span>
<span class="line" id="L269">  }</span>
<span class="line" id="L270"></span>
<span class="line" id="L271">  <span class="tok-comment">// return posx-label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L272">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosx</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L273">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len) <span class="tok-kw">return</span> vpnl.label.items[n].posx;</span>
<span class="line" id="L274">    <span class="tok-kw">return</span> ErrForms.lbl_getPosx_Index_invalide ;</span>
<span class="line" id="L275">  }</span>
<span class="line" id="L276"></span>
<span class="line" id="L277">  <span class="tok-comment">// return posy-label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L278">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosy</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L279">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len) <span class="tok-kw">return</span> vpnl.label.items[n].posy;</span>
<span class="line" id="L280">    <span class="tok-kw">return</span> ErrForms.lbl_getPosy_Index_invalide ;</span>
<span class="line" id="L281">  }</span>
<span class="line" id="L282"></span>
<span class="line" id="L283">  <span class="tok-comment">// return Text-label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L284">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getText</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L285">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len) <span class="tok-kw">return</span> vpnl.label.items[n].text;</span>
<span class="line" id="L286">    <span class="tok-kw">return</span> ErrForms.lbl_getText_Index_invalide ;</span>
<span class="line" id="L287">  }</span>
<span class="line" id="L288"></span>
<span class="line" id="L289">  <span class="tok-comment">// return ON/OFF-label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L290">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getActif</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L291">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len) <span class="tok-kw">return</span> vpnl.label.items[n].actif;</span>
<span class="line" id="L292">    <span class="tok-kw">return</span> ErrForms.lbl_getActif_Index_invalide ;</span>
<span class="line" id="L293">  }</span>
<span class="line" id="L294"></span>
<span class="line" id="L295">  <span class="tok-comment">// Set TEXT -label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L296">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setText</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val:[] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L297">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len)  vpnl.label.items[n].text = val</span>
<span class="line" id="L298">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.lbl_setText_Index_invalide;</span>
<span class="line" id="L299">  }</span>
<span class="line" id="L300"></span>
<span class="line" id="L301">  <span class="tok-comment">// Set ON/OFF -label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L302">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setActif</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :<span class="tok-type">bool</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L303">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len) vpnl.label.items[n].actif = val</span>
<span class="line" id="L304">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.lbl_setActif_Index_invalide;</span>
<span class="line" id="L305">  }</span>
<span class="line" id="L306"></span>
<span class="line" id="L307">  <span class="tok-comment">// delete -label ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L308">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">dltRows</span>(vpnl: *pnl.PANEL,  n :<span class="tok-type">usize</span> ) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L309">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len)  _= vpnl.label.orderedRemove(n)</span>
<span class="line" id="L310">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.lbl_dltRows_Index_invalide;</span>
<span class="line" id="L311">  }</span>
<span class="line" id="L312"></span>
<span class="line" id="L313">  <span class="tok-comment">// update Label and Display  ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L314">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">updateText</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val:[] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L315">    <span class="tok-kw">if</span> ( n &lt; vpnl.label.items.len) {</span>
<span class="line" id="L316">      clsLabel(vpnl, vpnl.label.items[n]);</span>
<span class="line" id="L317">      vpnl.label.items[n].text = val;</span>
<span class="line" id="L318">      printLabel(vpnl, vpnl.label.items[n]);</span>
<span class="line" id="L319">      displayLabel(vpnl, vpnl.label.items[n]);</span>
<span class="line" id="L320">    } <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.lbl_updateText_Index_invalide;</span>
<span class="line" id="L321">  }</span>
<span class="line" id="L322"></span>
<span class="line" id="L323">  <span class="tok-comment">// assign -label MATRIX TERMINAL  ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L324">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printLabel</span>(vpnl: *pnl.PANEL, vlbl : LABEL ) <span class="tok-type">void</span> {</span>
<span class="line" id="L325">    <span class="tok-kw">var</span> n  = (vpnl.cols * (vlbl.posx - <span class="tok-number">1</span>)) + vlbl.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L326">    <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(vlbl.text);</span>
<span class="line" id="L327">    <span class="tok-kw">while</span> (iter.next()) |ch| {</span>
<span class="line" id="L328">      <span class="tok-kw">if</span> (vlbl.actif == <span class="tok-null">true</span>) {</span>
<span class="line" id="L329">        vpnl.buf.items[n].ch = ch ;</span>
<span class="line" id="L330">        vpnl.buf.items[n].attribut = vlbl.attribut;</span>
<span class="line" id="L331">        vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L332">      }</span>
<span class="line" id="L333">      <span class="tok-kw">else</span> {</span>
<span class="line" id="L334">        vpnl.buf.items[n].ch = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L335">        vpnl.buf.items[n].attribut  = vpnl.attribut;</span>
<span class="line" id="L336">        vpnl.buf.items[n].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L337">      }</span>
<span class="line" id="L338">      n += <span class="tok-number">1</span>;</span>
<span class="line" id="L339">    }</span>
<span class="line" id="L340">  }</span>
<span class="line" id="L341"></span>
<span class="line" id="L342"></span>
<span class="line" id="L343">  <span class="tok-comment">// matrix cleaning from label</span>
</span>
<span class="line" id="L344">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">clsLabel</span>(vpnl: *pnl.PANEL, vlbl : LABEL )  <span class="tok-type">void</span> {</span>
<span class="line" id="L345">    <span class="tok-comment">// display matrice PANEL</span>
</span>
<span class="line" id="L346">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L347">    <span class="tok-kw">if</span> (vlbl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L348">      <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = vlbl.posx - <span class="tok-number">1</span>;</span>
<span class="line" id="L349">      <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = vlbl.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L350">      <span class="tok-kw">var</span> vlen = utl.nbrCharStr(vlbl.text);</span>
<span class="line" id="L351">      <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L352">      <span class="tok-kw">var</span> npos :<span class="tok-type">usize</span> = (vpnl.cols * (vlbl.posx - <span class="tok-number">1</span>)) + vlbl.posy - <span class="tok-number">1</span> ;</span>
<span class="line" id="L353">      <span class="tok-kw">while</span> (n &lt; vlen) : (n += <span class="tok-number">1</span>) {</span>
<span class="line" id="L354">        vpnl.buf.items[npos].ch = <span class="tok-str">&quot; &quot;</span>;</span>
<span class="line" id="L355">        vpnl.buf.items[npos].attribut  = vpnl.attribut;</span>
<span class="line" id="L356">        vpnl.buf.items[npos].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L357">        term.gotoXY(x + vpnl.posx   , y + vpnl.posy + n  );</span>
<span class="line" id="L358">        term.writeStyled(vpnl.buf.items[npos].ch,vpnl.buf.items[npos].attribut);</span>
<span class="line" id="L359">        npos += <span class="tok-number">1</span>;</span>
<span class="line" id="L360">      }</span>
<span class="line" id="L361">  }</span>
<span class="line" id="L362"></span>
<span class="line" id="L363"></span>
<span class="line" id="L364">  <span class="tok-comment">// display  MATRIX to terminal ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L365">  <span class="tok-kw">fn</span> <span class="tok-fn">displayLabel</span>(vpnl: *pnl.PANEL, vlbl : LABEL )  <span class="tok-type">void</span> {</span>
<span class="line" id="L366">    <span class="tok-comment">// display matrice PANEL</span>
</span>
<span class="line" id="L367">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L368">      <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = vlbl.posx - <span class="tok-number">1</span> ;</span>
<span class="line" id="L369">      <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = vlbl.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L370">      <span class="tok-kw">var</span> vlen = utl.nbrCharStr(vlbl.text);</span>
<span class="line" id="L371">      <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L372">      <span class="tok-kw">var</span> npos :<span class="tok-type">usize</span> = (vpnl.cols * vlbl.posx) + vlbl.posy - <span class="tok-number">1</span> ;</span>
<span class="line" id="L373">      <span class="tok-kw">while</span> (n &lt; vlen) : (n += <span class="tok-number">1</span>) {</span>
<span class="line" id="L374">        term.gotoXY(x + vpnl.posx   , y + vpnl.posy + n  );</span>
<span class="line" id="L375">        term.writeStyled(vpnl.buf.items[npos].ch,vpnl.buf.items[npos].attribut);</span>
<span class="line" id="L376">        npos += <span class="tok-number">1</span>;</span>
<span class="line" id="L377">      }</span>
<span class="line" id="L378">  }</span>
<span class="line" id="L379">};</span>
<span class="line" id="L380"></span>
<span class="line" id="L381"></span>
<span class="line" id="L382"><span class="tok-comment">// defined Trait and Frame for Panel</span>
</span>
<span class="line" id="L383"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> frm = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L384"></span>
<span class="line" id="L385">  <span class="tok-comment">// define attribut default FRAME</span>
</span>
<span class="line" id="L386">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrFrame : dds.ZONATRB = .{</span>
<span class="line" id="L387">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L388">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L389">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L390">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L391">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L392">      .foregr = dds.ForegroundColor.fgRed</span>
<span class="line" id="L393"></span>
<span class="line" id="L394">  };</span>
<span class="line" id="L395"></span>
<span class="line" id="L396">  <span class="tok-comment">// define attribut default TITLE FRAME</span>
</span>
<span class="line" id="L397">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrTitle : dds.ZONATRB = .{</span>
<span class="line" id="L398">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleBold),</span>
<span class="line" id="L399">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L400">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L401">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L402">      .backgr = dds.BackgroundColor.bgWhite,</span>
<span class="line" id="L403">      .foregr = dds.ForegroundColor.fgBlue</span>
<span class="line" id="L404">  };</span>
<span class="line" id="L405"></span>
<span class="line" id="L406"></span>
<span class="line" id="L407">  <span class="tok-comment">/// FRAME</span></span>
<span class="line" id="L408"></span>
<span class="line" id="L409">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> FRAME = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L410">    name :  []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L411">    posx:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L412">    posy:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L413">    lines:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L414">    cols:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L415">    cadre:  dds.CADRE,</span>
<span class="line" id="L416">    attribut:dds.ZONATRB,</span>
<span class="line" id="L417">    title:  []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L418">    titleAttribut: dds.ZONATRB,</span>
<span class="line" id="L419">    actif:  <span class="tok-type">bool</span></span>
<span class="line" id="L420">    };</span>
<span class="line" id="L421"></span>
<span class="line" id="L422">    <span class="tok-comment">// define Fram </span>
</span>
<span class="line" id="L423">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFrame</span>(vname:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L424">                    vposx:<span class="tok-type">usize</span>, vposy:<span class="tok-type">usize</span>,</span>
<span class="line" id="L425">                    vlines:<span class="tok-type">usize</span>,</span>
<span class="line" id="L426">                    vcols:<span class="tok-type">usize</span>,</span>
<span class="line" id="L427">                    vcadre:dds.CADRE,</span>
<span class="line" id="L428">                    vattribut:dds.ZONATRB,</span>
<span class="line" id="L429">                    vtitle:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L430">                    vtitleAttribut:dds.ZONATRB,</span>
<span class="line" id="L431">                    ) FRAME {</span>
<span class="line" id="L432"></span>
<span class="line" id="L433">          <span class="tok-kw">const</span> xframe = FRAME {</span>
<span class="line" id="L434">              .name = vname,</span>
<span class="line" id="L435">              .posx = vposx,</span>
<span class="line" id="L436">              .posy = vposy,</span>
<span class="line" id="L437">              .lines = vlines,</span>
<span class="line" id="L438">              .cols = vcols,</span>
<span class="line" id="L439">              .cadre = vcadre,</span>
<span class="line" id="L440">              .attribut = vattribut,</span>
<span class="line" id="L441">              .title = vtitle,</span>
<span class="line" id="L442">              .titleAttribut = vtitleAttribut,</span>
<span class="line" id="L443">              .actif = <span class="tok-null">true</span></span>
<span class="line" id="L444">          };</span>
<span class="line" id="L445">      <span class="tok-kw">return</span> xframe;</span>
<span class="line" id="L446"></span>
<span class="line" id="L447">    }</span>
<span class="line" id="L448"></span>
<span class="line" id="L449"></span>
<span class="line" id="L450">    <span class="tok-comment">// write MATRIX TERMINAL  ---&gt; arraylist panel-fram</span>
</span>
<span class="line" id="L451">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printFrame</span>(vpnl : *pnl.PANEL , vfram: FRAME) <span class="tok-type">void</span> {</span>
<span class="line" id="L452">      <span class="tok-comment">// assigne FRAME to init matrice for display</span>
</span>
<span class="line" id="L453">      <span class="tok-kw">if</span> (dds.CADRE.line0 == vfram.cadre ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L454"></span>
<span class="line" id="L455">      <span class="tok-kw">const</span> ACS_Hlines  = <span class="tok-str">&quot;─&quot;</span>;</span>
<span class="line" id="L456">      <span class="tok-kw">const</span> ACS_Vlines  = <span class="tok-str">&quot;│&quot;</span>;</span>
<span class="line" id="L457">      <span class="tok-kw">const</span> ACS_UCLEFT  = <span class="tok-str">&quot;┌&quot;</span>;</span>
<span class="line" id="L458">      <span class="tok-kw">const</span> ACS_UCRIGHT = <span class="tok-str">&quot;┐&quot;</span>;</span>
<span class="line" id="L459">      <span class="tok-kw">const</span> ACS_LCLEFT  = <span class="tok-str">&quot;└&quot;</span>;</span>
<span class="line" id="L460">      <span class="tok-kw">const</span> ACS_LCRIGHT = <span class="tok-str">&quot;┘&quot;</span>;</span>
<span class="line" id="L461"></span>
<span class="line" id="L462">      <span class="tok-kw">const</span> ACS_Hline2    = <span class="tok-str">&quot;═&quot;</span>;</span>
<span class="line" id="L463">      <span class="tok-kw">const</span> ACS_Vline2    = <span class="tok-str">&quot;║&quot;</span>;</span>
<span class="line" id="L464">      <span class="tok-kw">const</span> ACS_UCLEFT2   = <span class="tok-str">&quot;╔&quot;</span>;</span>
<span class="line" id="L465">      <span class="tok-kw">const</span> ACS_UCRIGHT2  = <span class="tok-str">&quot;╗&quot;</span>;</span>
<span class="line" id="L466">      <span class="tok-kw">const</span> ACS_LCLEFT2   = <span class="tok-str">&quot;╚&quot;</span>;</span>
<span class="line" id="L467">      <span class="tok-kw">const</span> ACS_LCRIGHT2  = <span class="tok-str">&quot;╝&quot;</span>;</span>
<span class="line" id="L468"></span>
<span class="line" id="L469">      <span class="tok-kw">var</span> trait: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L470">      <span class="tok-kw">var</span> edt :<span class="tok-type">bool</span>   = <span class="tok-null">undefined</span> ;</span>
<span class="line" id="L471"></span>
<span class="line" id="L472">      <span class="tok-kw">var</span> row:  <span class="tok-type">usize</span> = <span class="tok-number">1</span> ;</span>
<span class="line" id="L473">      <span class="tok-kw">var</span> y:    <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L474">      <span class="tok-kw">var</span> col:  <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L475">      <span class="tok-kw">var</span> npos: <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L476"></span>
<span class="line" id="L477">      <span class="tok-kw">var</span> wlen : <span class="tok-type">usize</span> = utl.nbrCharStr(vfram.title);</span>
<span class="line" id="L478"></span>
<span class="line" id="L479">      <span class="tok-kw">var</span> n:    <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L480">      <span class="tok-kw">var</span> x:<span class="tok-type">usize</span> = vfram.posx - <span class="tok-number">1</span> ;</span>
<span class="line" id="L481"></span>
<span class="line" id="L482">      <span class="tok-kw">while</span> (row &lt;= vfram.lines) {</span>
<span class="line" id="L483">        y = vfram.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L484">        col = <span class="tok-number">1</span>;</span>
<span class="line" id="L485">        <span class="tok-kw">while</span> ( col &lt;= vfram.cols ){</span>
<span class="line" id="L486">          edt = <span class="tok-null">false</span>;</span>
<span class="line" id="L487">          <span class="tok-kw">if</span> (row == <span class="tok-number">1</span>) {</span>
<span class="line" id="L488">              <span class="tok-kw">if</span> (col == <span class="tok-number">1</span>) {</span>
<span class="line" id="L489">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vfram.cadre ) {</span>
<span class="line" id="L490">                    trait = ACS_UCLEFT;</span>
<span class="line" id="L491">                } <span class="tok-kw">else</span>  trait = ACS_UCLEFT2 ;</span>
<span class="line" id="L492">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L493">              }</span>
<span class="line" id="L494">              <span class="tok-kw">if</span> ( col == vfram.cols ) {</span>
<span class="line" id="L495">                <span class="tok-kw">if</span> (dds.CADRE.line1 == vfram.cadre) {</span>
<span class="line" id="L496">                  trait = ACS_UCRIGHT;</span>
<span class="line" id="L497">                } <span class="tok-kw">else</span>  trait = ACS_UCRIGHT2 ;</span>
<span class="line" id="L498">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L499">              }</span>
<span class="line" id="L500">              <span class="tok-kw">if</span> ( col &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> col &lt; vfram.cols ) {</span>
<span class="line" id="L501">                <span class="tok-kw">if</span> (dds.CADRE.line1 == vfram.cadre ) {</span>
<span class="line" id="L502">                  trait = ACS_Hlines;</span>
<span class="line" id="L503">                } <span class="tok-kw">else</span>  trait = ACS_Hline2;</span>
<span class="line" id="L504">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L505">              }</span>
<span class="line" id="L506">          } <span class="tok-kw">else</span> <span class="tok-kw">if</span> ( row == vfram.lines ) {</span>
<span class="line" id="L507">              <span class="tok-kw">if</span> (col == <span class="tok-number">1</span>) {</span>
<span class="line" id="L508">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vfram.cadre ) {</span>
<span class="line" id="L509">                  trait = ACS_LCLEFT;</span>
<span class="line" id="L510">                } <span class="tok-kw">else</span>  trait = ACS_LCLEFT2;</span>
<span class="line" id="L511">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L512">              }</span>
<span class="line" id="L513">              <span class="tok-kw">if</span> ( col == vfram.cols ) {</span>
<span class="line" id="L514">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vfram.cadre ) {</span>
<span class="line" id="L515">                  trait = ACS_LCRIGHT;</span>
<span class="line" id="L516">                } <span class="tok-kw">else</span>  trait = ACS_LCRIGHT2 ;</span>
<span class="line" id="L517">                edt = <span class="tok-null">true</span> ;</span>
<span class="line" id="L518">              }</span>
<span class="line" id="L519">              <span class="tok-kw">if</span> ( col &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> col &lt; vfram.cols ) {</span>
<span class="line" id="L520">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vfram.cadre ) {</span>
<span class="line" id="L521">                  trait = ACS_Hlines;</span>
<span class="line" id="L522">                } <span class="tok-kw">else</span>  trait = ACS_Hline2 ;</span>
<span class="line" id="L523">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L524">              }</span>
<span class="line" id="L525">          } <span class="tok-kw">else</span> <span class="tok-kw">if</span> ( row &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> row &lt; vfram.lines ) {</span>
<span class="line" id="L526">            <span class="tok-kw">if</span> ( col == <span class="tok-number">1</span> <span class="tok-kw">or</span> col == vfram.cols ) {</span>
<span class="line" id="L527">              <span class="tok-kw">if</span> ( dds.CADRE.line1 == vfram.cadre ) {</span>
<span class="line" id="L528">                trait = ACS_Vlines;</span>
<span class="line" id="L529">              } <span class="tok-kw">else</span> trait = ACS_Vline2 ;</span>
<span class="line" id="L530">              edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L531">            }</span>
<span class="line" id="L532">          }</span>
<span class="line" id="L533">          <span class="tok-kw">if</span>  ( edt ) {</span>
<span class="line" id="L534">              npos =  vfram.cols * x;</span>
<span class="line" id="L535">              n =  npos  + y;</span>
<span class="line" id="L536">              vpnl.buf.items[n].ch = trait ;</span>
<span class="line" id="L537">              vpnl.buf.items[n].attribut = vfram.attribut;</span>
<span class="line" id="L538">              vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L539">          }</span>
<span class="line" id="L540"></span>
<span class="line" id="L541">          y += <span class="tok-number">1</span>;</span>
<span class="line" id="L542">          col += <span class="tok-number">1</span>;</span>
<span class="line" id="L543">        }</span>
<span class="line" id="L544">        x += <span class="tok-number">1</span>;</span>
<span class="line" id="L545">        row +=<span class="tok-number">1</span> ;</span>
<span class="line" id="L546">      }</span>
<span class="line" id="L547"></span>
<span class="line" id="L548">      <span class="tok-kw">if</span> (wlen &gt; vfram.cols - <span class="tok-number">2</span> <span class="tok-kw">or</span> wlen == <span class="tok-number">0</span> )  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L549">        npos = vfram.posx;</span>
<span class="line" id="L550">        n =  npos + (((vfram.cols - wlen ) / <span class="tok-number">2</span>)) - <span class="tok-number">1</span> ;</span>
<span class="line" id="L551">        <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(vfram.title);</span>
<span class="line" id="L552">        <span class="tok-kw">while</span> (iter.next()) |ch| {</span>
<span class="line" id="L553">          vpnl.buf.items[n].ch = ch ;</span>
<span class="line" id="L554">          vpnl.buf.items[n].attribut = vfram.titleAttribut;</span>
<span class="line" id="L555">          vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L556">          n +=<span class="tok-number">1</span>;</span>
<span class="line" id="L557">        }</span>
<span class="line" id="L558">    }</span>
<span class="line" id="L559"></span>
<span class="line" id="L560">};</span>
<span class="line" id="L561"></span>
<span class="line" id="L562"></span>
<span class="line" id="L563"></span>
<span class="line" id="L564"><span class="tok-comment">// defined Line and vertical for Panel</span>
</span>
<span class="line" id="L565"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> lnv = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L566"></span>
<span class="line" id="L567">  <span class="tok-comment">// define attribut default FRAME</span>
</span>
<span class="line" id="L568">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrLine : dds.ZONATRB = .{</span>
<span class="line" id="L569">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L570">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L571">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L572">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L573">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L574">      .foregr = dds.ForegroundColor.fgYellow</span>
<span class="line" id="L575"></span>
<span class="line" id="L576">  };</span>
<span class="line" id="L577"></span>
<span class="line" id="L578"></span>
<span class="line" id="L579"></span>
<span class="line" id="L580">  <span class="tok-comment">/// LINE VERTICAL</span></span>
<span class="line" id="L581"></span>
<span class="line" id="L582">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LINE = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L583">    name :  []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L584">    posx:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L585">    posy:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L586">    lines:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L587">    cadre:  dds.LINE,</span>
<span class="line" id="L588">    attribut:dds.ZONATRB,</span>
<span class="line" id="L589">    actif:  <span class="tok-type">bool</span></span>
<span class="line" id="L590">    };</span>
<span class="line" id="L591"></span>
<span class="line" id="L592">    <span class="tok-comment">// define Fram </span>
</span>
<span class="line" id="L593">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newLine</span>(vname:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L594">                    vposx:<span class="tok-type">usize</span>, vposy:<span class="tok-type">usize</span>,</span>
<span class="line" id="L595">                    vlines:<span class="tok-type">usize</span>,</span>
<span class="line" id="L596">                    vcadre:dds.LINE,</span>
<span class="line" id="L597">                    ) LINE {</span>
<span class="line" id="L598"></span>
<span class="line" id="L599">          <span class="tok-kw">const</span> xframe = LINE {</span>
<span class="line" id="L600">              .name = vname,</span>
<span class="line" id="L601">              .posx = vposx,</span>
<span class="line" id="L602">              .posy = vposy,</span>
<span class="line" id="L603">              .lines = vlines,</span>
<span class="line" id="L604">              .cadre = vcadre,</span>
<span class="line" id="L605">              .attribut = AtrLine,</span>
<span class="line" id="L606">              .actif = <span class="tok-null">true</span></span>
<span class="line" id="L607">          };</span>
<span class="line" id="L608">      <span class="tok-kw">return</span> xframe;</span>
<span class="line" id="L609"></span>
<span class="line" id="L610">    }</span>
<span class="line" id="L611"></span>
<span class="line" id="L612"></span>
<span class="line" id="L613">    <span class="tok-comment">// write MATRIX TERMINAL  ---&gt; arraylist panel-line</span>
</span>
<span class="line" id="L614">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printLine</span>(vpnl : *pnl.PANEL , vline: LINE) <span class="tok-type">void</span> {</span>
<span class="line" id="L615">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L616">    <span class="tok-kw">if</span> (vline.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L617"></span>
<span class="line" id="L618">      <span class="tok-comment">// assigne FRAMELINE VERTICAL</span>
</span>
<span class="line" id="L619"></span>
<span class="line" id="L620">      <span class="tok-kw">const</span> ACS_Vlines  = <span class="tok-str">&quot;│&quot;</span>;</span>
<span class="line" id="L621">      <span class="tok-kw">const</span> ACS_Vline2    = <span class="tok-str">&quot;║&quot;</span>;</span>
<span class="line" id="L622"></span>
<span class="line" id="L623">      <span class="tok-kw">var</span> row:  <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L624">      <span class="tok-kw">var</span> npos: <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L625"></span>
<span class="line" id="L626">      <span class="tok-kw">var</span> n: <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L627">      <span class="tok-kw">var</span> x: <span class="tok-type">usize</span> = vline.posx  ;</span>
<span class="line" id="L628"></span>
<span class="line" id="L629">      <span class="tok-kw">var</span> trait: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L630"></span>
<span class="line" id="L631">      <span class="tok-kw">while</span> (row &lt; vline.lines) {</span>
<span class="line" id="L632"></span>
<span class="line" id="L633"></span>
<span class="line" id="L634">        <span class="tok-kw">if</span> ( dds.LINE.line1 == vline.cadre ) {</span>
<span class="line" id="L635">          trait = ACS_Vlines;</span>
<span class="line" id="L636">        } <span class="tok-kw">else</span> trait = ACS_Vline2 ;</span>
<span class="line" id="L637">        npos =  vpnl.cols * x;</span>
<span class="line" id="L638">        n =  npos + vline.posy;</span>
<span class="line" id="L639">        vpnl.buf.items[n].ch = trait ;</span>
<span class="line" id="L640">        vpnl.buf.items[n].attribut = vline.attribut;</span>
<span class="line" id="L641">        vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L642">      </span>
<span class="line" id="L643">        row +=<span class="tok-number">1</span> ;</span>
<span class="line" id="L644">        x += <span class="tok-number">1</span>;</span>
<span class="line" id="L645">      }</span>
<span class="line" id="L646">    }</span>
<span class="line" id="L647"></span>
<span class="line" id="L648">};</span>
<span class="line" id="L649"></span>
<span class="line" id="L650"></span>
<span class="line" id="L651"><span class="tok-comment">// defined Line and vertical for Panel</span>
</span>
<span class="line" id="L652"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> lnh = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L653"></span>
<span class="line" id="L654">  <span class="tok-comment">// define attribut default FRAME</span>
</span>
<span class="line" id="L655">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrLine : dds.ZONATRB = .{</span>
<span class="line" id="L656">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L657">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L658">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L659">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L660">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L661">      .foregr = dds.ForegroundColor.fgYellow</span>
<span class="line" id="L662"></span>
<span class="line" id="L663">  };</span>
<span class="line" id="L664"></span>
<span class="line" id="L665"></span>
<span class="line" id="L666"></span>
<span class="line" id="L667">  <span class="tok-comment">/// LINE VERTICAL</span></span>
<span class="line" id="L668"></span>
<span class="line" id="L669">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> LINE = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L670">    name :  []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L671">    posx:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L672">    posy:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L673">    cols:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L674">    cadre:  dds.LINE,</span>
<span class="line" id="L675">    attribut:dds.ZONATRB,</span>
<span class="line" id="L676">    actif:  <span class="tok-type">bool</span></span>
<span class="line" id="L677">    };</span>
<span class="line" id="L678"></span>
<span class="line" id="L679">    <span class="tok-comment">// define Fram </span>
</span>
<span class="line" id="L680">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newLine</span>(vname:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L681">                    vposx:<span class="tok-type">usize</span>, vposy:<span class="tok-type">usize</span>,</span>
<span class="line" id="L682">                    vcols:<span class="tok-type">usize</span>,</span>
<span class="line" id="L683">                    vcadre:dds.LINE,</span>
<span class="line" id="L684">                    ) LINE {</span>
<span class="line" id="L685"></span>
<span class="line" id="L686">          <span class="tok-kw">const</span> xframe = LINE {</span>
<span class="line" id="L687">              .name = vname,</span>
<span class="line" id="L688">              .posx = vposx,</span>
<span class="line" id="L689">              .posy = vposy,</span>
<span class="line" id="L690">              .cols = vcols,</span>
<span class="line" id="L691">              .cadre = vcadre,</span>
<span class="line" id="L692">              .attribut = AtrLine,</span>
<span class="line" id="L693">              .actif = <span class="tok-null">true</span></span>
<span class="line" id="L694">          };</span>
<span class="line" id="L695">      <span class="tok-kw">return</span> xframe;</span>
<span class="line" id="L696"></span>
<span class="line" id="L697">    }</span>
<span class="line" id="L698"></span>
<span class="line" id="L699"></span>
<span class="line" id="L700">    <span class="tok-comment">// write MATRIX TERMINAL  ---&gt; arraylist panel-line</span>
</span>
<span class="line" id="L701">    <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printLine</span>(vpnl : *pnl.PANEL , vline: LINE) <span class="tok-type">void</span> {</span>
<span class="line" id="L702">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L703">    <span class="tok-kw">if</span> (vline.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L704">      <span class="tok-comment">// assigne FRAMELINE VERTICAL</span>
</span>
<span class="line" id="L705"></span>
<span class="line" id="L706">      <span class="tok-kw">const</span> ACS_Hlines  = <span class="tok-str">&quot;─&quot;</span>;</span>
<span class="line" id="L707">      <span class="tok-kw">const</span> ACS_Hline2  = <span class="tok-str">&quot;═&quot;</span>;</span>
<span class="line" id="L708"></span>
<span class="line" id="L709">      <span class="tok-kw">var</span> coln:  <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L710">      <span class="tok-kw">var</span> npos: <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L711"></span>
<span class="line" id="L712">      <span class="tok-kw">var</span> n: <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L713">      <span class="tok-kw">var</span> y: <span class="tok-type">usize</span> = vline.posy  ;</span>
<span class="line" id="L714"></span>
<span class="line" id="L715">      <span class="tok-kw">var</span> trait: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L716"></span>
<span class="line" id="L717">      npos =  vpnl.cols * vline.posx;</span>
<span class="line" id="L718"></span>
<span class="line" id="L719">      <span class="tok-kw">while</span> (coln &lt; vline.cols) {</span>
<span class="line" id="L720"></span>
<span class="line" id="L721"></span>
<span class="line" id="L722">        <span class="tok-kw">if</span> ( dds.LINE.line1 == vline.cadre ) {</span>
<span class="line" id="L723">          trait = ACS_Hlines;</span>
<span class="line" id="L724">        } <span class="tok-kw">else</span> trait = ACS_Hline2 ;</span>
<span class="line" id="L725"></span>
<span class="line" id="L726">        n =  npos + y;</span>
<span class="line" id="L727">        vpnl.buf.items[n].ch = trait ;</span>
<span class="line" id="L728">        vpnl.buf.items[n].attribut = vline.attribut;</span>
<span class="line" id="L729">        vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L730">      </span>
<span class="line" id="L731">        coln +=<span class="tok-number">1</span> ;</span>
<span class="line" id="L732">        y += <span class="tok-number">1</span>;</span>
<span class="line" id="L733">      }</span>
<span class="line" id="L734">    }</span>
<span class="line" id="L735"></span>
<span class="line" id="L736">};</span>
<span class="line" id="L737"></span>
<span class="line" id="L738"></span>
<span class="line" id="L739"></span>
<span class="line" id="L740"><span class="tok-comment">// defined button</span>
</span>
<span class="line" id="L741"><span class="tok-kw">pub</span> <span class="tok-kw">const</span> btn = <span class="tok-kw">struct</span>{</span>
<span class="line" id="L742"></span>
<span class="line" id="L743">  <span class="tok-comment">// nbr espace intercaler</span>
</span>
<span class="line" id="L744">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> btnspc : <span class="tok-type">usize</span> =<span class="tok-number">3</span> ;</span>
<span class="line" id="L745">  <span class="tok-comment">// define attribut default PANEL</span>
</span>
<span class="line" id="L746">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrButton : dds.ZONATRB = .{</span>
<span class="line" id="L747">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L748">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L749">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L750">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L751">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L752">      .foregr = dds.ForegroundColor.fgRed</span>
<span class="line" id="L753">  };</span>
<span class="line" id="L754">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrTitle : dds.ZONATRB = .{</span>
<span class="line" id="L755">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L756">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.styleItalic),</span>
<span class="line" id="L757">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.styleUnderscore),</span>
<span class="line" id="L758">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L759">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L760">      .foregr = dds.ForegroundColor.fgdCyan,</span>
<span class="line" id="L761">  };</span>
<span class="line" id="L762"></span>
<span class="line" id="L763"></span>
<span class="line" id="L764"></span>
<span class="line" id="L765">  <span class="tok-comment">// define BUTTON</span>
</span>
<span class="line" id="L766">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> BUTTON = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L767">    name: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L768">    key : kbd,</span>
<span class="line" id="L769">    show: <span class="tok-type">bool</span>,</span>
<span class="line" id="L770">    check: <span class="tok-type">bool</span>,</span>
<span class="line" id="L771">    title: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L772">    attribut:dds.ZONATRB,</span>
<span class="line" id="L773">    titleAttribut: dds.ZONATRB,</span>
<span class="line" id="L774">    actif: <span class="tok-type">bool</span>,</span>
<span class="line" id="L775">  };</span>
<span class="line" id="L776"></span>
<span class="line" id="L777">  <span class="tok-comment">// func BUTTON</span>
</span>
<span class="line" id="L778">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newButton</span>(</span>
<span class="line" id="L779">              vkey : kbd,</span>
<span class="line" id="L780">              vshow : <span class="tok-type">bool</span>,</span>
<span class="line" id="L781">              vcheck:<span class="tok-type">bool</span>,</span>
<span class="line" id="L782">              vtitle: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) BUTTON {</span>
<span class="line" id="L783"></span>
<span class="line" id="L784">        <span class="tok-kw">const</span> xbutton = BUTTON {</span>
<span class="line" id="L785">            .name = kbd.str(vkey),</span>
<span class="line" id="L786">            .key  = vkey,</span>
<span class="line" id="L787">            .show = vshow,</span>
<span class="line" id="L788">            .check = vcheck,</span>
<span class="line" id="L789">            .title = vtitle,</span>
<span class="line" id="L790">            .attribut = AtrButton,</span>
<span class="line" id="L791">            .titleAttribut = AtrTitle,</span>
<span class="line" id="L792">            .actif = <span class="tok-null">true</span></span>
<span class="line" id="L793">        };</span>
<span class="line" id="L794"></span>
<span class="line" id="L795">        <span class="tok-kw">return</span> xbutton;</span>
<span class="line" id="L796">  }</span>
<span class="line" id="L797"></span>
<span class="line" id="L798">  <span class="tok-comment">// return index-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L799">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getIndex</span>(vpnl: *pnl.PANEL , key: kbd  ) ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L800">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> =<span class="tok-number">0</span>;</span>
<span class="line" id="L801">    <span class="tok-kw">for</span> (vpnl.button.items) |b  | {</span>
<span class="line" id="L802">      <span class="tok-kw">if</span> (b.button.key == key) <span class="tok-kw">return</span> idx;</span>
<span class="line" id="L803">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L804">    }</span>
<span class="line" id="L805">    <span class="tok-kw">return</span> ErrForms.btn_getIndex_Key_Button_Invalide;</span>
<span class="line" id="L806">  }</span>
<span class="line" id="L807"></span>
<span class="line" id="L808">  <span class="tok-comment">// return name-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L809">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getName</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L810">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) <span class="tok-kw">return</span> vpnl.button.items[n].name;</span>
<span class="line" id="L811">    <span class="tok-kw">return</span> ErrForms.btn_getName_Index_invalide ;</span>
<span class="line" id="L812"></span>
<span class="line" id="L813">  }</span>
<span class="line" id="L814"></span>
<span class="line" id="L815">  <span class="tok-comment">// return key-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L816">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getKey</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! kbd {</span>
<span class="line" id="L817">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) <span class="tok-kw">return</span> vpnl.button.items[n].key;</span>
<span class="line" id="L818">    <span class="tok-kw">return</span> ErrForms.btn_getKey_Index_invalide ;</span>
<span class="line" id="L819"></span>
<span class="line" id="L820">  }</span>
<span class="line" id="L821"></span>
<span class="line" id="L822">  <span class="tok-comment">// return show-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L823">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getShow</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L824">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) <span class="tok-kw">return</span> vpnl.button.items[n].show;</span>
<span class="line" id="L825">    <span class="tok-kw">return</span> ErrForms.btn_getShow_Index_invalide ;</span>
<span class="line" id="L826">  }</span>
<span class="line" id="L827"></span>
<span class="line" id="L828">  <span class="tok-comment">// return text-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L829">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getTitle</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L830">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) <span class="tok-kw">return</span> vpnl.button.items[n].title;</span>
<span class="line" id="L831">    <span class="tok-kw">return</span> ErrForms.btn_getText_Index_invalide ;</span>
<span class="line" id="L832">  }</span>
<span class="line" id="L833"></span>
<span class="line" id="L834">  <span class="tok-comment">// return check-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L835">  <span class="tok-comment">// work for field input-field</span>
</span>
<span class="line" id="L836">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getCheck</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L837">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) <span class="tok-kw">return</span> vpnl.button.items[n].check;</span>
<span class="line" id="L838">    <span class="tok-kw">return</span> ErrForms.btn_getCheck_Index_invalide ;</span>
<span class="line" id="L839">  }</span>
<span class="line" id="L840"></span>
<span class="line" id="L841">  <span class="tok-comment">// return ON/OFF-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L842">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getActif</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L843">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) <span class="tok-kw">return</span> vpnl.button.items[n].actif;</span>
<span class="line" id="L844">    <span class="tok-kw">return</span> ErrForms.btn_getActif_Index_invalide ;</span>
<span class="line" id="L845">  }</span>
<span class="line" id="L846"></span>
<span class="line" id="L847">  <span class="tok-comment">// set show-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L848">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setShow</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :<span class="tok-type">bool</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L849">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len)  vpnl.button.items[n].show = val</span>
<span class="line" id="L850">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.btn_setShow_Index_invalide ;</span>
<span class="line" id="L851">  }</span>
<span class="line" id="L852"></span>
<span class="line" id="L853">  <span class="tok-comment">// set text-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L854">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setText</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val:[] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L855">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) vpnl.button.items[n].text = val</span>
<span class="line" id="L856">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.btn_setText_Index_invalide ;</span>
<span class="line" id="L857">  }</span>
<span class="line" id="L858"></span>
<span class="line" id="L859">  <span class="tok-comment">// set chek-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L860">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setCheck</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :<span class="tok-type">bool</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L861">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) vpnl.button.items[n].check = val</span>
<span class="line" id="L862">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.btn_setCheck_Index_invalide ;</span>
<span class="line" id="L863">  }</span>
<span class="line" id="L864"></span>
<span class="line" id="L865">  <span class="tok-comment">// set ON/OFF-button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L866">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setActif</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :<span class="tok-type">bool</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L867">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) vpnl.button.items[n].actif = val</span>
<span class="line" id="L868">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.btn_setActif_Index_invalide ;</span>
<span class="line" id="L869">  }</span>
<span class="line" id="L870"></span>
<span class="line" id="L871"></span>
<span class="line" id="L872"></span>
<span class="line" id="L873">  <span class="tok-comment">// delete -button  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L874">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">dltRows</span>(vpnl:*pnl.PANEL,  n :<span class="tok-type">usize</span> ) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L875">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) _= vpnl.button.orderedRemove(n)</span>
<span class="line" id="L876">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.btn_dltRows_Index_invalide ;</span>
<span class="line" id="L877">  }</span>
<span class="line" id="L878"></span>
<span class="line" id="L879"></span>
<span class="line" id="L880">  <span class="tok-comment">// assign -button MATRIX TERMINAL  ---&gt; arraylist panel-button</span>
</span>
<span class="line" id="L881">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printButton</span>(vpnl: *pnl.PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L882">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L883">    <span class="tok-kw">var</span> espace :<span class="tok-type">usize</span> = <span class="tok-number">3</span>;</span>
<span class="line" id="L884">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L885">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L886"></span>
<span class="line" id="L887">    <span class="tok-kw">if</span> (vpnl.frame.cadre == dds.CADRE.line0 ) {</span>
<span class="line" id="L888">      x = vpnl.lines - <span class="tok-number">1</span>;</span>
<span class="line" id="L889">      y = <span class="tok-number">1</span>;</span>
<span class="line" id="L890">    }</span>
<span class="line" id="L891">    <span class="tok-kw">else</span> {</span>
<span class="line" id="L892">      x = vpnl.lines - <span class="tok-number">2</span>;</span>
<span class="line" id="L893">      y = <span class="tok-number">2</span>;</span>
<span class="line" id="L894">    }</span>
<span class="line" id="L895"></span>
<span class="line" id="L896">    <span class="tok-kw">var</span> npos : <span class="tok-type">usize</span> = vpnl.cols * x ;</span>
<span class="line" id="L897">    <span class="tok-kw">var</span> n =  npos + y;</span>
<span class="line" id="L898"></span>
<span class="line" id="L899">    <span class="tok-kw">for</span> (vpnl.button.items) |button| {</span>
<span class="line" id="L900"></span>
<span class="line" id="L901">      <span class="tok-kw">if</span> (button.show == <span class="tok-null">true</span>) {</span>
<span class="line" id="L902"></span>
<span class="line" id="L903">        <span class="tok-comment">// text Function KEY</span>
</span>
<span class="line" id="L904">        <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(button.name);</span>
<span class="line" id="L905">        <span class="tok-kw">while</span> (iter.next()) |ch| {</span>
<span class="line" id="L906">          <span class="tok-kw">if</span> (button.actif == <span class="tok-null">true</span>) {</span>
<span class="line" id="L907">            vpnl.buf.items[n].ch = ch ;</span>
<span class="line" id="L908">            vpnl.buf.items[n].attribut = button.attribut;</span>
<span class="line" id="L909">            vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L910">          }</span>
<span class="line" id="L911">          <span class="tok-kw">else</span> {</span>
<span class="line" id="L912">            vpnl.buf.items[n].ch = <span class="tok-str">&quot; &quot;</span>;</span>
<span class="line" id="L913">            vpnl.buf.items[n].attribut  = vpnl.attribut;</span>
<span class="line" id="L914">            vpnl.buf.items[n].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L915">          }</span>
<span class="line" id="L916">          n += <span class="tok-number">1</span>;</span>
<span class="line" id="L917">        }</span>
<span class="line" id="L918">        n += <span class="tok-number">1</span>;</span>
<span class="line" id="L919"></span>
<span class="line" id="L920">        <span class="tok-comment">//text Title button</span>
</span>
<span class="line" id="L921">        iter = utl.iteratStr.iterator(button.title);</span>
<span class="line" id="L922">        <span class="tok-kw">while</span> (iter.next()) |ch| {</span>
<span class="line" id="L923">          <span class="tok-kw">if</span> (button.actif == <span class="tok-null">true</span>) {</span>
<span class="line" id="L924">            vpnl.buf.items[n].ch = ch ;</span>
<span class="line" id="L925">            vpnl.buf.items[n].attribut = button.titleAttribut;</span>
<span class="line" id="L926">            vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L927">          }</span>
<span class="line" id="L928">          <span class="tok-kw">else</span> {</span>
<span class="line" id="L929">            vpnl.buf.items[n].ch = <span class="tok-str">&quot; &quot;</span>;</span>
<span class="line" id="L930">            vpnl.buf.items[n].attribut  = vpnl.attribut;</span>
<span class="line" id="L931">            vpnl.buf.items[n].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L932">          }</span>
<span class="line" id="L933">          n += <span class="tok-number">1</span>;</span>
<span class="line" id="L934">        }</span>
<span class="line" id="L935">        n += espace;</span>
<span class="line" id="L936">      }</span>
<span class="line" id="L937">    }</span>
<span class="line" id="L938">  }</span>
<span class="line" id="L939"></span>
<span class="line" id="L940">};</span>
<span class="line" id="L941"></span>
<span class="line" id="L942"></span>
<span class="line" id="L943"><span class="tok-comment">// defined Menu</span>
</span>
<span class="line" id="L944"><span class="tok-kw">pub</span> <span class="tok-kw">const</span>  mnu = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L945"></span>
<span class="line" id="L946">  <span class="tok-comment">// nbr espace intercaler</span>
</span>
<span class="line" id="L947">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span>  mnuspc : <span class="tok-type">usize</span> =<span class="tok-number">3</span> ;</span>
<span class="line" id="L948"></span>
<span class="line" id="L949">  <span class="tok-comment">// define attribut default CADRE</span>
</span>
<span class="line" id="L950">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrMnu : dds.ZONATRB = .{</span>
<span class="line" id="L951">    .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L952">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L953">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L954">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L955">    .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L956">    .foregr = dds.ForegroundColor.fgRed</span>
<span class="line" id="L957"></span>
<span class="line" id="L958">  };</span>
<span class="line" id="L959"></span>
<span class="line" id="L960">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrBar : dds.ZONATRB = .{</span>
<span class="line" id="L961">    .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleReverse),</span>
<span class="line" id="L962">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.styleItalic),</span>
<span class="line" id="L963">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L964">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L965">    .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L966">    .foregr = dds.ForegroundColor.fgWhite</span>
<span class="line" id="L967"></span>
<span class="line" id="L968">  };</span>
<span class="line" id="L969"></span>
<span class="line" id="L970">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrCell : dds.ZONATRB= .{</span>
<span class="line" id="L971">    .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleItalic),</span>
<span class="line" id="L972">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L973">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L974">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L975">    .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L976">    .foregr = dds.ForegroundColor.fgWhite,</span>
<span class="line" id="L977">  };</span>
<span class="line" id="L978"></span>
<span class="line" id="L979">  <span class="tok-comment">// define MENU</span>
</span>
<span class="line" id="L980">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> MENU = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L981"></span>
<span class="line" id="L982">    name : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L983">    posx : <span class="tok-type">usize</span>,</span>
<span class="line" id="L984">    posy : <span class="tok-type">usize</span>,</span>
<span class="line" id="L985">    lines: <span class="tok-type">usize</span>,</span>
<span class="line" id="L986">    cols : <span class="tok-type">usize</span>,</span>
<span class="line" id="L987"></span>
<span class="line" id="L988">    cadre: dds.CADRE,</span>
<span class="line" id="L989">    mnuvh : dds.MNUVH,</span>
<span class="line" id="L990"></span>
<span class="line" id="L991">    attribut: dds.ZONATRB,</span>
<span class="line" id="L992">    attrBar: dds.ZONATRB,</span>
<span class="line" id="L993">    attrCell: dds.ZONATRB,</span>
<span class="line" id="L994"></span>
<span class="line" id="L995">    xitems: []<span class="tok-kw">const</span>[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L996">    nbr: <span class="tok-type">usize</span>,</span>
<span class="line" id="L997">    actif: <span class="tok-type">bool</span></span>
<span class="line" id="L998">  };</span>
<span class="line" id="L999"></span>
<span class="line" id="L1000">  <span class="tok-comment">// NEW MENU</span>
</span>
<span class="line" id="L1001">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newMenu</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L1002">                vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L1003">                vcadre : dds.CADRE,</span>
<span class="line" id="L1004">                vmnuvh : dds.MNUVH,</span>
<span class="line" id="L1005">                vitems: []<span class="tok-kw">const</span>[]<span class="tok-kw">const</span> <span class="tok-type">u8</span></span>
<span class="line" id="L1006">                ) MENU {</span>
<span class="line" id="L1007"></span>
<span class="line" id="L1008"></span>
<span class="line" id="L1009"></span>
<span class="line" id="L1010">    <span class="tok-kw">var</span> xmenu = MENU {</span>
<span class="line" id="L1011">            .name = vname,</span>
<span class="line" id="L1012">            .posx   = vposx,</span>
<span class="line" id="L1013">            .posy   = vposy,</span>
<span class="line" id="L1014">            .lines  = <span class="tok-number">0</span>,</span>
<span class="line" id="L1015">            .cols   = <span class="tok-number">0</span>,</span>
<span class="line" id="L1016">            .attribut =AtrMnu,</span>
<span class="line" id="L1017">            .attrBar = AtrBar,</span>
<span class="line" id="L1018">            .attrCell= AtrCell,</span>
<span class="line" id="L1019">            .cadre = vcadre,</span>
<span class="line" id="L1020">            .mnuvh = vmnuvh,</span>
<span class="line" id="L1021">            .xitems  = vitems,</span>
<span class="line" id="L1022">            .nbr = <span class="tok-number">0</span>,</span>
<span class="line" id="L1023">            .actif = <span class="tok-null">true</span></span>
<span class="line" id="L1024">        };</span>
<span class="line" id="L1025"></span>
<span class="line" id="L1026"></span>
<span class="line" id="L1027">        <span class="tok-kw">for</span> (xmenu.xitems) |txt| {</span>
<span class="line" id="L1028">          <span class="tok-kw">if</span> (xmenu.cols &lt; txt.len) xmenu.cols = txt.len;</span>
<span class="line" id="L1029">          xmenu.nbr +=<span class="tok-number">1</span>;</span>
<span class="line" id="L1030">        }</span>
<span class="line" id="L1031">        xmenu.lines += xmenu.nbr + <span class="tok-number">2</span>; <span class="tok-comment">//nbr ligne  + header =cadre</span>
</span>
<span class="line" id="L1032">        xmenu.cols  += <span class="tok-number">2</span>;</span>
<span class="line" id="L1033">    <span class="tok-kw">return</span> xmenu;</span>
<span class="line" id="L1034">  }</span>
<span class="line" id="L1035"></span>
<span class="line" id="L1036"></span>
<span class="line" id="L1037">  <span class="tok-comment">// return index-menu  ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1038">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getIndex</span>(vpnl: *pnl.PANEL , name: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> )  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L1039">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1040">    <span class="tok-kw">for</span> (vpnl.menu.items) |l| {</span>
<span class="line" id="L1041">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, l.name, name)) <span class="tok-kw">return</span> idx;</span>
<span class="line" id="L1042">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L1043">    }</span>
<span class="line" id="L1044">    <span class="tok-kw">return</span> ErrForms.mnu_getIndex_Name_Menu_Invalide;</span>
<span class="line" id="L1045">  }</span>
<span class="line" id="L1046"></span>
<span class="line" id="L1047">  <span class="tok-comment">// return name-menu ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1048">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getName</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1049">    <span class="tok-kw">if</span> ( n &lt; vpnl.menu.items.len) <span class="tok-kw">return</span> vpnl.menu.items[n].name;</span>
<span class="line" id="L1050">    <span class="tok-kw">return</span> ErrForms.mnu_getName_Index_invalide ;</span>
<span class="line" id="L1051"></span>
<span class="line" id="L1052">  }</span>
<span class="line" id="L1053"></span>
<span class="line" id="L1054">  <span class="tok-comment">// return posx-menu ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1055">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosx</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L1056">    <span class="tok-kw">if</span> ( n &lt; vpnl.menu.items.len) <span class="tok-kw">return</span> vpnl.menu.items[n].posx;</span>
<span class="line" id="L1057">    <span class="tok-kw">return</span> ErrForms.mnu_getPosx_Index_invalide ;</span>
<span class="line" id="L1058">  }</span>
<span class="line" id="L1059"></span>
<span class="line" id="L1060">  <span class="tok-comment">// return posy-menu ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1061">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosy</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L1062">    <span class="tok-kw">if</span> ( n &lt; vpnl.menu.items.len) <span class="tok-kw">return</span> vpnl.menu.items[n].posy;</span>
<span class="line" id="L1063">    <span class="tok-kw">return</span> ErrForms.mnu_getPosy_Index_invalide ;</span>
<span class="line" id="L1064">  }</span>
<span class="line" id="L1065"></span>
<span class="line" id="L1066">  <span class="tok-comment">// return Text-menu ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1067">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getText</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L1068">    <span class="tok-kw">if</span> ( n &lt; vpnl.menu.items.len) <span class="tok-kw">return</span> vpnl.menu.items[n].text;</span>
<span class="line" id="L1069">    <span class="tok-kw">return</span> ErrForms.mnu_getText_Index_invalide ;</span>
<span class="line" id="L1070">  }</span>
<span class="line" id="L1071"></span>
<span class="line" id="L1072">  <span class="tok-comment">// return ON/OFF-menu ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1073">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getActif</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L1074">    <span class="tok-kw">if</span> ( n &lt; vpnl.menu.items.len) <span class="tok-kw">return</span> vpnl.menu.items[n].actif;</span>
<span class="line" id="L1075">    <span class="tok-kw">return</span> ErrForms.mnu_getActif_Index_invalide ;</span>
<span class="line" id="L1076">  }</span>
<span class="line" id="L1077"></span>
<span class="line" id="L1078"></span>
<span class="line" id="L1079">  <span class="tok-comment">// delete -menu ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1080">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">dltRows</span>(vpnl: *pnl.PANEL,  n :<span class="tok-type">usize</span> ) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L1081">    <span class="tok-kw">if</span> ( n &lt; vpnl.button.items.len) _= vpnl.menu.orderedRemove(n)</span>
<span class="line" id="L1082">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.mnu_dltRows_Index_invalide ;</span>
<span class="line" id="L1083">  }</span>
<span class="line" id="L1084"></span>
<span class="line" id="L1085"></span>
<span class="line" id="L1086">  <span class="tok-comment">// assign -menu MATRIX TERMINAL  ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1087">  <span class="tok-kw">fn</span> <span class="tok-fn">printMenu</span>(vpnl: *pnl.PANEL, vmnu: MENU) <span class="tok-type">void</span> {</span>
<span class="line" id="L1088">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L1089">    <span class="tok-kw">const</span> ACS_Hlines  = <span class="tok-str">&quot;─&quot;</span>;</span>
<span class="line" id="L1090">    <span class="tok-kw">const</span> ACS_Vlines  = <span class="tok-str">&quot;│&quot;</span>;</span>
<span class="line" id="L1091">    <span class="tok-kw">const</span> ACS_UCLEFT  = <span class="tok-str">&quot;┌&quot;</span>;</span>
<span class="line" id="L1092">    <span class="tok-kw">const</span> ACS_UCRIGHT = <span class="tok-str">&quot;┐&quot;</span>;</span>
<span class="line" id="L1093">    <span class="tok-kw">const</span> ACS_LCLEFT  = <span class="tok-str">&quot;└&quot;</span>;</span>
<span class="line" id="L1094">    <span class="tok-kw">const</span> ACS_LCRIGHT = <span class="tok-str">&quot;┘&quot;</span>;</span>
<span class="line" id="L1095"></span>
<span class="line" id="L1096">    <span class="tok-kw">const</span> ACS_Hline2    = <span class="tok-str">&quot;═&quot;</span>;</span>
<span class="line" id="L1097">    <span class="tok-kw">const</span> ACS_Vline2    = <span class="tok-str">&quot;║&quot;</span>;</span>
<span class="line" id="L1098">    <span class="tok-kw">const</span> ACS_UCLEFT2   = <span class="tok-str">&quot;╔&quot;</span>;</span>
<span class="line" id="L1099">    <span class="tok-kw">const</span> ACS_UCRIGHT2  = <span class="tok-str">&quot;╗&quot;</span>;</span>
<span class="line" id="L1100">    <span class="tok-kw">const</span> ACS_LCLEFT2   = <span class="tok-str">&quot;╚&quot;</span>;</span>
<span class="line" id="L1101">    <span class="tok-kw">const</span> ACS_LCRIGHT2  = <span class="tok-str">&quot;╝&quot;</span>;</span>
<span class="line" id="L1102"></span>
<span class="line" id="L1103">    <span class="tok-kw">var</span> trait: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1104">    <span class="tok-kw">var</span> edt :<span class="tok-type">bool</span>   = <span class="tok-null">undefined</span> ;</span>
<span class="line" id="L1105"></span>
<span class="line" id="L1106">    <span class="tok-kw">var</span> row:  <span class="tok-type">usize</span> = <span class="tok-number">1</span> ;</span>
<span class="line" id="L1107">    <span class="tok-kw">var</span> y:    <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1108">    <span class="tok-kw">var</span> col:  <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1109"></span>
<span class="line" id="L1110">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> =  vmnu.posx - <span class="tok-number">1</span> ;</span>
<span class="line" id="L1111"></span>
<span class="line" id="L1112">    <span class="tok-comment">// if line 0 ex: directory tab</span>
</span>
<span class="line" id="L1113">    <span class="tok-kw">if</span> (dds.CADRE.line0 != vmnu.cadre ) {</span>
<span class="line" id="L1114">      <span class="tok-kw">while</span> (row &lt;= vmnu.lines) : (row +=<span class="tok-number">1</span>) {</span>
<span class="line" id="L1115">        y = vmnu.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L1116">        col = <span class="tok-number">1</span>;</span>
<span class="line" id="L1117">        <span class="tok-kw">while</span> ( col &lt;= vmnu.cols ){</span>
<span class="line" id="L1118">          edt = <span class="tok-null">false</span>;</span>
<span class="line" id="L1119">          <span class="tok-kw">if</span> (row == <span class="tok-number">1</span>) {</span>
<span class="line" id="L1120">              <span class="tok-kw">if</span> (col == <span class="tok-number">1</span>) {</span>
<span class="line" id="L1121">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vmnu.cadre ) {</span>
<span class="line" id="L1122">                    trait = ACS_UCLEFT;</span>
<span class="line" id="L1123">                } <span class="tok-kw">else</span>  trait = ACS_UCLEFT2 ;</span>
<span class="line" id="L1124">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1125">              }</span>
<span class="line" id="L1126">              <span class="tok-kw">if</span> ( col == vmnu.cols ) {</span>
<span class="line" id="L1127">                <span class="tok-kw">if</span> (dds.CADRE.line1 == vmnu.cadre) {</span>
<span class="line" id="L1128">                  trait = ACS_UCRIGHT;</span>
<span class="line" id="L1129">                } <span class="tok-kw">else</span>  trait = ACS_UCRIGHT2 ;</span>
<span class="line" id="L1130">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1131">              }</span>
<span class="line" id="L1132">              <span class="tok-kw">if</span> ( col &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> col &lt; vmnu.cols ) {</span>
<span class="line" id="L1133">                <span class="tok-kw">if</span> (dds.CADRE.line1 == vmnu.cadre ) {</span>
<span class="line" id="L1134">                  trait = ACS_Hlines;</span>
<span class="line" id="L1135">                } <span class="tok-kw">else</span>  trait = ACS_Hline2;</span>
<span class="line" id="L1136">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1137">              }</span>
<span class="line" id="L1138">          } <span class="tok-kw">else</span> <span class="tok-kw">if</span> ( row == vmnu.lines ) {</span>
<span class="line" id="L1139">              <span class="tok-kw">if</span> (col == <span class="tok-number">1</span>) {</span>
<span class="line" id="L1140">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vmnu.cadre ) {</span>
<span class="line" id="L1141">                  trait = ACS_LCLEFT;</span>
<span class="line" id="L1142">                } <span class="tok-kw">else</span>  trait = ACS_LCLEFT2;</span>
<span class="line" id="L1143">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1144">              }</span>
<span class="line" id="L1145">              <span class="tok-kw">if</span> ( col == vmnu.cols ) {</span>
<span class="line" id="L1146">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vmnu.cadre ) {</span>
<span class="line" id="L1147">                  trait = ACS_LCRIGHT;</span>
<span class="line" id="L1148">                } <span class="tok-kw">else</span>  trait = ACS_LCRIGHT2 ;</span>
<span class="line" id="L1149">                edt = <span class="tok-null">true</span> ;</span>
<span class="line" id="L1150">              }</span>
<span class="line" id="L1151">              <span class="tok-kw">if</span> ( col &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> col &lt; vmnu.cols ) {</span>
<span class="line" id="L1152">                <span class="tok-kw">if</span> ( dds.CADRE.line1 == vmnu.cadre ) {</span>
<span class="line" id="L1153">                  trait = ACS_Hlines;</span>
<span class="line" id="L1154">                } <span class="tok-kw">else</span>  trait = ACS_Hline2 ;</span>
<span class="line" id="L1155">                edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1156">              }</span>
<span class="line" id="L1157">          } <span class="tok-kw">else</span> <span class="tok-kw">if</span> ( row &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> row &lt; vmnu.lines ) {</span>
<span class="line" id="L1158">            <span class="tok-kw">if</span> ( col == <span class="tok-number">1</span> <span class="tok-kw">or</span> col == vmnu.cols ) {</span>
<span class="line" id="L1159">              <span class="tok-kw">if</span> ( dds.CADRE.line1 == vmnu.cadre ) {</span>
<span class="line" id="L1160">                trait = ACS_Vlines;</span>
<span class="line" id="L1161">              } <span class="tok-kw">else</span> trait = ACS_Vline2 ;</span>
<span class="line" id="L1162">              edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1163">            }</span>
<span class="line" id="L1164">          }</span>
<span class="line" id="L1165">          <span class="tok-kw">if</span>  ( edt ) {</span>
<span class="line" id="L1166">            term.gotoXY(row + vmnu.posx + vpnl.posx - <span class="tok-number">2</span>  , col + vmnu.posy + vpnl.posy - <span class="tok-number">2</span>);</span>
<span class="line" id="L1167">            term.writeStyled(trait,vmnu.attribut);</span>
<span class="line" id="L1168">          }</span>
<span class="line" id="L1169">          <span class="tok-kw">else</span> {</span>
<span class="line" id="L1170">            term.gotoXY(row + vmnu.posx + vpnl.posx - <span class="tok-number">2</span>  , col + vmnu.posy + vpnl.posy - <span class="tok-number">2</span>);</span>
<span class="line" id="L1171">            term.writeStyled(<span class="tok-str">&quot; &quot;</span>,vmnu.attribut);</span>
<span class="line" id="L1172">          }</span>
<span class="line" id="L1173"></span>
<span class="line" id="L1174">          y += <span class="tok-number">1</span>;</span>
<span class="line" id="L1175">          col += <span class="tok-number">1</span>;</span>
<span class="line" id="L1176">        }</span>
<span class="line" id="L1177">        x += <span class="tok-number">1</span>;</span>
<span class="line" id="L1178">      }</span>
<span class="line" id="L1179">    }</span>
<span class="line" id="L1180"></span>
<span class="line" id="L1181"></span>
<span class="line" id="L1182">  }</span>
<span class="line" id="L1183"></span>
<span class="line" id="L1184">  <span class="tok-comment">// display  MATRIX to terminal ---&gt; arraylist panel-menu</span>
</span>
<span class="line" id="L1185">  <span class="tok-kw">fn</span> <span class="tok-fn">displayMenu</span>(vpnl: *pnl.PANEL, vmnu:MENU, npos: <span class="tok-type">usize</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L1186">    <span class="tok-kw">var</span> pos : <span class="tok-type">usize</span> = npos;</span>
<span class="line" id="L1187">    <span class="tok-kw">var</span> n : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1188">    <span class="tok-kw">var</span> h : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1189"></span>
<span class="line" id="L1190">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = vmnu.posx - <span class="tok-number">1</span>;</span>
<span class="line" id="L1191">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = vmnu.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L1192"></span>
<span class="line" id="L1193">    printMenu(vpnl, vmnu);</span>
<span class="line" id="L1194"></span>
<span class="line" id="L1195">    term.onMouse();</span>
<span class="line" id="L1196">    term.cursHide();</span>
<span class="line" id="L1197"></span>
<span class="line" id="L1198"></span>
<span class="line" id="L1199">    <span class="tok-kw">if</span> (npos &gt; vmnu.nbr <span class="tok-kw">or</span> npos == <span class="tok-number">0</span> )  pos = <span class="tok-number">0</span>  ;</span>
<span class="line" id="L1200"></span>
<span class="line" id="L1201">    n = <span class="tok-number">0</span>;</span>
<span class="line" id="L1202">    h = <span class="tok-number">0</span>;</span>
<span class="line" id="L1203">    <span class="tok-kw">for</span> (vmnu.xitems) | cell |  {</span>
<span class="line" id="L1204">      <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.vertical) {</span>
<span class="line" id="L1205">        <span class="tok-kw">if</span> (vmnu.cadre == dds.CADRE.line0)</span>
<span class="line" id="L1206">          term.gotoXY(vpnl.posx + x + n  ,    vpnl.posy + y  )</span>
<span class="line" id="L1207">        <span class="tok-kw">else</span></span>
<span class="line" id="L1208">          term.gotoXY(vpnl.posx + x + n + <span class="tok-number">1</span> , vpnl.posy + y  + <span class="tok-number">1</span>);</span>
<span class="line" id="L1209">      }</span>
<span class="line" id="L1210">      <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.horizontal) {</span>
<span class="line" id="L1211">        <span class="tok-kw">if</span> (vmnu.cadre == dds.CADRE.line0 )</span>
<span class="line" id="L1212">          term.gotoXY(vpnl.posx + x  ,    h   + vpnl.posy + y   )</span>
<span class="line" id="L1213">        <span class="tok-kw">else</span></span>
<span class="line" id="L1214">          term.gotoXY(vpnl.posx + x + <span class="tok-number">1</span>  , h  + vpnl.posy + y  + <span class="tok-number">1</span>);</span>
<span class="line" id="L1215">      }</span>
<span class="line" id="L1216">      <span class="tok-comment">//var xcell = utl.Trim(cell);</span>
</span>
<span class="line" id="L1217">      <span class="tok-kw">if</span> (pos == n)</span>
<span class="line" id="L1218">        term.writeStyled(cell,vmnu.attrBar)</span>
<span class="line" id="L1219">      <span class="tok-kw">else</span></span>
<span class="line" id="L1220">        term.writeStyled(cell,vmnu.attrCell);</span>
<span class="line" id="L1221"></span>
<span class="line" id="L1222">      n += <span class="tok-number">1</span>;</span>
<span class="line" id="L1223">      h += utl.nbrCharStr(cell);</span>
<span class="line" id="L1224">      <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.horizontal) h += mnuspc;</span>
<span class="line" id="L1225">    }</span>
<span class="line" id="L1226">  }</span>
<span class="line" id="L1227"></span>
<span class="line" id="L1228">  <span class="tok-comment">// restor -panel  MATRIX to terminal ---&gt; arraylist panel-menu </span>
</span>
<span class="line" id="L1229">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">rstPanel</span>( vsrc : *MENU , vdst : *pnl.PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L1230">    <span class="tok-kw">if</span> (vdst.actif == <span class="tok-null">false</span>)  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L1231">    <span class="tok-kw">if</span> (vsrc.posx + vsrc.lines &gt; vdst.posx + vdst.lines  )  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L1232">    <span class="tok-kw">if</span> (vsrc.posy + vsrc.cols  &gt; vdst.posy + vdst.cols  )  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L1233">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1234">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1235">    <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1236">    <span class="tok-kw">var</span> npos : <span class="tok-type">usize</span> =  vsrc.posx - vdst.posx;</span>
<span class="line" id="L1237">    <span class="tok-kw">while</span> (x &lt;= vsrc.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1238">        n = vdst.cols * npos + vsrc.posy - vdst.posy  ;</span>
<span class="line" id="L1239">        y = <span class="tok-number">0</span>;</span>
<span class="line" id="L1240">        <span class="tok-kw">while</span> (y &lt;= vsrc.cols) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1241">          term.gotoXY(x + vsrc.posx   , y + vsrc.posy  );</span>
<span class="line" id="L1242">          term.writeStyled(vdst.buf.items[n].ch,vdst.buf.items[n].attribut);</span>
<span class="line" id="L1243">          n += <span class="tok-number">1</span>;</span>
<span class="line" id="L1244">        }</span>
<span class="line" id="L1245">      npos += <span class="tok-number">1</span>;</span>
<span class="line" id="L1246">    }</span>
<span class="line" id="L1247">  }</span>
<span class="line" id="L1248">  <span class="tok-comment">//----------------------------------------------------------------</span>
</span>
<span class="line" id="L1249">  <span class="tok-comment">// menu  enter = select  1..n 0 = abort (Escape)</span>
</span>
<span class="line" id="L1250">  <span class="tok-comment">// Turning on the mouse</span>
</span>
<span class="line" id="L1251">  <span class="tok-comment">// UP DOWN LEFT RIGHT</span>
</span>
<span class="line" id="L1252">  <span class="tok-comment">// movement width the wheel and validation width the clik</span>
</span>
<span class="line" id="L1253">  <span class="tok-comment">//----------------------------------------------------------------</span>
</span>
<span class="line" id="L1254">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">ioMenu</span>(vpnl: *pnl.PANEL, vmnu: MENU, npos: <span class="tok-type">usize</span>) <span class="tok-type">usize</span> {</span>
<span class="line" id="L1255">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> <span class="tok-number">999</span> ;</span>
<span class="line" id="L1256">    <span class="tok-kw">if</span> (vmnu.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> <span class="tok-number">999</span> ;</span>
<span class="line" id="L1257">    <span class="tok-kw">var</span> pos : <span class="tok-type">usize</span> = npos;</span>
<span class="line" id="L1258">    <span class="tok-kw">var</span> n   : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1259">    <span class="tok-kw">var</span> h   : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1260">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = vmnu.posx - <span class="tok-number">1</span>;</span>
<span class="line" id="L1261">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = vmnu.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L1262"></span>
<span class="line" id="L1263">    term.onMouse();</span>
<span class="line" id="L1264">    term.cursHide();</span>
<span class="line" id="L1265"></span>
<span class="line" id="L1266"></span>
<span class="line" id="L1267"></span>
<span class="line" id="L1268">    <span class="tok-kw">if</span> (npos &gt; vmnu.nbr <span class="tok-kw">or</span> npos == <span class="tok-number">0</span> )  pos = <span class="tok-number">0</span>;</span>
<span class="line" id="L1269"></span>
<span class="line" id="L1270"></span>
<span class="line" id="L1271">    displayMenu(vpnl,vmnu,pos);</span>
<span class="line" id="L1272"></span>
<span class="line" id="L1273"></span>
<span class="line" id="L1274">    term.flushIO();</span>
<span class="line" id="L1275">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L1276">      n = <span class="tok-number">0</span>;</span>
<span class="line" id="L1277">      h = <span class="tok-number">0</span>;</span>
<span class="line" id="L1278">      <span class="tok-kw">for</span> (vmnu.xitems) | cell |  {</span>
<span class="line" id="L1279"></span>
<span class="line" id="L1280">        <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.vertical) {</span>
<span class="line" id="L1281">          <span class="tok-kw">if</span> (vmnu.cadre == dds.CADRE.line0 )</span>
<span class="line" id="L1282">            term.gotoXY(vpnl.posx + x  + n  ,   vpnl.posy + y )</span>
<span class="line" id="L1283">          <span class="tok-kw">else</span></span>
<span class="line" id="L1284">            term.gotoXY(vpnl.posx + x  + n + <span class="tok-number">1</span>, vpnl.posy + y + <span class="tok-number">1</span>);</span>
<span class="line" id="L1285">          }</span>
<span class="line" id="L1286">        <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.horizontal) {</span>
<span class="line" id="L1287">          <span class="tok-kw">if</span> (vmnu.cadre == dds.CADRE.line0)</span>
<span class="line" id="L1288">            term.gotoXY(vpnl.posx + x   ,   h + vpnl.posy + y )</span>
<span class="line" id="L1289">          <span class="tok-kw">else</span></span>
<span class="line" id="L1290">            term.gotoXY(vpnl.posx + x  + <span class="tok-number">1</span>, h + vpnl.posy + y + <span class="tok-number">1</span>);</span>
<span class="line" id="L1291">        }</span>
<span class="line" id="L1292">        <span class="tok-kw">if</span> (pos == n)</span>
<span class="line" id="L1293">          term.writeStyled(cell,vmnu.attrBar)</span>
<span class="line" id="L1294">        <span class="tok-kw">else</span></span>
<span class="line" id="L1295">          term.writeStyled(cell,vmnu.attrCell);</span>
<span class="line" id="L1296"></span>
<span class="line" id="L1297">        n += <span class="tok-number">1</span>;</span>
<span class="line" id="L1298">        h += utl.nbrCharStr(cell);</span>
<span class="line" id="L1299">        <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.horizontal) h += mnuspc;</span>
<span class="line" id="L1300">      }</span>
<span class="line" id="L1301"></span>
<span class="line" id="L1302">      <span class="tok-kw">var</span> Tkey  = kbd.getKEY();</span>
<span class="line" id="L1303"></span>
<span class="line" id="L1304">      <span class="tok-kw">if</span> (Tkey.Key == kbd.char <span class="tok-kw">and</span></span>
<span class="line" id="L1305">          std.mem.eql(<span class="tok-type">u8</span>,Tkey.Char,<span class="tok-str">&quot; &quot;</span> ) ) {Tkey.Key = kbd.enter; Tkey.Char =<span class="tok-str">&quot;&quot;</span>;}</span>
<span class="line" id="L1306"></span>
<span class="line" id="L1307"></span>
<span class="line" id="L1308">      <span class="tok-kw">if</span> (Tkey.Key == kbd.mouse) {</span>
<span class="line" id="L1309">        Tkey.Key = kbd.none;</span>
<span class="line" id="L1310">        <span class="tok-kw">if</span> (term.MouseInfo.scroll ) {</span>
<span class="line" id="L1311">          <span class="tok-kw">if</span> ( term.MouseInfo.scrollDir == term.ScrollDirection.msUp ) {</span>
<span class="line" id="L1312">            <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.vertical)    Tkey.Key = kbd.up;</span>
<span class="line" id="L1313">            <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.horizontal)  Tkey.Key = kbd.left;</span>
<span class="line" id="L1314">          }</span>
<span class="line" id="L1315"></span>
<span class="line" id="L1316">          <span class="tok-kw">if</span> (term.MouseInfo.scrollDir == term.ScrollDirection.msDown) {</span>
<span class="line" id="L1317">            <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.vertical)    Tkey.Key = kbd.down;</span>
<span class="line" id="L1318">            <span class="tok-kw">if</span> (vmnu.mnuvh == dds.MNUVH.horizontal)  Tkey.Key = kbd.right;</span>
<span class="line" id="L1319">          }</span>
<span class="line" id="L1320">        }</span>
<span class="line" id="L1321">        <span class="tok-kw">else</span> {</span>
<span class="line" id="L1322">          <span class="tok-kw">if</span> (term.MouseInfo.action == term.MouseAction.maReleased ) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L1323">          <span class="tok-kw">switch</span> (term.MouseInfo.button) {</span>
<span class="line" id="L1324">            term.MouseButton.mbLeft    =&gt;  Tkey.Key = kbd.enter,</span>
<span class="line" id="L1325">            term.MouseButton.mbMiddle  =&gt;  Tkey.Key = kbd.enter,</span>
<span class="line" id="L1326">            term.MouseButton.mbRight    =&gt;  Tkey.Key = kbd.enter,</span>
<span class="line" id="L1327">            <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L1328">          }</span>
<span class="line" id="L1329">        }</span>
<span class="line" id="L1330">      }</span>
<span class="line" id="L1331"></span>
<span class="line" id="L1332">      <span class="tok-kw">switch</span> (Tkey.Key) {</span>
<span class="line" id="L1333">        .none =&gt; <span class="tok-kw">continue</span>,</span>
<span class="line" id="L1334">        .esc  =&gt; {</span>
<span class="line" id="L1335">          term.offMouse();</span>
<span class="line" id="L1336">          <span class="tok-kw">return</span> <span class="tok-number">9999</span>;</span>
<span class="line" id="L1337">        },</span>
<span class="line" id="L1338">        .enter =&gt; {</span>
<span class="line" id="L1339">          term.offMouse();</span>
<span class="line" id="L1340">          <span class="tok-kw">return</span> pos ;</span>
<span class="line" id="L1341">        },</span>
<span class="line" id="L1342">        .down  =&gt; { <span class="tok-kw">if</span> (pos &lt; vmnu.nbr - <span class="tok-number">1</span> )  pos +=<span class="tok-number">1</span>; } ,</span>
<span class="line" id="L1343">        .up    =&gt; { <span class="tok-kw">if</span> (pos &gt; <span class="tok-number">0</span> ) pos -=<span class="tok-number">1</span>; },</span>
<span class="line" id="L1344">        .right =&gt; { <span class="tok-kw">if</span> (pos &lt; vmnu.nbr - <span class="tok-number">1</span> )  pos +=<span class="tok-number">1</span>; },</span>
<span class="line" id="L1345">        .left  =&gt; { <span class="tok-kw">if</span> (pos &gt; <span class="tok-number">0</span> ) pos -=<span class="tok-number">1</span>; },</span>
<span class="line" id="L1346">        <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L1347">      }</span>
<span class="line" id="L1348">    }</span>
<span class="line" id="L1349">  }</span>
<span class="line" id="L1350"></span>
<span class="line" id="L1351">};</span>
<span class="line" id="L1352"></span>
<span class="line" id="L1353"></span>
<span class="line" id="L1354"><span class="tok-comment">//-------------------------------------------------------</span>
</span>
<span class="line" id="L1355"><span class="tok-comment">// management grid</span>
</span>
<span class="line" id="L1356"><span class="tok-comment">// ----------------</span>
</span>
<span class="line" id="L1357"><span class="tok-comment">// PadingCell()</span>
</span>
<span class="line" id="L1358"><span class="tok-comment">// setPageGrid()</span>
</span>
<span class="line" id="L1359"><span class="tok-comment">// initGrid()</span>
</span>
<span class="line" id="L1360"><span class="tok-comment">// getLenHeaders()</span>
</span>
<span class="line" id="L1361"><span class="tok-comment">// countColumns()</span>
</span>
<span class="line" id="L1362"><span class="tok-comment">// countRows()</span>
</span>
<span class="line" id="L1363"><span class="tok-comment">// setHeaders()</span>
</span>
<span class="line" id="L1364"><span class="tok-comment">// toRefColors()</span>
</span>
<span class="line" id="L1365"><span class="tok-comment">// newCell()</span>
</span>
<span class="line" id="L1366"><span class="tok-comment">// setCellEditCar()</span>
</span>
<span class="line" id="L1367"><span class="tok-comment">// getcellLen()</span>
</span>
<span class="line" id="L1368"><span class="tok-comment">// getHeadersText()</span>
</span>
<span class="line" id="L1369"><span class="tok-comment">// getHeadersPosy()</span>
</span>
<span class="line" id="L1370"><span class="tok-comment">// getHeadersType()</span>
</span>
<span class="line" id="L1371"><span class="tok-comment">// getHeadersCar()</span>
</span>
<span class="line" id="L1372"><span class="tok-comment">// getRowsText()</span>
</span>
<span class="line" id="L1373"></span>
<span class="line" id="L1374"><span class="tok-comment">// addRows()</span>
</span>
<span class="line" id="L1375"><span class="tok-comment">// dltRows()   </span>
</span>
<span class="line" id="L1376"><span class="tok-comment">// resetRows()</span>
</span>
<span class="line" id="L1377"><span class="tok-comment">// resetGrid() </span>
</span>
<span class="line" id="L1378"><span class="tok-comment">// GridBox()</span>
</span>
<span class="line" id="L1379"><span class="tok-comment">// printGridHeader()</span>
</span>
<span class="line" id="L1380"><span class="tok-comment">// printGridRows()</span>
</span>
<span class="line" id="L1381"><span class="tok-comment">// ioGrid()</span>
</span>
<span class="line" id="L1382"><span class="tok-comment">// ioCombo()</span>
</span>
<span class="line" id="L1383"><span class="tok-comment">// ----------------</span>
</span>
<span class="line" id="L1384"><span class="tok-comment">// defined GRID</span>
</span>
<span class="line" id="L1385"></span>
<span class="line" id="L1386"><span class="tok-kw">pub</span> <span class="tok-kw">const</span>  grd = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L1387"></span>
<span class="line" id="L1388">  <span class="tok-comment">// define attribut default GRID</span>
</span>
<span class="line" id="L1389">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrGrid : dds.ZONATRB = .{</span>
<span class="line" id="L1390">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L1391">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L1392">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L1393">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L1394">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L1395">      .foregr = dds.ForegroundColor.fgGreen</span>
<span class="line" id="L1396"></span>
<span class="line" id="L1397">  };</span>
<span class="line" id="L1398"></span>
<span class="line" id="L1399">  <span class="tok-comment">// define attribut default TITLE GRID</span>
</span>
<span class="line" id="L1400">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrTitle : dds.ZONATRB = .{</span>
<span class="line" id="L1401">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L1402">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.styleUnderscore),</span>
<span class="line" id="L1403">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L1404">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L1405">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L1406">      .foregr = dds.ForegroundColor.fgGreen</span>
<span class="line" id="L1407">  };</span>
<span class="line" id="L1408"></span>
<span class="line" id="L1409"></span>
<span class="line" id="L1410">  <span class="tok-comment">// define attribut default CELL GRID</span>
</span>
<span class="line" id="L1411">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrCell : dds.ZONATRB = .{</span>
<span class="line" id="L1412">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleItalic),</span>
<span class="line" id="L1413">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L1414">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L1415">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L1416">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L1417">      .foregr = dds.ForegroundColor.fgCyan</span>
<span class="line" id="L1418">  };</span>
<span class="line" id="L1419"></span>
<span class="line" id="L1420">  <span class="tok-comment">// define attribut default CELL GRID</span>
</span>
<span class="line" id="L1421">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrCellBar : dds.ZONATRB = .{</span>
<span class="line" id="L1422">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleReverse),</span>
<span class="line" id="L1423">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.styleItalic),</span>
<span class="line" id="L1424">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L1425">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L1426">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L1427">      .foregr = dds.ForegroundColor.fgCyan</span>
<span class="line" id="L1428">  };</span>
<span class="line" id="L1429">  <span class="tok-comment">// use default Style separator</span>
</span>
<span class="line" id="L1430">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> gridStyle : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;│&quot;</span>;</span>
<span class="line" id="L1431">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> gridnoStyle : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot; &quot;</span>;</span>
<span class="line" id="L1432"></span>
<span class="line" id="L1433">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> CELL = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L1434">    text:     [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L1435">    long:     <span class="tok-type">usize</span>,</span>
<span class="line" id="L1436">    reftyp:   dds.REFTYP,</span>
<span class="line" id="L1437">    posy:     <span class="tok-type">usize</span>,</span>
<span class="line" id="L1438">    edtcar:   []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L1439">    atrCell:  dds.ZONATRB</span>
<span class="line" id="L1440">  };</span>
<span class="line" id="L1441"></span>
<span class="line" id="L1442"></span>
<span class="line" id="L1443">  <span class="tok-kw">const</span> ArgData = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L1444">    buf : std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) = std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>).init(allocator),</span>
<span class="line" id="L1445">  };</span>
<span class="line" id="L1446"></span>
<span class="line" id="L1447"></span>
<span class="line" id="L1448">  <span class="tok-comment">/// define GRID</span></span>
<span class="line" id="L1449">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> GRID = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L1450">    name:  [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L1451">    posx:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L1452">    posy:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L1453"></span>
<span class="line" id="L1454">    lines:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L1455">    cols:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L1456"></span>
<span class="line" id="L1457">    pageRows:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L1458"></span>
<span class="line" id="L1459">    data:     std.MultiArrayList(ArgData),</span>
<span class="line" id="L1460">    headers:  std.ArrayList(CELL),</span>
<span class="line" id="L1461"></span>
<span class="line" id="L1462">    separator:  [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L1463"></span>
<span class="line" id="L1464">    attribut: dds.ZONATRB,</span>
<span class="line" id="L1465">    atrTitle: dds.ZONATRB,</span>
<span class="line" id="L1466">    atrCell:  dds.ZONATRB,</span>
<span class="line" id="L1467">    cadre:    dds.CADRE,</span>
<span class="line" id="L1468">    actif:    <span class="tok-type">bool</span>,</span>
<span class="line" id="L1469"></span>
<span class="line" id="L1470">    lignes: <span class="tok-type">usize</span>,</span>
<span class="line" id="L1471">    pages:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L1472"></span>
<span class="line" id="L1473"></span>
<span class="line" id="L1474">    maxligne  : <span class="tok-type">usize</span>,</span>
<span class="line" id="L1475">    cursligne : <span class="tok-type">usize</span>,</span>
<span class="line" id="L1476">    curspage  : <span class="tok-type">usize</span>,</span>
<span class="line" id="L1477"></span>
<span class="line" id="L1478">    buf:std.ArrayList(TERMINAL_CHAR)</span>
<span class="line" id="L1479"></span>
<span class="line" id="L1480">  };</span>
<span class="line" id="L1481"></span>
<span class="line" id="L1482"></span>
<span class="line" id="L1483">  <span class="tok-comment">// pading Cell </span>
</span>
<span class="line" id="L1484">  <span class="tok-kw">fn</span> <span class="tok-fn">padingCell</span>( text:[] <span class="tok-kw">const</span> <span class="tok-type">u8</span> , cell :CELL) [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1485"></span>
<span class="line" id="L1486">    <span class="tok-kw">var</span> i: <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1487"></span>
<span class="line" id="L1488">    <span class="tok-kw">var</span> e_FIELD : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = text ;</span>
<span class="line" id="L1489">    <span class="tok-kw">var</span> e_signed: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L1490"></span>
<span class="line" id="L1491">    <span class="tok-kw">if</span> (cell.reftyp == dds.REFTYP.PASSWORD) {</span>
<span class="line" id="L1492">      i = <span class="tok-number">0</span>;</span>
<span class="line" id="L1493">      e_FIELD = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1494">      <span class="tok-kw">while</span> (i &lt; utl.nbrCharStr(text) ) : ( i += <span class="tok-number">1</span> )  e_FIELD = utl.concatStr(e_FIELD,<span class="tok-str">&quot;*&quot;</span>);</span>
<span class="line" id="L1495">    }</span>
<span class="line" id="L1496"></span>
<span class="line" id="L1497">    </span>
<span class="line" id="L1498"></span>
<span class="line" id="L1499">    <span class="tok-kw">if</span>  (cell.reftyp == dds.REFTYP.UDIGIT <span class="tok-kw">or</span></span>
<span class="line" id="L1500">        cell.reftyp == dds.REFTYP.DIGIT <span class="tok-kw">or</span></span>
<span class="line" id="L1501">        cell.reftyp == dds.REFTYP.UDECIMAL <span class="tok-kw">or</span></span>
<span class="line" id="L1502">        cell.reftyp == dds.REFTYP.DECIMAL)</span>
<span class="line" id="L1503">        {</span>
<span class="line" id="L1504">          <span class="tok-kw">if</span> (utl.isSignedStr(text) == <span class="tok-null">true</span> ) {</span>
<span class="line" id="L1505">              e_FIELD = utl.subStr(e_FIELD,<span class="tok-number">1</span>,e_FIELD.len) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span> ;</span>
<span class="line" id="L1506">              e_signed = utl.subStr(text,<span class="tok-number">0</span>,<span class="tok-number">1</span>) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span> ;</span>
<span class="line" id="L1507">          }</span>
<span class="line" id="L1508"></span>
<span class="line" id="L1509">          e_FIELD = utl.alignStr(e_FIELD,dds.ALIGNS.rigth,cell.long);</span>
<span class="line" id="L1510"></span>
<span class="line" id="L1511">          <span class="tok-kw">if</span> (cell.reftyp == dds.REFTYP.DIGIT <span class="tok-kw">or</span> cell.reftyp == dds.REFTYP.DECIMAL) {</span>
<span class="line" id="L1512"></span>
<span class="line" id="L1513">            e_FIELD = utl.subStr(e_FIELD,<span class="tok-number">1</span>,e_FIELD.len) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span> ;</span>
<span class="line" id="L1514"></span>
<span class="line" id="L1515">            <span class="tok-kw">if</span> ( utl.isSignedStr(text) == <span class="tok-null">false</span> )   e_FIELD = utl.concatStr(<span class="tok-str">&quot;+&quot;</span>,e_FIELD)</span>
<span class="line" id="L1516">            <span class="tok-kw">else</span> e_FIELD = utl.concatStr(e_signed,e_FIELD);</span>
<span class="line" id="L1517"></span>
<span class="line" id="L1518">          }</span>
<span class="line" id="L1519">        }</span>
<span class="line" id="L1520">    <span class="tok-kw">else</span>  e_FIELD = utl.alignStr(e_FIELD,dds.ALIGNS.left,cell.long);</span>
<span class="line" id="L1521"></span>
<span class="line" id="L1522"></span>
<span class="line" id="L1523">    <span class="tok-kw">if</span> (cell.reftyp == dds.REFTYP.SWITCH) {</span>
<span class="line" id="L1524">      <span class="tok-kw">if</span> ( std.mem.eql(<span class="tok-type">u8</span>, text[<span class="tok-number">0</span>..],<span class="tok-str">&quot;true&quot;</span>)  <span class="tok-kw">or</span> std.mem.eql(<span class="tok-type">u8</span>, text[<span class="tok-number">0</span>..] , <span class="tok-str">&quot;1&quot;</span> ) ) e_FIELD = dds.CTRUE</span>
<span class="line" id="L1525">      <span class="tok-kw">else</span> e_FIELD = dds.CFALSE;</span>
<span class="line" id="L1526">    }</span>
<span class="line" id="L1527"></span>
<span class="line" id="L1528">    <span class="tok-kw">if</span> ( std.mem.eql(<span class="tok-type">u8</span>,cell.edtcar , <span class="tok-str">&quot;&quot;</span>) == <span class="tok-null">false</span>)  e_FIELD =   utl.concatStr(e_FIELD,cell.edtcar);</span>
<span class="line" id="L1529"></span>
<span class="line" id="L1530">    <span class="tok-kw">return</span> e_FIELD;</span>
<span class="line" id="L1531"></span>
<span class="line" id="L1532">  }</span>
<span class="line" id="L1533"></span>
<span class="line" id="L1534">  <span class="tok-comment">// calculate the number of pages</span>
</span>
<span class="line" id="L1535">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setPageGrid</span>(self : *GRID  ) <span class="tok-type">void</span> {</span>
<span class="line" id="L1536">    self.lignes = self.data.len ;</span>
<span class="line" id="L1537">    <span class="tok-kw">if</span> (self.lignes &lt; self.pageRows)  self.pages = <span class="tok-number">1</span></span>
<span class="line" id="L1538">    <span class="tok-kw">else</span> {</span>
<span class="line" id="L1539">      self.pages = self.lignes / (self.pageRows - <span class="tok-number">1</span>) ;</span>
<span class="line" id="L1540">      <span class="tok-kw">if</span>  (  <span class="tok-builtin">@rem</span>(self.lignes ,  (self.pageRows - <span class="tok-number">1</span>))  &gt; <span class="tok-number">0</span> ) self.pages += <span class="tok-number">1</span>;</span>
<span class="line" id="L1541">    }</span>
<span class="line" id="L1542">  }</span>
<span class="line" id="L1543"></span>
<span class="line" id="L1544"></span>
<span class="line" id="L1545">  <span class="tok-comment">// new GRID object </span>
</span>
<span class="line" id="L1546">  <span class="tok-comment">// Works like a panel with grid behavior</span>
</span>
<span class="line" id="L1547">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">initGrid</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> ,</span>
<span class="line" id="L1548">              vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>, </span>
<span class="line" id="L1549">              vpageRows : <span class="tok-type">usize</span> , <span class="tok-comment">// nbr ligne  + header</span>
</span>
<span class="line" id="L1550">              vseparator: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> ,</span>
<span class="line" id="L1551">              vcadre    : dds.CADRE</span>
<span class="line" id="L1552">              ) GRID {</span>
<span class="line" id="L1553"></span>
<span class="line" id="L1554"></span>
<span class="line" id="L1555">    <span class="tok-kw">var</span> xgrid = GRID{</span>
<span class="line" id="L1556">      .name  = vname,</span>
<span class="line" id="L1557">      .posx  = vposx,</span>
<span class="line" id="L1558">      .posy  = vposy,</span>
<span class="line" id="L1559">      .lines = vpageRows + <span class="tok-number">2</span> , <span class="tok-comment">//  row per page  + cadre </span>
</span>
<span class="line" id="L1560">      .cols  = <span class="tok-number">0</span>,              </span>
<span class="line" id="L1561">      .separator = vseparator ,</span>
<span class="line" id="L1562">      .pageRows = vpageRows,</span>
<span class="line" id="L1563">      .data = std.MultiArrayList(ArgData){},</span>
<span class="line" id="L1564">      .headers = std.ArrayList(CELL).init(allocator),</span>
<span class="line" id="L1565">      .actif = <span class="tok-null">true</span>,</span>
<span class="line" id="L1566">      .attribut = AtrGrid,</span>
<span class="line" id="L1567">      .atrTitle = AtrTitle,</span>
<span class="line" id="L1568">      .atrCell  = AtrCell,</span>
<span class="line" id="L1569">      .cadre = vcadre,</span>
<span class="line" id="L1570">      .lignes  = <span class="tok-number">0</span>,</span>
<span class="line" id="L1571">      .pages  = <span class="tok-number">0</span>,</span>
<span class="line" id="L1572">      .maxligne = <span class="tok-number">0</span>,</span>
<span class="line" id="L1573">      .cursligne  = <span class="tok-number">0</span>,</span>
<span class="line" id="L1574">      .curspage  = <span class="tok-number">1</span>,</span>
<span class="line" id="L1575"></span>
<span class="line" id="L1576">      .buf    = std.ArrayList(TERMINAL_CHAR).init(allocator)</span>
<span class="line" id="L1577">    };</span>
<span class="line" id="L1578"></span>
<span class="line" id="L1579">    <span class="tok-kw">return</span> xgrid ;</span>
<span class="line" id="L1580">  }</span>
<span class="line" id="L1581"></span>
<span class="line" id="L1582">  <span class="tok-comment">// return len header  ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1583">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span>  <span class="tok-fn">getLenHeaders</span>(self: *GRID) <span class="tok-type">usize</span> {</span>
<span class="line" id="L1584">    <span class="tok-kw">var</span> vlen :   <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1585"></span>
<span class="line" id="L1586">    <span class="tok-kw">for</span> (self.headers.items) | xcell | {</span>
<span class="line" id="L1587">      vlen += <span class="tok-number">1</span>; <span class="tok-comment">// separator</span>
</span>
<span class="line" id="L1588">      vlen += xcell.long;</span>
<span class="line" id="L1589">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,xcell.edtcar,<span class="tok-str">&quot;&quot;</span>) == <span class="tok-null">false</span> ) vlen += <span class="tok-number">1</span>;</span>
<span class="line" id="L1590">    }</span>
<span class="line" id="L1591">    vlen += <span class="tok-number">1</span>; <span class="tok-comment">// separator</span>
</span>
<span class="line" id="L1592">    <span class="tok-kw">return</span> vlen;</span>
<span class="line" id="L1593"></span>
<span class="line" id="L1594">  }</span>
<span class="line" id="L1595"></span>
<span class="line" id="L1596">  <span class="tok-comment">// return number items-header  ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1597">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">countColumns</span>(self :*GRID) <span class="tok-type">usize</span> {</span>
<span class="line" id="L1598">    <span class="tok-kw">return</span> self.headers.items.len;</span>
<span class="line" id="L1599">  }</span>
<span class="line" id="L1600"></span>
<span class="line" id="L1601">  <span class="tok-comment">// return number row-Data  ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1602">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">countRows</span>(self :*GRID) <span class="tok-type">usize</span> {</span>
<span class="line" id="L1603">    <span class="tok-kw">return</span> self.data.len;</span>
<span class="line" id="L1604">  }</span>
<span class="line" id="L1605"></span>
<span class="line" id="L1606">  <span class="tok-comment">// initialization CELL -header  ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1607">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setHeaders</span>(self : *GRID, vCell: std.ArrayList(CELL)) <span class="tok-type">void</span>  {</span>
<span class="line" id="L1608">    self.cols = <span class="tok-number">0</span>;</span>
<span class="line" id="L1609">    <span class="tok-kw">for</span> (vCell.items) |xcell| {</span>
<span class="line" id="L1610">      self.headers.append(xcell) <span class="tok-kw">catch</span>   {</span>
<span class="line" id="L1611">                                      std.debug.print(<span class="tok-str">&quot;append header err={}\n&quot;</span>, .{ErrForms.Invalide_append});</span>
<span class="line" id="L1612">                                      _= kbd.getKEY();</span>
<span class="line" id="L1613">                                    }; </span>
<span class="line" id="L1614">    }</span>
<span class="line" id="L1615">    self.cols += getLenHeaders(self) ;</span>
<span class="line" id="L1616">    <span class="tok-comment">// this.lines + 2 = cadre + header    cols + separator</span>
</span>
<span class="line" id="L1617">    <span class="tok-comment">// INIT doublebuffer</span>
</span>
<span class="line" id="L1618"></span>
<span class="line" id="L1619">    <span class="tok-kw">var</span> i:<span class="tok-type">usize</span> = (self.lines) * self.cols;</span>
<span class="line" id="L1620">    <span class="tok-kw">var</span> doublebuffer = TERMINAL_CHAR  { .ch =  <span class="tok-str">&quot; &quot;</span>,</span>
<span class="line" id="L1621">                                        .attribut = self.attribut,</span>
<span class="line" id="L1622">                                        .on = <span class="tok-null">false</span>};</span>
<span class="line" id="L1623">    <span class="tok-comment">// init matrix</span>
</span>
<span class="line" id="L1624">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L1625">        <span class="tok-kw">if</span> (i == <span class="tok-number">0</span>) <span class="tok-kw">break</span> ;</span>
<span class="line" id="L1626">        self.buf.append(doublebuffer) <span class="tok-kw">catch</span> {</span>
<span class="line" id="L1627">                std.debug.print(<span class="tok-str">&quot;setHeader doubleBuffererr={}\n&quot;</span>, .{ErrForms.Invalide_Grid_Buf});</span>
<span class="line" id="L1628">                _= kbd.getKEY();</span>
<span class="line" id="L1629">                };</span>
<span class="line" id="L1630">        i -=<span class="tok-number">1</span> ;</span>
<span class="line" id="L1631">    }</span>
<span class="line" id="L1632"></span>
<span class="line" id="L1633">  }</span>
<span class="line" id="L1634"></span>
<span class="line" id="L1635"></span>
<span class="line" id="L1636">  <span class="tok-comment">// return color </span>
</span>
<span class="line" id="L1637">  <span class="tok-kw">fn</span> <span class="tok-fn">toRefColor</span>(TextColor: dds.ForegroundColor) dds.ZONATRB {</span>
<span class="line" id="L1638">    <span class="tok-kw">var</span> vAtrCell = AtrCell ;</span>
<span class="line" id="L1639"></span>
<span class="line" id="L1640">    <span class="tok-kw">switch</span>(TextColor){</span>
<span class="line" id="L1641">      .fgdBlack   =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdBlack,</span>
<span class="line" id="L1642">      .fgdRed     =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdRed,</span>
<span class="line" id="L1643">      .fgdGreen   =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdGreen,</span>
<span class="line" id="L1644">      .fgdYellow  =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdYellow,</span>
<span class="line" id="L1645">      .fgdBlue    =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdBlue,</span>
<span class="line" id="L1646">      .fgdMagenta =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdMagenta,</span>
<span class="line" id="L1647">      .fgdCyan    =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdCyan,</span>
<span class="line" id="L1648">      .fgdWhite   =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgdWhite,</span>
<span class="line" id="L1649">    </span>
<span class="line" id="L1650">      .fgBlack   =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgBlack,</span>
<span class="line" id="L1651">      .fgRed     =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgRed,</span>
<span class="line" id="L1652">      .fgGreen   =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgGreen,</span>
<span class="line" id="L1653">      .fgYellow  =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgYellow,</span>
<span class="line" id="L1654">      .fgBlue    =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgBlue,</span>
<span class="line" id="L1655">      .fgMagenta =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgMagenta,</span>
<span class="line" id="L1656">      .fgCyan    =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgCyan,</span>
<span class="line" id="L1657">      .fgWhite   =&gt;  vAtrCell.foregr = dds.ForegroundColor.fgWhite   </span>
<span class="line" id="L1658">    }</span>
<span class="line" id="L1659">    <span class="tok-kw">return</span> vAtrCell;</span>
<span class="line" id="L1660">  }</span>
<span class="line" id="L1661"></span>
<span class="line" id="L1662">  <span class="tok-comment">// New  CELL  --&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1663">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newCell</span>(vtext: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>, vlong : <span class="tok-type">usize</span> , vreftyp: dds.REFTYP , TextColor: dds.ForegroundColor )  CELL {</span>
<span class="line" id="L1664"></span>
<span class="line" id="L1665">    <span class="tok-kw">var</span> nlong: <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1666">    <span class="tok-kw">if</span> (utl.nbrCharStr(vtext) &gt; vlong )  nlong = utl.nbrCharStr(vtext)</span>
<span class="line" id="L1667">    <span class="tok-kw">else</span> nlong = vlong;</span>
<span class="line" id="L1668"></span>
<span class="line" id="L1669"></span>
<span class="line" id="L1670"></span>
<span class="line" id="L1671">    <span class="tok-kw">var</span> cell = CELL {</span>
<span class="line" id="L1672">        .text   = vtext,</span>
<span class="line" id="L1673">        .reftyp = vreftyp,</span>
<span class="line" id="L1674">        .long   = nlong,</span>
<span class="line" id="L1675">        .posy   = <span class="tok-number">0</span>,</span>
<span class="line" id="L1676">        .edtcar = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L1677">        .atrCell = toRefColor(TextColor)</span>
<span class="line" id="L1678">      };</span>
<span class="line" id="L1679"></span>
<span class="line" id="L1680">      <span class="tok-kw">return</span> cell ;</span>
<span class="line" id="L1681">  }</span>
<span class="line" id="L1682"></span>
<span class="line" id="L1683">  <span class="tok-comment">// Set Char  -cell ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1684">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setCellEditCar</span>(self :  *CELL , vedtcar :[] <span class="tok-kw">const</span> <span class="tok-type">u8</span> ) <span class="tok-type">void</span> {</span>
<span class="line" id="L1685">    self.edtcar = vedtcar;</span>
<span class="line" id="L1686">  }</span>
<span class="line" id="L1687"></span>
<span class="line" id="L1688">  <span class="tok-comment">// return len  -cell ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1689">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getcellLen</span>(cell : *CELL) <span class="tok-type">usize</span> {</span>
<span class="line" id="L1690">    <span class="tok-kw">return</span> cell.long;</span>
<span class="line" id="L1691">  }</span>
<span class="line" id="L1692"></span>
<span class="line" id="L1693">  <span class="tok-comment">// return name  -header ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1694">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getHeadersText</span>(self: *GRID, r :<span class="tok-type">usize</span> ) [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1695">    <span class="tok-kw">return</span>  self.header.items[r].text;</span>
<span class="line" id="L1696">  }</span>
<span class="line" id="L1697"></span>
<span class="line" id="L1698">  <span class="tok-comment">// return posy  -header ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1699">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getHeadersPosy</span>(self: *GRID,  r :<span class="tok-type">usize</span> ) <span class="tok-type">usize</span> {</span>
<span class="line" id="L1700">    <span class="tok-kw">return</span>  self.header.items[r].posy;</span>
<span class="line" id="L1701">  }</span>
<span class="line" id="L1702"></span>
<span class="line" id="L1703">  <span class="tok-comment">// return reference Type  -header ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1704">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getHeadersType</span>(self: *GRID,  r :<span class="tok-type">usize</span> ) dds.REFTYP {</span>
<span class="line" id="L1705">    <span class="tok-kw">return</span>  self.header.items[r].reftyp;</span>
<span class="line" id="L1706">  }</span>
<span class="line" id="L1707"></span>
<span class="line" id="L1708"></span>
<span class="line" id="L1709">  <span class="tok-comment">// return edit Char  -header ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1710">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getHeadersCar</span>(self: *GRID,  r :<span class="tok-type">usize</span> )  [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1711">    <span class="tok-kw">return</span>  self.header.items[r].edtcar;</span>
<span class="line" id="L1712">  }</span>
<span class="line" id="L1713"></span>
<span class="line" id="L1714">  <span class="tok-comment">// return Text  -data ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1715">  <span class="tok-comment">// get text from grid,rows (multiArray)</span>
</span>
<span class="line" id="L1716">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getRowsText</span>(self: *GRID,  r :<span class="tok-type">usize</span>, i:<span class="tok-type">usize</span> )  [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L1717">    <span class="tok-kw">return</span> self.data.items(.buf)[r].items[i];</span>
<span class="line" id="L1718">  }</span>
<span class="line" id="L1719"></span>
<span class="line" id="L1720"></span>
<span class="line" id="L1721"></span>
<span class="line" id="L1722">  <span class="tok-comment">// add row  -data ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1723">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">addRows</span>(self: *GRID,  vrows: []<span class="tok-kw">const</span> []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L1724">    <span class="tok-kw">const</span> vlist = std.ArrayList([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>);</span>
<span class="line" id="L1725">    <span class="tok-kw">var</span> m = vlist.init(allocator);</span>
<span class="line" id="L1726">    m.appendSlice(vrows) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L1727">    self.data.append(allocator ,.{.buf = m}) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L1728">    setPageGrid(self) ;</span>
<span class="line" id="L1729">  }</span>
<span class="line" id="L1730"></span>
<span class="line" id="L1731">  <span class="tok-comment">// delete row  -data ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1732">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">dltRows</span>(self: *GRID,  r :<span class="tok-type">usize</span> )  ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L1733">    <span class="tok-kw">if</span> ( r &lt; self.data.len )  {</span>
<span class="line" id="L1734">      self.data.orderedRemove(r);</span>
<span class="line" id="L1735">      setPageGrid(self) ;</span>
<span class="line" id="L1736">    }</span>
<span class="line" id="L1737">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.grd_dltRows_Index_invalide;</span>
<span class="line" id="L1738">  }</span>
<span class="line" id="L1739"></span>
<span class="line" id="L1740">  <span class="tok-comment">// reset row data  -GRID ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1741">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">resetRows</span>(self: *GRID) <span class="tok-type">void</span> {</span>
<span class="line" id="L1742">    self.data.deinit(allocator);</span>
<span class="line" id="L1743">    self.data = std.MultiArrayList(ArgData){};</span>
<span class="line" id="L1744">    self.lignes  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1745">    self.pages  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1746">    self.maxligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L1747">    self.cursligne  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1748">    self.curspage  = <span class="tok-number">1</span>;</span>
<span class="line" id="L1749">  }</span>
<span class="line" id="L1750"></span>
<span class="line" id="L1751">  <span class="tok-comment">// reset -GRID ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1752">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">resetGrid</span>(self: *GRID) <span class="tok-type">void</span> {</span>
<span class="line" id="L1753">    self.name  = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1754">    self.posx  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1755">    self.posy  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1756">    self.lines = <span class="tok-number">0</span>;</span>
<span class="line" id="L1757">    self.cols  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1758">    self.separator = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1759">    self.pageRows = <span class="tok-number">0</span>;</span>
<span class="line" id="L1760">    self.data.deinit();</span>
<span class="line" id="L1761">    self.headers.deinit();</span>
<span class="line" id="L1762">    self.lignes  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1763">    self.pages  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1764">    self.maxligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L1765">    self.cursligne  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1766">    self.curspage  = <span class="tok-number">0</span>;</span>
<span class="line" id="L1767">  }</span>
<span class="line" id="L1768"></span>
<span class="line" id="L1769">  <span class="tok-comment">// assign -Box(fram) MATRIX TERMINAL  ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1770">  <span class="tok-kw">fn</span> <span class="tok-fn">GridBox</span>(self: *GRID ) <span class="tok-type">void</span> {</span>
<span class="line" id="L1771"></span>
<span class="line" id="L1772">    <span class="tok-kw">if</span> (dds.CADRE.line0 == self.cadre ) <span class="tok-kw">return</span>;</span>
<span class="line" id="L1773"></span>
<span class="line" id="L1774">    <span class="tok-kw">const</span> ACS_Hlines  = <span class="tok-str">&quot;─&quot;</span>;</span>
<span class="line" id="L1775">    <span class="tok-kw">const</span> ACS_Vlines  = <span class="tok-str">&quot;│&quot;</span>;</span>
<span class="line" id="L1776">    <span class="tok-kw">const</span> ACS_UCLEFT  = <span class="tok-str">&quot;┌&quot;</span>;</span>
<span class="line" id="L1777">    <span class="tok-kw">const</span> ACS_UCRIGHT = <span class="tok-str">&quot;┐&quot;</span>;</span>
<span class="line" id="L1778">    <span class="tok-kw">const</span> ACS_LCLEFT  = <span class="tok-str">&quot;└&quot;</span>;</span>
<span class="line" id="L1779">    <span class="tok-kw">const</span> ACS_LCRIGHT = <span class="tok-str">&quot;┘&quot;</span>;</span>
<span class="line" id="L1780"></span>
<span class="line" id="L1781">    <span class="tok-kw">const</span> ACS_Hline2    = <span class="tok-str">&quot;═&quot;</span>;</span>
<span class="line" id="L1782">    <span class="tok-kw">const</span> ACS_Vline2    = <span class="tok-str">&quot;║&quot;</span>;</span>
<span class="line" id="L1783">    <span class="tok-kw">const</span> ACS_UCLEFT2   = <span class="tok-str">&quot;╔&quot;</span>;</span>
<span class="line" id="L1784">    <span class="tok-kw">const</span> ACS_UCRIGHT2  = <span class="tok-str">&quot;╗&quot;</span>;</span>
<span class="line" id="L1785">    <span class="tok-kw">const</span> ACS_LCLEFT2   = <span class="tok-str">&quot;╚&quot;</span>;</span>
<span class="line" id="L1786">    <span class="tok-kw">const</span> ACS_LCRIGHT2  = <span class="tok-str">&quot;╝&quot;</span>;</span>
<span class="line" id="L1787"></span>
<span class="line" id="L1788">    <span class="tok-kw">var</span> trait: []<span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1789">    <span class="tok-kw">var</span> edt :<span class="tok-type">bool</span>   = <span class="tok-null">undefined</span> ;</span>
<span class="line" id="L1790"></span>
<span class="line" id="L1791">    <span class="tok-kw">var</span> row:  <span class="tok-type">usize</span> = <span class="tok-number">1</span> ;</span>
<span class="line" id="L1792">    <span class="tok-kw">var</span> y:    <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1793">    <span class="tok-kw">var</span> col:  <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1794">    <span class="tok-kw">var</span> cols: <span class="tok-type">usize</span> = getLenHeaders(self);</span>
<span class="line" id="L1795"></span>
<span class="line" id="L1796">    <span class="tok-kw">var</span> n:    <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1797">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = self.posx - <span class="tok-number">1</span> ;</span>
<span class="line" id="L1798"></span>
<span class="line" id="L1799">    <span class="tok-kw">while</span> (row &lt;= self.lines) {</span>
<span class="line" id="L1800">      y = self.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L1801">      col = <span class="tok-number">1</span>;</span>
<span class="line" id="L1802">      <span class="tok-kw">while</span> ( col &lt;= cols ){</span>
<span class="line" id="L1803">        edt = <span class="tok-null">false</span>;</span>
<span class="line" id="L1804">        <span class="tok-kw">if</span> (row == <span class="tok-number">1</span>) {</span>
<span class="line" id="L1805">            <span class="tok-kw">if</span> (col == <span class="tok-number">1</span>) {</span>
<span class="line" id="L1806">              <span class="tok-kw">if</span> ( dds.CADRE.line1 == self.cadre ) {</span>
<span class="line" id="L1807">                  trait = ACS_UCLEFT;</span>
<span class="line" id="L1808">              } <span class="tok-kw">else</span>  trait = ACS_UCLEFT2 ;</span>
<span class="line" id="L1809">              edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1810">            }</span>
<span class="line" id="L1811">            <span class="tok-kw">if</span> ( col == cols ) {</span>
<span class="line" id="L1812">              <span class="tok-kw">if</span> (dds.CADRE.line1 == self.cadre) {</span>
<span class="line" id="L1813">                trait = ACS_UCRIGHT;</span>
<span class="line" id="L1814">              } <span class="tok-kw">else</span>  trait = ACS_UCRIGHT2 ;</span>
<span class="line" id="L1815">              edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1816">            }</span>
<span class="line" id="L1817">            <span class="tok-kw">if</span> ( col &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> col &lt; cols ) {</span>
<span class="line" id="L1818">              <span class="tok-kw">if</span> (dds.CADRE.line1 == self.cadre ) {</span>
<span class="line" id="L1819">                trait = ACS_Hlines;</span>
<span class="line" id="L1820">              } <span class="tok-kw">else</span>  trait = ACS_Hline2;</span>
<span class="line" id="L1821">              edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1822">            }</span>
<span class="line" id="L1823">        } <span class="tok-kw">else</span> <span class="tok-kw">if</span> ( row == self.lines ) {</span>
<span class="line" id="L1824">            <span class="tok-kw">if</span> (col == <span class="tok-number">1</span>) {</span>
<span class="line" id="L1825">              <span class="tok-kw">if</span> ( dds.CADRE.line1 == self.cadre ) {</span>
<span class="line" id="L1826">                trait = ACS_LCLEFT;</span>
<span class="line" id="L1827">              } <span class="tok-kw">else</span>  trait = ACS_LCLEFT2;</span>
<span class="line" id="L1828">              edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1829">            }</span>
<span class="line" id="L1830">            <span class="tok-kw">if</span> ( col == cols ) {</span>
<span class="line" id="L1831">              <span class="tok-kw">if</span> ( dds.CADRE.line1 == self.cadre ) {</span>
<span class="line" id="L1832">                trait = ACS_LCRIGHT;</span>
<span class="line" id="L1833">              } <span class="tok-kw">else</span>  trait = ACS_LCRIGHT2 ;</span>
<span class="line" id="L1834">              edt = <span class="tok-null">true</span> ;</span>
<span class="line" id="L1835">            }</span>
<span class="line" id="L1836">            <span class="tok-kw">if</span> ( col &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> col &lt; cols ) {</span>
<span class="line" id="L1837">              <span class="tok-kw">if</span> ( dds.CADRE.line1 == self.cadre ) {</span>
<span class="line" id="L1838">                trait = ACS_Hlines;</span>
<span class="line" id="L1839">              } <span class="tok-kw">else</span>  trait = ACS_Hline2 ;</span>
<span class="line" id="L1840">              edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1841">            }</span>
<span class="line" id="L1842">        } <span class="tok-kw">else</span> <span class="tok-kw">if</span> ( row &gt; <span class="tok-number">1</span> <span class="tok-kw">and</span> row &lt; self.lines ) {</span>
<span class="line" id="L1843">          <span class="tok-kw">if</span> ( col == <span class="tok-number">1</span> <span class="tok-kw">or</span> col == cols ) {</span>
<span class="line" id="L1844">            <span class="tok-kw">if</span> ( dds.CADRE.line1 == self.cadre ) {</span>
<span class="line" id="L1845">              trait = ACS_Vlines;</span>
<span class="line" id="L1846">            } <span class="tok-kw">else</span> trait = ACS_Vline2 ;</span>
<span class="line" id="L1847">            edt = <span class="tok-null">true</span>;</span>
<span class="line" id="L1848">          }</span>
<span class="line" id="L1849">        }</span>
<span class="line" id="L1850">        <span class="tok-kw">if</span>  ( edt ) {</span>
<span class="line" id="L1851">            self.buf.items[n].ch = trait ;</span>
<span class="line" id="L1852">            self.buf.items[n].attribut = self.attribut;</span>
<span class="line" id="L1853">            self.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L1854">        }</span>
<span class="line" id="L1855">        n +=<span class="tok-number">1</span>;</span>
<span class="line" id="L1856">        y += <span class="tok-number">1</span>;</span>
<span class="line" id="L1857">        col += <span class="tok-number">1</span>;</span>
<span class="line" id="L1858">      }</span>
<span class="line" id="L1859">      x += <span class="tok-number">1</span>;</span>
<span class="line" id="L1860">      row +=<span class="tok-number">1</span> ;</span>
<span class="line" id="L1861">    }</span>
<span class="line" id="L1862">  }</span>
<span class="line" id="L1863"></span>
<span class="line" id="L1864">  <span class="tok-comment">// assign and display -header MATRIX TERMINAL  ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1865">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printGridHeader</span>(self: *GRID) <span class="tok-type">void</span> {</span>
<span class="line" id="L1866">    <span class="tok-kw">if</span> (self.actif == <span class="tok-null">false</span>)  <span class="tok-kw">return</span>;</span>
<span class="line" id="L1867">    <span class="tok-kw">var</span> buf : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1868">    <span class="tok-kw">const</span> Blanc = <span class="tok-str">&quot; &quot;</span>;</span>
<span class="line" id="L1869">    <span class="tok-kw">var</span> pos : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1870">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> =<span class="tok-number">0</span>;</span>
<span class="line" id="L1871">    <span class="tok-kw">for</span> (self.headers.items) |_| {</span>
<span class="line" id="L1872">      self.headers.items[idx].posy =pos;</span>
<span class="line" id="L1873">      <span class="tok-kw">if</span> (self.headers.items[idx].edtcar.len == <span class="tok-number">0</span>) pos = pos +  self.headers.items[idx].long  + <span class="tok-number">1</span></span>
<span class="line" id="L1874">      <span class="tok-kw">else</span>  pos = pos + self.headers.items[idx].long  + <span class="tok-number">1</span>  + <span class="tok-number">1</span>;</span>
<span class="line" id="L1875">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L1876">    }</span>
<span class="line" id="L1877"></span>
<span class="line" id="L1878">    <span class="tok-kw">for</span> (self.headers.items) |cellx| {</span>
<span class="line" id="L1879">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,cellx.edtcar , <span class="tok-str">&quot;&quot;</span>) == <span class="tok-null">true</span> )</span>
<span class="line" id="L1880">        buf = std.fmt.allocPrint(allocator,</span>
<span class="line" id="L1881">          <span class="tok-str">&quot;{s}{s}{s}&quot;</span>, .{ buf,self.separator, utl.alignStr(<span class="tok-str">&quot; &quot;</span>,dds.ALIGNS.left,cellx.long) }) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span></span>
<span class="line" id="L1882">      <span class="tok-kw">else</span></span>
<span class="line" id="L1883">        buf = std.fmt.allocPrint(allocator,</span>
<span class="line" id="L1884">          <span class="tok-str">&quot;{s}{s}{s}{s}&quot;</span>, .{ buf,self.separator, utl.alignStr(<span class="tok-str">&quot; &quot;</span>,dds.ALIGNS.left,cellx.long),Blanc }) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L1885">    }</span>
<span class="line" id="L1886">    buf = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;{s}{s}&quot;</span>, .{ buf,self.separator}) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L1887"></span>
<span class="line" id="L1888">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = <span class="tok-number">1</span>;</span>
<span class="line" id="L1889">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1890">    <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1891"></span>
<span class="line" id="L1892">    <span class="tok-kw">while</span> (x &lt;= self.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1893">      y = <span class="tok-number">1</span>;</span>
<span class="line" id="L1894">      <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(buf);</span>
<span class="line" id="L1895">      <span class="tok-kw">while</span> (iter.next()) |ch| : ( n += <span class="tok-number">1</span> ) {</span>
<span class="line" id="L1896">          self.buf.items[n].ch = ch;</span>
<span class="line" id="L1897">          self.buf.items[n].attribut  = self.attribut;</span>
<span class="line" id="L1898">          self.buf.items[n].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L1899">      }</span>
<span class="line" id="L1900"></span>
<span class="line" id="L1901">    }</span>
<span class="line" id="L1902"></span>
<span class="line" id="L1903">    buf =<span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1904">    <span class="tok-kw">for</span> (self.headers.items) |cellx| {</span>
<span class="line" id="L1905">      <span class="tok-kw">if</span> ( cellx.reftyp  == dds.REFTYP.UDIGIT <span class="tok-kw">or</span></span>
<span class="line" id="L1906">        cellx.reftyp == dds.REFTYP.DIGIT <span class="tok-kw">or</span></span>
<span class="line" id="L1907">        cellx.reftyp == dds.REFTYP.UDECIMAL <span class="tok-kw">or</span></span>
<span class="line" id="L1908">        cellx.reftyp == dds.REFTYP.DECIMAL)</span>
<span class="line" id="L1909"></span>
<span class="line" id="L1910">          buf = std.fmt.allocPrint(allocator,</span>
<span class="line" id="L1911">          <span class="tok-str">&quot;{s}{s}{s}&quot;</span>, .{ buf,self.separator, utl.alignStr(cellx.text,dds.ALIGNS.rigth,cellx.long) }) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span></span>
<span class="line" id="L1912"></span>
<span class="line" id="L1913">      <span class="tok-kw">else</span> buf = std.fmt.allocPrint(</span>
<span class="line" id="L1914">          allocator,</span>
<span class="line" id="L1915">          <span class="tok-str">&quot;{s}{s}{s}&quot;</span>, .{ buf,self.separator, utl.alignStr(cellx.text,dds.ALIGNS.left,cellx.long) }) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L1916"></span>
<span class="line" id="L1917">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,cellx.edtcar , <span class="tok-str">&quot;&quot;</span>) == <span class="tok-null">false</span> ) buf = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;{s}{s}&quot;</span>, .{ buf,Blanc}) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L1918">    }</span>
<span class="line" id="L1919"></span>
<span class="line" id="L1920">    n = getLenHeaders(self);</span>
<span class="line" id="L1921">    <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(buf);</span>
<span class="line" id="L1922">    <span class="tok-kw">while</span> (iter.next()) |ch| : ( n += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1923">      self.buf.items[n].ch = ch;</span>
<span class="line" id="L1924">      self.buf.items[n].attribut  = self.atrTitle;</span>
<span class="line" id="L1925">      self.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L1926">    }</span>
<span class="line" id="L1927"></span>
<span class="line" id="L1928">    <span class="tok-comment">// this.lines + 2 = cadre + header</span>
</span>
<span class="line" id="L1929">    GridBox(self );</span>
<span class="line" id="L1930"></span>
<span class="line" id="L1931">    x = <span class="tok-number">1</span>;</span>
<span class="line" id="L1932">    y = <span class="tok-number">0</span>;</span>
<span class="line" id="L1933">    n = <span class="tok-number">0</span>;</span>
<span class="line" id="L1934">    <span class="tok-kw">while</span> (x &lt;= self.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1935">      y = <span class="tok-number">1</span>;</span>
<span class="line" id="L1936">      <span class="tok-kw">while</span> (y &lt;= getLenHeaders(self)) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1937">        term.gotoXY(x + self.posx - <span class="tok-number">1</span>  , y + self.posy - <span class="tok-number">1</span> );</span>
<span class="line" id="L1938">        term.writeStyled(self.buf.items[n].ch,self.buf.items[n].attribut);</span>
<span class="line" id="L1939">        n += <span class="tok-number">1</span>;</span>
<span class="line" id="L1940">      }</span>
<span class="line" id="L1941">    }</span>
<span class="line" id="L1942"></span>
<span class="line" id="L1943">  }</span>
<span class="line" id="L1944"></span>
<span class="line" id="L1945"></span>
<span class="line" id="L1946">  <span class="tok-comment">// assign and display -data MATRIX TERMINAL  ---&gt; arraylist panel-grid</span>
</span>
<span class="line" id="L1947">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printGridRows</span>(self: *GRID) <span class="tok-type">void</span> {</span>
<span class="line" id="L1948">    <span class="tok-kw">if</span> (self.actif == <span class="tok-null">false</span>)  <span class="tok-kw">return</span>;</span>
<span class="line" id="L1949">    <span class="tok-kw">var</span> nposy : <span class="tok-type">usize</span> =  (getLenHeaders(self) * <span class="tok-number">2</span>) + <span class="tok-number">1</span>;</span>
<span class="line" id="L1950">    <span class="tok-kw">var</span> n : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1951">    <span class="tok-kw">var</span> x : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1952">    <span class="tok-kw">var</span> y : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1953">    <span class="tok-kw">var</span> h : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1954">    <span class="tok-kw">var</span> nColumns : <span class="tok-type">usize</span> = countColumns(self) ;</span>
<span class="line" id="L1955">    <span class="tok-kw">var</span> start : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L1956">    <span class="tok-kw">var</span> l : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1957">    <span class="tok-kw">var</span> buf : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1958">    <span class="tok-kw">var</span> bufItems : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L1959">    self.maxligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L1960">    <span class="tok-kw">if</span> (self.curspage == <span class="tok-number">0</span>)  start = <span class="tok-number">0</span></span>
<span class="line" id="L1961">    <span class="tok-kw">else</span>  start = (self.pageRows - <span class="tok-number">1</span> ) * (self.curspage - <span class="tok-number">1</span> ) ;</span>
<span class="line" id="L1962">    <span class="tok-kw">var</span> r: <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L1963">    <span class="tok-kw">while</span> (r &lt; self.pageRows - <span class="tok-number">1</span>) : (r += <span class="tok-number">1</span> ) {</span>
<span class="line" id="L1964">      l = r + start ;</span>
<span class="line" id="L1965">      <span class="tok-kw">if</span> (l &lt; self.lignes)  {</span>
<span class="line" id="L1966">        self.maxligne = r;</span>
<span class="line" id="L1967">        h= <span class="tok-number">0</span>;</span>
<span class="line" id="L1968">        <span class="tok-kw">while</span> (h &lt; nColumns ) : (h += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1969"></span>
<span class="line" id="L1970"></span>
<span class="line" id="L1971">          <span class="tok-comment">// formatage buffer</span>
</span>
<span class="line" id="L1972">          bufItems  = self.data.items(.buf)[l].items[h];</span>
<span class="line" id="L1973"></span>
<span class="line" id="L1974">          buf  = padingCell(bufItems, self.headers.items[h]);</span>
<span class="line" id="L1975"></span>
<span class="line" id="L1976">          </span>
<span class="line" id="L1977">          <span class="tok-comment">// write matrice </span>
</span>
<span class="line" id="L1978">          <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(buf);</span>
<span class="line" id="L1979">            n = nposy + self.headers.items[h].posy;</span>
<span class="line" id="L1980">            <span class="tok-kw">while</span> (iter.next()) |ch| : ( n += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1981">              self.buf.items[n].ch = ch;           </span>
<span class="line" id="L1982">              <span class="tok-kw">if</span> (self.cursligne == l <span class="tok-kw">or</span> self.cursligne == r) self.buf.items[n].attribut = AtrCellBar</span>
<span class="line" id="L1983">              <span class="tok-kw">else</span>  self.buf.items[n].attribut = self.headers.items[h].atrCell; </span>
<span class="line" id="L1984">              self.buf.items[n].on = <span class="tok-null">true</span>;     </span>
<span class="line" id="L1985">            }</span>
<span class="line" id="L1986">          </span>
<span class="line" id="L1987">        }</span>
<span class="line" id="L1988">      nposy = nposy + self.cols ;</span>
<span class="line" id="L1989">        </span>
<span class="line" id="L1990">      }</span>
<span class="line" id="L1991">    }  </span>
<span class="line" id="L1992"></span>
<span class="line" id="L1993">    x = <span class="tok-number">1</span>;</span>
<span class="line" id="L1994">    y = <span class="tok-number">0</span>;</span>
<span class="line" id="L1995">    n = <span class="tok-number">0</span>;</span>
<span class="line" id="L1996">    <span class="tok-kw">while</span> (x &lt;= self.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1997">      y = <span class="tok-number">1</span>;</span>
<span class="line" id="L1998">      <span class="tok-kw">while</span> (y &lt;= self.cols ) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L1999">        term.gotoXY(x + self.posx - <span class="tok-number">1</span>  , y + self.posy - <span class="tok-number">1</span> );</span>
<span class="line" id="L2000">        term.writeStyled(self.buf.items[n].ch,self.buf.items[n].attribut);</span>
<span class="line" id="L2001">        n += <span class="tok-number">1</span>;</span>
<span class="line" id="L2002">      }</span>
<span class="line" id="L2003">    }</span>
<span class="line" id="L2004"></span>
<span class="line" id="L2005">  }</span>
<span class="line" id="L2006"></span>
<span class="line" id="L2007"></span>
<span class="line" id="L2008">  <span class="tok-comment">//----------------------------------------------------------------</span>
</span>
<span class="line" id="L2009">  <span class="tok-comment">// Management GRID enter = select  1..n 0 = abort (Escape)</span>
</span>
<span class="line" id="L2010">  <span class="tok-comment">// Turning on the mouse</span>
</span>
<span class="line" id="L2011">  <span class="tok-comment">// UP DOWn PageUP PageDown</span>
</span>
<span class="line" id="L2012">  <span class="tok-comment">// Automatic alignment based on the type reference</span>
</span>
<span class="line" id="L2013">  <span class="tok-comment">//----------------------------------------------------------------</span>
</span>
<span class="line" id="L2014">  </span>
<span class="line" id="L2015">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> GridSelect = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L2016">    Key: term.kbd ,</span>
<span class="line" id="L2017">    Buf : std.ArrayList([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>)</span>
<span class="line" id="L2018">  };</span>
<span class="line" id="L2019"></span>
<span class="line" id="L2020"></span>
<span class="line" id="L2021">  <span class="tok-comment">///------------------------------------</span></span>
<span class="line" id="L2022">  <span class="tok-comment">/// manual= on return pageUp/pageDown no select</span></span>
<span class="line" id="L2023">  <span class="tok-comment">/// esc = return no select</span></span>
<span class="line" id="L2024">  <span class="tok-comment">/// enter = return enter and line select </span></span>
<span class="line" id="L2025">  <span class="tok-comment">/// -----------------------------------</span></span>
<span class="line" id="L2026">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">ioGrid</span>(self: *GRID , manual: <span class="tok-type">bool</span>) GridSelect {</span>
<span class="line" id="L2027"></span>
<span class="line" id="L2028">    <span class="tok-kw">var</span> gSelect : GridSelect = .{</span>
<span class="line" id="L2029">      .Key = term.kbd.none,</span>
<span class="line" id="L2030">      .Buf = std.ArrayList([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>).init(allocator)</span>
<span class="line" id="L2031">    };</span>
<span class="line" id="L2032"></span>
<span class="line" id="L2033">    <span class="tok-kw">if</span> ( self.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> gSelect ; </span>
<span class="line" id="L2034"></span>
<span class="line" id="L2035">    gSelect.Key = term.kbd.none;</span>
<span class="line" id="L2036"></span>
<span class="line" id="L2037"></span>
<span class="line" id="L2038">    <span class="tok-kw">var</span> CountLigne : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L2039">    self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2040">    printGridHeader(self) ;</span>
<span class="line" id="L2041">    </span>
<span class="line" id="L2042">    term.cursHide();</span>
<span class="line" id="L2043">    term.onMouse();</span>
<span class="line" id="L2044"></span>
<span class="line" id="L2045"></span>
<span class="line" id="L2046">    <span class="tok-kw">var</span> grid_key : term.Keyboard = <span class="tok-null">undefined</span> ;</span>
<span class="line" id="L2047">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L2048">      </span>
<span class="line" id="L2049">      printGridRows(self);</span>
<span class="line" id="L2050">      </span>
<span class="line" id="L2051"></span>
<span class="line" id="L2052">      grid_key = kbd.getKEY() ;</span>
<span class="line" id="L2053">      <span class="tok-comment">// bar espace</span>
</span>
<span class="line" id="L2054">      <span class="tok-kw">if</span> (grid_key.Key == kbd.char <span class="tok-kw">and</span></span>
<span class="line" id="L2055">          std.mem.eql(<span class="tok-type">u8</span>,grid_key.Char,<span class="tok-str">&quot; &quot;</span> ) ) {grid_key.Key = kbd.enter; grid_key.Char =<span class="tok-str">&quot;&quot;</span>;}</span>
<span class="line" id="L2056"></span>
<span class="line" id="L2057">      <span class="tok-kw">if</span> (grid_key.Key == kbd.mouse) {</span>
<span class="line" id="L2058">        grid_key.Key = kbd.none;</span>
<span class="line" id="L2059"></span>
<span class="line" id="L2060">        <span class="tok-kw">if</span> (term.MouseInfo.scroll ) {  </span>
<span class="line" id="L2061">          <span class="tok-kw">switch</span> (term.MouseInfo.scrollDir) {</span>
<span class="line" id="L2062">            term.ScrollDirection.msUp =&gt;    grid_key.Key = kbd.up,</span>
<span class="line" id="L2063">            term.ScrollDirection.msDown =&gt;  grid_key.Key = kbd.down,</span>
<span class="line" id="L2064">            <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L2065">          }</span>
<span class="line" id="L2066">        }</span>
<span class="line" id="L2067">        <span class="tok-kw">else</span> {</span>
<span class="line" id="L2068">        </span>
<span class="line" id="L2069">          <span class="tok-kw">if</span> (term.MouseInfo.action == term.MouseAction.maReleased ) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L2070">  </span>
<span class="line" id="L2071">          <span class="tok-kw">switch</span> (term.MouseInfo.button) {</span>
<span class="line" id="L2072">            term.MouseButton.mbLeft     =&gt;  grid_key.Key = kbd.enter,</span>
<span class="line" id="L2073">            term.MouseButton.mbMiddle   =&gt;  grid_key.Key = kbd.enter,</span>
<span class="line" id="L2074">            term.MouseButton.mbRight    =&gt;  grid_key.Key = kbd.enter,</span>
<span class="line" id="L2075">            <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L2076">          }</span>
<span class="line" id="L2077">        }</span>
<span class="line" id="L2078">      }</span>
<span class="line" id="L2079"></span>
<span class="line" id="L2080">      <span class="tok-kw">switch</span> (grid_key.Key) {</span>
<span class="line" id="L2081">        .none =&gt; <span class="tok-kw">continue</span>,</span>
<span class="line" id="L2082">        .esc  =&gt; {</span>
<span class="line" id="L2083">          self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2084">          gSelect.Key = kbd.esc;</span>
<span class="line" id="L2085">          gSelect.Buf = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L2086">          term.offMouse();</span>
<span class="line" id="L2087">          <span class="tok-kw">return</span> gSelect;</span>
<span class="line" id="L2088">        },</span>
<span class="line" id="L2089">        .enter  =&gt;</span>
<span class="line" id="L2090">          <span class="tok-kw">if</span> (self.lignes &gt; <span class="tok-number">0</span> ) {</span>
<span class="line" id="L2091">            gSelect.Key = kbd.enter;</span>
<span class="line" id="L2092">            <span class="tok-kw">if</span> (self.curspage &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L2093">              CountLigne =  (self.pageRows - <span class="tok-number">1</span> ) * (self.curspage - <span class="tok-number">1</span> );</span>
<span class="line" id="L2094">              CountLigne += self.cursligne;</span>
<span class="line" id="L2095">            }</span>
<span class="line" id="L2096"></span>
<span class="line" id="L2097">            gSelect.Buf = self.data.items(.buf)[CountLigne];</span>
<span class="line" id="L2098">            term.offMouse();</span>
<span class="line" id="L2099">            self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2100">            <span class="tok-kw">return</span> gSelect;</span>
<span class="line" id="L2101">          },</span>
<span class="line" id="L2102">        .up     =&gt;</span>
<span class="line" id="L2103">          <span class="tok-kw">if</span> (CountLigne &gt; <span class="tok-number">0</span> ) {</span>
<span class="line" id="L2104">            CountLigne -= <span class="tok-number">1</span> ;</span>
<span class="line" id="L2105">            self.cursligne -= <span class="tok-number">1</span> ;</span>
<span class="line" id="L2106">          },</span>
<span class="line" id="L2107">        .down   =&gt;</span>
<span class="line" id="L2108">          <span class="tok-kw">if</span> (CountLigne &lt; self.maxligne) {</span>
<span class="line" id="L2109">            CountLigne += <span class="tok-number">1</span>;</span>
<span class="line" id="L2110">            self.cursligne += <span class="tok-number">1</span>;</span>
<span class="line" id="L2111">          },</span>
<span class="line" id="L2112">        .pageUp =&gt;</span>
<span class="line" id="L2113">          <span class="tok-kw">if</span> (self.curspage &gt; <span class="tok-number">1</span> ) {</span>
<span class="line" id="L2114">            self.curspage -=<span class="tok-number">1</span>;</span>
<span class="line" id="L2115">            self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2116">            CountLigne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2117">            printGridHeader(self);</span>
<span class="line" id="L2118">          }</span>
<span class="line" id="L2119">          <span class="tok-kw">else</span> {</span>
<span class="line" id="L2120">            <span class="tok-kw">if</span> (manual == <span class="tok-null">true</span>) {</span>
<span class="line" id="L2121">              self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2122">              gSelect.Key = kbd.pageUp;</span>
<span class="line" id="L2123">              gSelect.Buf = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L2124">              term.offMouse();</span>
<span class="line" id="L2125">              <span class="tok-kw">return</span> gSelect;</span>
<span class="line" id="L2126">            }</span>
<span class="line" id="L2127">          },</span>
<span class="line" id="L2128">        .pageDown =&gt;</span>
<span class="line" id="L2129">          <span class="tok-kw">if</span> (self.curspage &lt; self.pages ) {</span>
<span class="line" id="L2130">            self.curspage += <span class="tok-number">1</span>;</span>
<span class="line" id="L2131">            self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2132">            CountLigne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2133">            printGridHeader(self);</span>
<span class="line" id="L2134">          }</span>
<span class="line" id="L2135">          <span class="tok-kw">else</span> {</span>
<span class="line" id="L2136">            <span class="tok-kw">if</span> (manual == <span class="tok-null">true</span>) {</span>
<span class="line" id="L2137">              self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2138">              gSelect.Key = kbd.pageDown;</span>
<span class="line" id="L2139">              gSelect.Buf = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L2140">              term.offMouse();</span>
<span class="line" id="L2141">              <span class="tok-kw">return</span> gSelect;</span>
<span class="line" id="L2142">            }</span>
<span class="line" id="L2143">          },</span>
<span class="line" id="L2144">        <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L2145">      }</span>
<span class="line" id="L2146">    }</span>
<span class="line" id="L2147">  }</span>
<span class="line" id="L2148"></span>
<span class="line" id="L2149">  <span class="tok-comment">// idem iogrid with Static table data</span>
</span>
<span class="line" id="L2150">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">ioCombo</span>(self: *GRID , pos : <span class="tok-type">usize</span>) GridSelect {</span>
<span class="line" id="L2151"></span>
<span class="line" id="L2152">    <span class="tok-kw">var</span> CountLigne : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L2153"></span>
<span class="line" id="L2154">    <span class="tok-kw">var</span> gSelect : GridSelect = .{</span>
<span class="line" id="L2155">      .Key = term.kbd.none,</span>
<span class="line" id="L2156">      .Buf = std.ArrayList([]<span class="tok-kw">const</span> <span class="tok-type">u8</span>).init(allocator)</span>
<span class="line" id="L2157">    };</span>
<span class="line" id="L2158"></span>
<span class="line" id="L2159">    gSelect.Key = term.kbd.none;</span>
<span class="line" id="L2160">    <span class="tok-kw">if</span> ( self.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> gSelect ; </span>
<span class="line" id="L2161"></span>
<span class="line" id="L2162">    printGridHeader(self) ;</span>
<span class="line" id="L2163"></span>
<span class="line" id="L2164">    <span class="tok-kw">if</span> (pos == <span class="tok-number">0</span> )  self.cursligne = <span class="tok-number">0</span></span>
<span class="line" id="L2165">    <span class="tok-kw">else</span> { </span>
<span class="line" id="L2166">      <span class="tok-kw">var</span> r :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L2167">      <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L2168">      self.curspage = <span class="tok-number">1</span>;</span>
<span class="line" id="L2169">      <span class="tok-kw">while</span> (r &lt; self.lignes) : ( r +=<span class="tok-number">1</span> ) {</span>
<span class="line" id="L2170">        <span class="tok-kw">if</span> (n == self.pageRows - <span class="tok-number">1</span>) { self.curspage +=<span class="tok-number">1</span> ; n= <span class="tok-number">0</span>;}</span>
<span class="line" id="L2171">        <span class="tok-kw">if</span> (r == pos) {</span>
<span class="line" id="L2172">          self.cursligne = r;</span>
<span class="line" id="L2173">          <span class="tok-kw">break</span> ;</span>
<span class="line" id="L2174">        }</span>
<span class="line" id="L2175">        n += <span class="tok-number">1</span>;</span>
<span class="line" id="L2176">      }</span>
<span class="line" id="L2177">      <span class="tok-kw">if</span> ( self.curspage &gt; <span class="tok-number">1</span> ) </span>
<span class="line" id="L2178">        {</span>
<span class="line" id="L2179">          <span class="tok-kw">if</span> ( ((self.pageRows - <span class="tok-number">1</span>) *  (self.curspage - <span class="tok-number">1</span>  )) &lt; pos  )  CountLigne = <span class="tok-number">0</span></span>
<span class="line" id="L2180">          <span class="tok-kw">else</span> </span>
<span class="line" id="L2181">          CountLigne =  ( ( self.pageRows - <span class="tok-number">1</span> ) * (self.curspage - <span class="tok-number">1</span> ) ) - pos ;</span>
<span class="line" id="L2182">        }</span>
<span class="line" id="L2183">      <span class="tok-kw">else</span> CountLigne = pos;</span>
<span class="line" id="L2184">    }</span>
<span class="line" id="L2185"></span>
<span class="line" id="L2186">    term.cursHide();</span>
<span class="line" id="L2187">    term.onMouse();</span>
<span class="line" id="L2188"></span>
<span class="line" id="L2189">    <span class="tok-kw">var</span> grid_key : term.Keyboard = <span class="tok-null">undefined</span> ;</span>
<span class="line" id="L2190"></span>
<span class="line" id="L2191">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L2192"></span>
<span class="line" id="L2193">      printGridRows(self);</span>
<span class="line" id="L2194">      </span>
<span class="line" id="L2195"></span>
<span class="line" id="L2196">      grid_key = kbd.getKEY();</span>
<span class="line" id="L2197">            <span class="tok-comment">// bar espace</span>
</span>
<span class="line" id="L2198">      <span class="tok-kw">if</span> (grid_key.Key == kbd.char <span class="tok-kw">and</span></span>
<span class="line" id="L2199">          std.mem.eql(<span class="tok-type">u8</span>,grid_key.Char,<span class="tok-str">&quot; &quot;</span> ) ) {grid_key.Key = kbd.enter; grid_key.Char =<span class="tok-str">&quot;&quot;</span>;}</span>
<span class="line" id="L2200"></span>
<span class="line" id="L2201"></span>
<span class="line" id="L2202">      <span class="tok-kw">if</span> (grid_key.Key == kbd.mouse) {</span>
<span class="line" id="L2203">        grid_key.Key = kbd.none;</span>
<span class="line" id="L2204"></span>
<span class="line" id="L2205">        <span class="tok-kw">if</span> (term.MouseInfo.scroll ) {  </span>
<span class="line" id="L2206">          <span class="tok-kw">switch</span> (term.MouseInfo.scrollDir) {</span>
<span class="line" id="L2207">            term.ScrollDirection.msUp =&gt;    grid_key.Key = kbd.up,</span>
<span class="line" id="L2208">            term.ScrollDirection.msDown =&gt;  grid_key.Key = kbd.down,</span>
<span class="line" id="L2209">            <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L2210">          }</span>
<span class="line" id="L2211">        }</span>
<span class="line" id="L2212">        <span class="tok-kw">else</span> {</span>
<span class="line" id="L2213">        </span>
<span class="line" id="L2214">          <span class="tok-kw">if</span> (term.MouseInfo.action == term.MouseAction.maReleased ) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L2215">  </span>
<span class="line" id="L2216">          <span class="tok-kw">switch</span> (term.MouseInfo.button) {</span>
<span class="line" id="L2217">            term.MouseButton.mbLeft     =&gt;  grid_key.Key = kbd.enter,</span>
<span class="line" id="L2218">            term.MouseButton.mbMiddle   =&gt;  grid_key.Key = kbd.enter,</span>
<span class="line" id="L2219">            term.MouseButton.mbRight    =&gt;  grid_key.Key = kbd.enter,</span>
<span class="line" id="L2220">            <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L2221">          }</span>
<span class="line" id="L2222">        }</span>
<span class="line" id="L2223">      }</span>
<span class="line" id="L2224"></span>
<span class="line" id="L2225"></span>
<span class="line" id="L2226">      <span class="tok-kw">switch</span> (grid_key.Key) {</span>
<span class="line" id="L2227">        .none =&gt; <span class="tok-kw">continue</span>,</span>
<span class="line" id="L2228">        .esc =&gt; {</span>
<span class="line" id="L2229">          self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2230">          gSelect.Key = kbd.esc;</span>
<span class="line" id="L2231">          gSelect.Buf = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L2232">          term.offMouse();</span>
<span class="line" id="L2233">          <span class="tok-kw">return</span> gSelect;</span>
<span class="line" id="L2234">        },</span>
<span class="line" id="L2235">          .enter  =&gt;</span>
<span class="line" id="L2236">          <span class="tok-kw">if</span> (self.lignes &gt; <span class="tok-number">0</span> ) {</span>
<span class="line" id="L2237">            gSelect.Key = kbd.enter;</span>
<span class="line" id="L2238">            <span class="tok-kw">if</span> (self.curspage &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L2239">              <span class="tok-kw">var</span> vline =  (self.pageRows - <span class="tok-number">1</span> ) * (self.curspage - <span class="tok-number">1</span> );</span>
<span class="line" id="L2240">              CountLigne += vline;</span>
<span class="line" id="L2241">            }</span>
<span class="line" id="L2242"></span>
<span class="line" id="L2243">            gSelect.Buf = self.data.items(.buf)[CountLigne];</span>
<span class="line" id="L2244">            term.offMouse();</span>
<span class="line" id="L2245">            self.cursligne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2246">            <span class="tok-kw">return</span> gSelect;</span>
<span class="line" id="L2247">          },</span>
<span class="line" id="L2248">        .up     =&gt;</span>
<span class="line" id="L2249">          <span class="tok-kw">if</span> (CountLigne &gt; <span class="tok-number">0</span> ) {</span>
<span class="line" id="L2250">            CountLigne -= <span class="tok-number">1</span> ;</span>
<span class="line" id="L2251">            self.cursligne -= <span class="tok-number">1</span> ;</span>
<span class="line" id="L2252">          },</span>
<span class="line" id="L2253">        .down   =&gt;</span>
<span class="line" id="L2254">          <span class="tok-kw">if</span> (CountLigne &lt; self.maxligne) {</span>
<span class="line" id="L2255">            CountLigne += <span class="tok-number">1</span>;</span>
<span class="line" id="L2256">            self.cursligne += <span class="tok-number">1</span>;</span>
<span class="line" id="L2257">          },</span>
<span class="line" id="L2258">        .pageUp =&gt;</span>
<span class="line" id="L2259">          <span class="tok-kw">if</span> (self.curspage &gt; <span class="tok-number">1</span> ) {</span>
<span class="line" id="L2260">            self.curspage -=<span class="tok-number">1</span>;</span>
<span class="line" id="L2261">            self.cursligne = <span class="tok-number">0</span> ;</span>
<span class="line" id="L2262">            CountLigne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2263">            printGridHeader(self);</span>
<span class="line" id="L2264">          },</span>
<span class="line" id="L2265">        .pageDown =&gt;</span>
<span class="line" id="L2266">          <span class="tok-kw">if</span> (self.curspage &lt; self.pages ) {</span>
<span class="line" id="L2267">            self.curspage += <span class="tok-number">1</span>;</span>
<span class="line" id="L2268">            self.cursligne = <span class="tok-number">0</span> ;</span>
<span class="line" id="L2269">            CountLigne = <span class="tok-number">0</span>;</span>
<span class="line" id="L2270">            printGridHeader(self);</span>
<span class="line" id="L2271">          },</span>
<span class="line" id="L2272">        <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L2273">      }</span>
<span class="line" id="L2274"></span>
<span class="line" id="L2275">    }</span>
<span class="line" id="L2276">  }</span>
<span class="line" id="L2277">  <span class="tok-comment">// restor -panel  MATRIX to terminal ---&gt; arraylist panel-grid </span>
</span>
<span class="line" id="L2278">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">rstPanel</span>( vsrc : *GRID , vdst : *pnl.PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L2279">    <span class="tok-kw">if</span> (vdst.actif == <span class="tok-null">false</span>)  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L2280">    <span class="tok-kw">if</span> (vsrc.posx + vsrc.lines &gt; vdst.posx + vdst.lines  )  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L2281">    <span class="tok-kw">if</span> (vsrc.posy + vsrc.cols  &gt; vdst.posy + vdst.cols  )  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L2282">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L2283">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L2284">    <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L2285">    <span class="tok-kw">var</span> npos : <span class="tok-type">usize</span> =  vsrc.posx - vdst.posx;</span>
<span class="line" id="L2286">    <span class="tok-kw">while</span> (x &lt;= vsrc.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L2287">        n = vdst.cols * npos + vsrc.posy - vdst.posy  ;</span>
<span class="line" id="L2288">        y = <span class="tok-number">0</span>;</span>
<span class="line" id="L2289">        <span class="tok-kw">while</span> (y &lt;= vsrc.cols) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L2290">          term.gotoXY(x + vsrc.posx   , y + vsrc.posy  );</span>
<span class="line" id="L2291">          term.writeStyled(vdst.buf.items[n].ch,vdst.buf.items[n].attribut);</span>
<span class="line" id="L2292">          n += <span class="tok-number">1</span>;</span>
<span class="line" id="L2293">        }</span>
<span class="line" id="L2294">      npos += <span class="tok-number">1</span>;</span>
<span class="line" id="L2295">    }</span>
<span class="line" id="L2296">  }</span>
<span class="line" id="L2297">};</span>
<span class="line" id="L2298"></span>
<span class="line" id="L2299"></span>
<span class="line" id="L2300"><span class="tok-comment">// defined INPUT_FIELD</span>
</span>
<span class="line" id="L2301"><span class="tok-kw">pub</span> <span class="tok-kw">const</span>  fld = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L2302"></span>
<span class="line" id="L2303">  <span class="tok-comment">// define attribut default Fiel</span>
</span>
<span class="line" id="L2304">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrField : dds.ZONATRB = .{</span>
<span class="line" id="L2305">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2306">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2307">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2308">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L2309">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L2310">      .foregr = dds.ForegroundColor.fgWhite</span>
<span class="line" id="L2311">  };</span>
<span class="line" id="L2312"></span>
<span class="line" id="L2313">  <span class="tok-comment">// field not input</span>
</span>
<span class="line" id="L2314">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrNil : dds.ZONATRB = .{</span>
<span class="line" id="L2315">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L2316">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2317">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2318">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L2319">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L2320">      .foregr = dds.ForegroundColor.fgdWhite</span>
<span class="line" id="L2321">  };</span>
<span class="line" id="L2322"></span>
<span class="line" id="L2323">  <span class="tok-comment">// define attribut default func ioField</span>
</span>
<span class="line" id="L2324">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrIO : dds.ZONATRB = .{</span>
<span class="line" id="L2325">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleReverse),</span>
<span class="line" id="L2326">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2327">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2328">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L2329">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L2330">      .foregr = dds.ForegroundColor.fgWhite,</span>
<span class="line" id="L2331">  };</span>
<span class="line" id="L2332"></span>
<span class="line" id="L2333">  <span class="tok-comment">// define attribut default Field protect</span>
</span>
<span class="line" id="L2334">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrProtect : dds.ZONATRB = .{</span>
<span class="line" id="L2335">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleItalic),</span>
<span class="line" id="L2336">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2337">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2338">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L2339">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L2340">      .foregr = dds.ForegroundColor.fgCyan,</span>
<span class="line" id="L2341">  };</span>
<span class="line" id="L2342"></span>
<span class="line" id="L2343">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrCursor : dds.ZONATRB = .{</span>
<span class="line" id="L2344">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2345">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2346">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2347">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L2348">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L2349">      .foregr = dds.ForegroundColor.fgCyan,</span>
<span class="line" id="L2350">  };</span>
<span class="line" id="L2351"></span>
<span class="line" id="L2352"></span>
<span class="line" id="L2353">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> MsgErr : dds.ZONATRB = .{</span>
<span class="line" id="L2354">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2355">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2356">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L2357">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L2358">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L2359">      .foregr = dds.ForegroundColor.fgRed</span>
<span class="line" id="L2360">  };</span>
<span class="line" id="L2361"></span>
<span class="line" id="L2362">  <span class="tok-comment">/// define FIELD</span></span>
<span class="line" id="L2363">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> FIELD = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L2364">    name :  []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2365">    posx:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L2366">    posy:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L2367">    attribut:dds.ZONATRB,</span>
<span class="line" id="L2368">    atrProtect:dds.ZONATRB,</span>
<span class="line" id="L2369">    reftyp: dds.REFTYP,</span>
<span class="line" id="L2370">    width:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2371">    scal:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L2372">    nbrcar: <span class="tok-type">usize</span>,        <span class="tok-comment">// nbrcar DECIMAL = (precision+scale + 1'.' ) + 1 this signed || other nbrcar =  ALPA..DIGIT..</span>
</span>
<span class="line" id="L2373"></span>
<span class="line" id="L2374">    tofill: <span class="tok-type">bool</span>,          <span class="tok-comment">// tofill or FULL</span>
</span>
<span class="line" id="L2375">    protect: <span class="tok-type">bool</span>,        <span class="tok-comment">// only display</span>
</span>
<span class="line" id="L2376"></span>
<span class="line" id="L2377">    pading: <span class="tok-type">bool</span>,         <span class="tok-comment">// pading blank</span>
</span>
<span class="line" id="L2378">    edtcar: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,   <span class="tok-comment">// edtcar for monnaie		€ $ ¥ ₪ £ or %</span>
</span>
<span class="line" id="L2379"></span>
<span class="line" id="L2380">    regex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,    <span class="tok-comment">//contrôle regex</span>
</span>
<span class="line" id="L2381">    errmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,   <span class="tok-comment">//message this field</span>
</span>
<span class="line" id="L2382"></span>
<span class="line" id="L2383">    help: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,     <span class="tok-comment">//help this field</span>
</span>
<span class="line" id="L2384"></span>
<span class="line" id="L2385">    text: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2386">    zwitch: <span class="tok-type">bool</span>,         <span class="tok-comment">// CTRUE CFALSE</span>
</span>
<span class="line" id="L2387"></span>
<span class="line" id="L2388">    procfunc: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,  <span class="tok-comment">//name proc</span>
</span>
<span class="line" id="L2389"></span>
<span class="line" id="L2390">    proctask: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,  <span class="tok-comment">//name proc</span>
</span>
<span class="line" id="L2391"></span>
<span class="line" id="L2392">    actif:<span class="tok-type">bool</span>,</span>
<span class="line" id="L2393">  };</span>
<span class="line" id="L2394"></span>
<span class="line" id="L2395">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> myMouse : <span class="tok-type">bool</span> = <span class="tok-null">false</span> ;</span>
<span class="line" id="L2396"></span>
<span class="line" id="L2397">  <span class="tok-comment">// New Field String ---&gt; arraylist panel-label</span>
</span>
<span class="line" id="L2398">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2399">  <span class="tok-comment">// TEXT_FREE,</span>
</span>
<span class="line" id="L2400">  <span class="tok-comment">// ALPHA,</span>
</span>
<span class="line" id="L2401">  <span class="tok-comment">// ALPHA_UPPER,</span>
</span>
<span class="line" id="L2402">  <span class="tok-comment">// ALPHA_NUMERIC,</span>
</span>
<span class="line" id="L2403">  <span class="tok-comment">// ALPHA_NUMERIC_UPPER,</span>
</span>
<span class="line" id="L2404">  <span class="tok-comment">// ALPHA_FULL,</span>
</span>
<span class="line" id="L2405">  <span class="tok-comment">// PASSWORD,</span>
</span>
<span class="line" id="L2406">  <span class="tok-comment">// YES_NO,</span>
</span>
<span class="line" id="L2407">  <span class="tok-kw">fn</span> <span class="tok-fn">initFieldString</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2408">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2409">                    vreftyp: dds.REFTYP,</span>
<span class="line" id="L2410">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2411">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2412">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2413">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2414">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2415">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2416"></span>
<span class="line" id="L2417">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2418">        .name   = vname,</span>
<span class="line" id="L2419">        .posx   = vposx,</span>
<span class="line" id="L2420">        .posy   = vposy,</span>
<span class="line" id="L2421">        .reftyp = vreftyp,</span>
<span class="line" id="L2422">        .width  = vwidth,</span>
<span class="line" id="L2423">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2424">        .nbrcar = vwidth,</span>
<span class="line" id="L2425">        .tofill  = vtofill,</span>
<span class="line" id="L2426">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2427">        .pading  = <span class="tok-null">true</span>,</span>
<span class="line" id="L2428">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2429">        .regex  = vregex,</span>
<span class="line" id="L2430">        .errmsg = verrmsg,</span>
<span class="line" id="L2431">        .help   = vhelp,</span>
<span class="line" id="L2432">        .text   = vtext,</span>
<span class="line" id="L2433">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2434">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2435">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2436">        .attribut  = AtrField,</span>
<span class="line" id="L2437">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2438">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2439">    };</span>
<span class="line" id="L2440"></span>
<span class="line" id="L2441">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2442"></span>
<span class="line" id="L2443">  }</span>
<span class="line" id="L2444"></span>
<span class="line" id="L2445">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2446">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2447">  <span class="tok-comment">// .TEXT_FREE</span>
</span>
<span class="line" id="L2448">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldTextFree</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2449">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2450">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2451">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2452">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2453">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2454">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2455">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2456"></span>
<span class="line" id="L2457">    <span class="tok-kw">return</span> initFieldString(vname,  vposx, vposy,</span>
<span class="line" id="L2458">                          dds.REFTYP.TEXT_FREE,</span>
<span class="line" id="L2459">                          vwidth, vtext, vtofill, verrmsg, vhelp, vregex);</span>
<span class="line" id="L2460">  }</span>
<span class="line" id="L2461"></span>
<span class="line" id="L2462">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2463">  <span class="tok-comment">// letter numeric punct </span>
</span>
<span class="line" id="L2464">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2465">  <span class="tok-comment">// .TEXT_FULL</span>
</span>
<span class="line" id="L2466">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldTextFull</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2467">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2468">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2469">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2470">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2471">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2472">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2473">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2474"></span>
<span class="line" id="L2475">    <span class="tok-kw">return</span> initFieldString(vname,  vposx, vposy,</span>
<span class="line" id="L2476">                          dds.REFTYP.TEXT_FULL,</span>
<span class="line" id="L2477">                          vwidth, vtext, vtofill, verrmsg, vhelp, vregex);</span>
<span class="line" id="L2478">  }</span>
<span class="line" id="L2479"></span>
<span class="line" id="L2480">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2481">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2482">  <span class="tok-comment">// .ALPHA</span>
</span>
<span class="line" id="L2483">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldAlpha</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2484">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2485">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2486">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2487">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2488">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2489">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2490">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2491">    </span>
<span class="line" id="L2492">    <span class="tok-kw">return</span> initFieldString(vname,  vposx, vposy,</span>
<span class="line" id="L2493">                          dds.REFTYP.ALPHA,</span>
<span class="line" id="L2494">                          vwidth, vtext, vtofill, verrmsg, vhelp, vregex);</span>
<span class="line" id="L2495">  }</span>
<span class="line" id="L2496"></span>
<span class="line" id="L2497">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2498">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2499">  <span class="tok-comment">// .ALPHA_UPPER</span>
</span>
<span class="line" id="L2500">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldAlphaUpper</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2501">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2502">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2503">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2504">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2505">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2506">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2507">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2508"></span>
<span class="line" id="L2509">    <span class="tok-kw">return</span> initFieldString(vname,  vposx, vposy,</span>
<span class="line" id="L2510">                          dds.REFTYP.ALPHA_UPPER,</span>
<span class="line" id="L2511">                          vwidth, vtext, vtofill, verrmsg, vhelp, vregex);</span>
<span class="line" id="L2512">  }</span>
<span class="line" id="L2513"></span>
<span class="line" id="L2514">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2515">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2516">  <span class="tok-comment">// .ALPHA_NUMERIC</span>
</span>
<span class="line" id="L2517">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldAlphaNumeric</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2518">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2519">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2520">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2521">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2522">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2523">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2524">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2525"></span>
<span class="line" id="L2526">    <span class="tok-kw">return</span> initFieldString(vname,  vposx, vposy,</span>
<span class="line" id="L2527">                          dds.REFTYP.ALPHA_NUMERIC,</span>
<span class="line" id="L2528">                          vwidth, vtext, vtofill, verrmsg, vhelp, vregex);</span>
<span class="line" id="L2529">  }</span>
<span class="line" id="L2530"></span>
<span class="line" id="L2531">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2532">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2533">  <span class="tok-comment">// .ALPHA_NUMERIC</span>
</span>
<span class="line" id="L2534">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldAlphaNumericUpper</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2535">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2536">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2537">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2538">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2539">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2540">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2541">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2542"></span>
<span class="line" id="L2543">    <span class="tok-kw">return</span> initFieldString(vname,  vposx, vposy,</span>
<span class="line" id="L2544">                          dds.REFTYP.ALPHA_NUMERIC_UPPER,</span>
<span class="line" id="L2545">                          vwidth, vtext, vtofill, verrmsg, vhelp, vregex);</span>
<span class="line" id="L2546">  }</span>
<span class="line" id="L2547"></span>
<span class="line" id="L2548">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2549">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2550">  <span class="tok-comment">// .PASSWORD</span>
</span>
<span class="line" id="L2551">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldPassword</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2552">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2553">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2554">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2555">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2556">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2557">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2558">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2559"></span>
<span class="line" id="L2560">    <span class="tok-kw">return</span> initFieldString(vname,  vposx, vposy,</span>
<span class="line" id="L2561">                          dds.REFTYP.PASSWORD,</span>
<span class="line" id="L2562">                          vwidth, vtext, vtofill, verrmsg, vhelp, vregex);</span>
<span class="line" id="L2563">  }</span>
<span class="line" id="L2564"></span>
<span class="line" id="L2565">  <span class="tok-comment">// New Field String  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2566">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2567">  <span class="tok-comment">// .YES_NO</span>
</span>
<span class="line" id="L2568">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldYesNo</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2569">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2570">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2571">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2572">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2573">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2574"></span>
<span class="line" id="L2575"></span>
<span class="line" id="L2576">        <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2577">            .name   = vname,</span>
<span class="line" id="L2578">            .posx   = vposx,</span>
<span class="line" id="L2579">            .posy   = vposy,</span>
<span class="line" id="L2580">            .reftyp = dds.REFTYP.YES_NO ,</span>
<span class="line" id="L2581">            .width  = <span class="tok-number">1</span>,</span>
<span class="line" id="L2582">            .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2583">            .nbrcar = <span class="tok-number">1</span>,</span>
<span class="line" id="L2584">            .tofill  = vtofill,</span>
<span class="line" id="L2585">            .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2586">            .pading  = <span class="tok-null">false</span>,</span>
<span class="line" id="L2587">            .edtcar = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2588">            .regex  = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2589">            .errmsg = verrmsg,</span>
<span class="line" id="L2590">            .help   = vhelp,</span>
<span class="line" id="L2591">            .text   = vtext,</span>
<span class="line" id="L2592">            .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2593">            .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2594">            .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2595">            .attribut  = AtrField,</span>
<span class="line" id="L2596">            .atrProtect = AtrProtect,</span>
<span class="line" id="L2597">            .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2598">          };</span>
<span class="line" id="L2599">                    </span>
<span class="line" id="L2600">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;to validate Y or N &quot;</span> ;</span>
<span class="line" id="L2601"></span>
<span class="line" id="L2602">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2603">  }</span>
<span class="line" id="L2604"></span>
<span class="line" id="L2605">  <span class="tok-comment">// New Field Switch ---&gt; arraylist panel-field</span>
</span>
<span class="line" id="L2606">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2607">  <span class="tok-comment">// SWITCH,</span>
</span>
<span class="line" id="L2608">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldSwitch</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2609">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2610">                    vzwitch: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2611">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2612">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2613"></span>
<span class="line" id="L2614">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2615">        .name   = vname,</span>
<span class="line" id="L2616">        .posx   = vposx,</span>
<span class="line" id="L2617">        .posy   = vposy,</span>
<span class="line" id="L2618">        .reftyp = dds.REFTYP.SWITCH ,</span>
<span class="line" id="L2619">        .width  = <span class="tok-number">1</span>,</span>
<span class="line" id="L2620">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2621">        .nbrcar = <span class="tok-number">1</span>,</span>
<span class="line" id="L2622">        .tofill  = <span class="tok-null">false</span>,</span>
<span class="line" id="L2623">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2624">        .pading  = <span class="tok-null">false</span>,</span>
<span class="line" id="L2625">        .edtcar = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2626">        .regex  = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2627">        .errmsg = verrmsg,</span>
<span class="line" id="L2628">        .help   = vhelp,</span>
<span class="line" id="L2629">        .text   = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2630">        .zwitch = vzwitch,</span>
<span class="line" id="L2631">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2632">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2633">        .attribut  = AtrField,</span>
<span class="line" id="L2634">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2635">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2636">    };</span>
<span class="line" id="L2637"></span>
<span class="line" id="L2638">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;check ok= ✔ not= ◉  : Select espace bar &quot;</span> ;</span>
<span class="line" id="L2639"></span>
<span class="line" id="L2640">    <span class="tok-kw">if</span> (xfield.zwitch == <span class="tok-null">true</span> ) xfield.text = dds.STRUE</span>
<span class="line" id="L2641">    <span class="tok-kw">else</span> xfield.text = dds.SFALSE;</span>
<span class="line" id="L2642"></span>
<span class="line" id="L2643">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2644"></span>
<span class="line" id="L2645">  }</span>
<span class="line" id="L2646"></span>
<span class="line" id="L2647">  <span class="tok-comment">// New Field Date ---&gt; arraylist panel-field</span>
</span>
<span class="line" id="L2648">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2649">  <span class="tok-comment">// DATE_FR,</span>
</span>
<span class="line" id="L2650">  <span class="tok-comment">// regex fixe standard</span>
</span>
<span class="line" id="L2651">  <span class="tok-comment">// Control yyyy = 0001-9999 as well as the traditional MM 02 DAY 28 or 29 values</span>
</span>
<span class="line" id="L2652">  <span class="tok-comment">// I do not take into account the offset before 1500 ... etc.</span>
</span>
<span class="line" id="L2653">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldDateFR</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2654">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2655">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2656">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2657">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2658">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2659"></span>
<span class="line" id="L2660"></span>
<span class="line" id="L2661">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2662">        .name   = vname,</span>
<span class="line" id="L2663">        .posx   = vposx,</span>
<span class="line" id="L2664">        .posy   = vposy,</span>
<span class="line" id="L2665">        .reftyp = dds.REFTYP.DATE_FR,</span>
<span class="line" id="L2666">        .width  = <span class="tok-number">10</span>,</span>
<span class="line" id="L2667">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2668">        .nbrcar = <span class="tok-number">10</span>,</span>
<span class="line" id="L2669">        .tofill  = vtofill,</span>
<span class="line" id="L2670">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2671">        .pading  = <span class="tok-null">false</span>,</span>
<span class="line" id="L2672">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2673">        .regex  = <span class="tok-str">&quot;&quot;</span>,         </span>
<span class="line" id="L2674">        .errmsg = verrmsg,</span>
<span class="line" id="L2675">        .help   = vhelp,</span>
<span class="line" id="L2676">        .text   = vtext,</span>
<span class="line" id="L2677">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2678">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2679">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2680">        .attribut  = AtrField,</span>
<span class="line" id="L2681">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2682">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2683">    };</span>
<span class="line" id="L2684"></span>
<span class="line" id="L2685"></span>
<span class="line" id="L2686">    xfield.regex = <span class="tok-str">&quot;^(0[1-9]|[12][0-9]|3[01])[\\/](0[1-9]|1[012])[\\/][0-9]{4,4}$&quot;</span> ;</span>
<span class="line" id="L2687"></span>
<span class="line" id="L2688">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex: date DD/MM/YYYY&quot;</span> ;</span>
<span class="line" id="L2689"></span>
<span class="line" id="L2690">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2691"></span>
<span class="line" id="L2692">  }</span>
<span class="line" id="L2693"></span>
<span class="line" id="L2694">  <span class="tok-comment">// New Field Date ---&gt; arraylist panel-field</span>
</span>
<span class="line" id="L2695">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2696">  <span class="tok-comment">// DATE_US,</span>
</span>
<span class="line" id="L2697">  <span class="tok-comment">// regex fixe standard</span>
</span>
<span class="line" id="L2698">  <span class="tok-comment">// Control yyyy = 0001-9999 as well as the traditional MM 02 DAY 28 or 29 values</span>
</span>
<span class="line" id="L2699">  <span class="tok-comment">// I do not take into account the offset before 1500 ... etc.</span>
</span>
<span class="line" id="L2700">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldDateUS</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2701">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2702">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2703">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2704">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2705">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2706"></span>
<span class="line" id="L2707"></span>
<span class="line" id="L2708">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2709">        .name   = vname,</span>
<span class="line" id="L2710">        .posx   = vposx,</span>
<span class="line" id="L2711">        .posy   = vposy,</span>
<span class="line" id="L2712">        .reftyp = dds.REFTYP.DATE_US,</span>
<span class="line" id="L2713">        .width  = <span class="tok-number">10</span>,</span>
<span class="line" id="L2714">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2715">        .nbrcar = <span class="tok-number">10</span>,</span>
<span class="line" id="L2716">        .tofill  = vtofill,</span>
<span class="line" id="L2717">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2718">        .pading  = <span class="tok-null">false</span>,</span>
<span class="line" id="L2719">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2720">        .regex  = <span class="tok-str">&quot;&quot;</span>,         </span>
<span class="line" id="L2721">        .errmsg = verrmsg,</span>
<span class="line" id="L2722">        .help   = vhelp,</span>
<span class="line" id="L2723">        .text   = vtext,</span>
<span class="line" id="L2724">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2725">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2726">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2727">        .attribut  = AtrField,</span>
<span class="line" id="L2728">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2729">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2730">    };</span>
<span class="line" id="L2731"></span>
<span class="line" id="L2732">    xfield.regex = <span class="tok-str">&quot;^(0[1-9]|1[012])[\\/](0[1-9]|[12][0-9]|3[01])[\\/][0-9]{4,4}$&quot;</span> ;</span>
<span class="line" id="L2733"></span>
<span class="line" id="L2734">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex: date MM/DD/YYYY&quot;</span>;</span>
<span class="line" id="L2735"></span>
<span class="line" id="L2736">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2737"></span>
<span class="line" id="L2738">  }</span>
<span class="line" id="L2739"></span>
<span class="line" id="L2740"></span>
<span class="line" id="L2741">  <span class="tok-comment">// New Field Date ---&gt; arraylist panel-field</span>
</span>
<span class="line" id="L2742">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2743">  <span class="tok-comment">// DATE_ISO,</span>
</span>
<span class="line" id="L2744">  <span class="tok-comment">// regex fixe standard</span>
</span>
<span class="line" id="L2745">  <span class="tok-comment">// Control yyyy = 0001-9999 as well as the traditional MM 02 DAY 28 or 29 values</span>
</span>
<span class="line" id="L2746">  <span class="tok-comment">// I do not take into account the offset before 1500 ... etc.</span>
</span>
<span class="line" id="L2747">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldDateISO</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2748">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2749">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2750">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2751">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2752">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2753"></span>
<span class="line" id="L2754"></span>
<span class="line" id="L2755">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2756">        .name   = vname,</span>
<span class="line" id="L2757">        .posx   = vposx,</span>
<span class="line" id="L2758">        .posy   = vposy,</span>
<span class="line" id="L2759">        .reftyp = dds.REFTYP.DATE_ISO,</span>
<span class="line" id="L2760">        .width  = <span class="tok-number">10</span>,</span>
<span class="line" id="L2761">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2762">        .nbrcar = <span class="tok-number">10</span>,</span>
<span class="line" id="L2763">        .tofill  = vtofill,</span>
<span class="line" id="L2764">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2765">        .pading  = <span class="tok-null">false</span>,</span>
<span class="line" id="L2766">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2767">        .regex  = <span class="tok-str">&quot;&quot;</span>,         </span>
<span class="line" id="L2768">        .errmsg = verrmsg,</span>
<span class="line" id="L2769">        .help   = vhelp,</span>
<span class="line" id="L2770">        .text   = vtext,</span>
<span class="line" id="L2771">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2772">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2773">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2774">        .attribut  = AtrField,</span>
<span class="line" id="L2775">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2776">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2777">    };</span>
<span class="line" id="L2778"></span>
<span class="line" id="L2779"></span>
<span class="line" id="L2780">    xfield.regex = <span class="tok-str">&quot;^([0-9]{4,4})[-](0[1-9]|1[012])[-](0[1-9]|[12][0-9]|3[01])$&quot;</span> ;</span>
<span class="line" id="L2781"></span>
<span class="line" id="L2782">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>))  xfield.help = <span class="tok-str">&quot;ex: date YYYY-MM-DD&quot;</span> ;</span>
<span class="line" id="L2783"></span>
<span class="line" id="L2784">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2785"></span>
<span class="line" id="L2786">  }</span>
<span class="line" id="L2787"></span>
<span class="line" id="L2788"></span>
<span class="line" id="L2789">  <span class="tok-comment">// New Field Mail ---&gt; arraylist panel-field</span>
</span>
<span class="line" id="L2790">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2791">  <span class="tok-comment">// MAIL_ISO,</span>
</span>
<span class="line" id="L2792">  <span class="tok-comment">// regex fixe standard</span>
</span>
<span class="line" id="L2793">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldMail</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2794">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2795">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2796">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2797">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2798">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2799">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2800"></span>
<span class="line" id="L2801">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2802">        .name   = vname,</span>
<span class="line" id="L2803">        .posx   = vposx,</span>
<span class="line" id="L2804">        .posy   = vposy,</span>
<span class="line" id="L2805">        .reftyp = dds.REFTYP.MAIL_ISO,</span>
<span class="line" id="L2806">        .width  = vwidth,</span>
<span class="line" id="L2807">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2808">        .nbrcar = vwidth,</span>
<span class="line" id="L2809">        .tofill  = vtofill,</span>
<span class="line" id="L2810">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2811">        .pading  = <span class="tok-null">true</span>,</span>
<span class="line" id="L2812">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2813">        .regex  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2814">        .errmsg = verrmsg,</span>
<span class="line" id="L2815">        .help   = vhelp,</span>
<span class="line" id="L2816">        .text   = vtext,</span>
<span class="line" id="L2817">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2818">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2819">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2820">        .attribut  = AtrField,</span>
<span class="line" id="L2821">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2822">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2823">    };</span>
<span class="line" id="L2824"></span>
<span class="line" id="L2825"></span>
<span class="line" id="L2826">      <span class="tok-comment">// https://stackoverflow.com/questions/201323/how-can-i-validate-an-email-address-using-a-regular-expression</span>
</span>
<span class="line" id="L2827">      <span class="tok-comment">// chapitre RFC 6532 updates 5322 to allow and include full, clean UTF-8.</span>
</span>
<span class="line" id="L2828">      xfield.regex = <span class="tok-str">&quot;^([-!#-\'*+\\/-9=?A-Z^-~]{1,64}(\\.[-!#-\'*+\\/-9=?A-Z^-~]{1,64})*|\&quot;([]!#-[^-~ \t]|(\\[\t -~]))+\&quot;)@[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?(\\.[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?)+$&quot;</span>;</span>
<span class="line" id="L2829">      </span>
<span class="line" id="L2830">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex: myname.myfirstname@gmail.com&quot;</span> ;</span>
<span class="line" id="L2831">        </span>
<span class="line" id="L2832">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2833"></span>
<span class="line" id="L2834">  }</span>
<span class="line" id="L2835"></span>
<span class="line" id="L2836"></span>
<span class="line" id="L2837">  <span class="tok-comment">// New Field telephone ---&gt; arraylist panel-field</span>
</span>
<span class="line" id="L2838">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2839">  <span class="tok-comment">// TELEPHONE,</span>
</span>
<span class="line" id="L2840">  <span class="tok-comment">// regex fixe standard</span>
</span>
<span class="line" id="L2841">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldTelephone</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2842">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2843">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2844">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2845">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2846">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2847">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2848">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2849"></span>
<span class="line" id="L2850">      <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2851">        .name   = vname,</span>
<span class="line" id="L2852">        .posx   = vposx,</span>
<span class="line" id="L2853">        .posy   = vposy,</span>
<span class="line" id="L2854">        .reftyp = dds.REFTYP.TELEPHONE,</span>
<span class="line" id="L2855">        .width  = vwidth,</span>
<span class="line" id="L2856">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2857">        .nbrcar = vwidth,</span>
<span class="line" id="L2858">        .tofill  = vtofill,</span>
<span class="line" id="L2859">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2860">        .pading  = <span class="tok-null">true</span>,</span>
<span class="line" id="L2861">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2862">        .regex  = vregex,</span>
<span class="line" id="L2863">        .errmsg = verrmsg,</span>
<span class="line" id="L2864">        .help   = vhelp,</span>
<span class="line" id="L2865">        .text   = vtext,</span>
<span class="line" id="L2866">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2867">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2868">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2869">        .attribut  = AtrField,</span>
<span class="line" id="L2870">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2871">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2872">      };</span>
<span class="line" id="L2873"></span>
<span class="line" id="L2874">      <span class="tok-comment">// regex = fr</span>
</span>
<span class="line" id="L2875">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,xfield.regex,<span class="tok-str">&quot;&quot;</span>)) xfield.regex = </span>
<span class="line" id="L2876">      <span class="tok-str">&quot;^[+]{1,1}[(]{0,1}[0-9]{1,3}[)]([0-9]{1,3}){1,1}([-. ]?[0-9]{2,3}){2,4}$&quot;</span>;</span>
<span class="line" id="L2877">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex fr : +(33)6.12.131.141&quot;</span> ;</span>
<span class="line" id="L2878"></span>
<span class="line" id="L2879">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2880"></span>
<span class="line" id="L2881">  }</span>
<span class="line" id="L2882"></span>
<span class="line" id="L2883">  <span class="tok-comment">// New Field Digit  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2884">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2885">  <span class="tok-comment">// .DIGIT unsigned</span>
</span>
<span class="line" id="L2886">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldUDigit</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2887">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2888">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2889">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2890">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2891">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2892">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2893">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2894"></span>
<span class="line" id="L2895">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2896">        .name   = vname,</span>
<span class="line" id="L2897">        .posx   = vposx,</span>
<span class="line" id="L2898">        .posy   = vposy,</span>
<span class="line" id="L2899">        .reftyp = dds.REFTYP.UDIGIT,</span>
<span class="line" id="L2900">        .width  = vwidth,</span>
<span class="line" id="L2901">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2902">        .nbrcar = vwidth,</span>
<span class="line" id="L2903">        .tofill  = vtofill,</span>
<span class="line" id="L2904">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2905">        .pading  = <span class="tok-null">true</span>,</span>
<span class="line" id="L2906">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2907">        .regex  = vregex,</span>
<span class="line" id="L2908">        .errmsg = verrmsg,</span>
<span class="line" id="L2909">        .help   = vhelp,</span>
<span class="line" id="L2910">        .text   = vtext,</span>
<span class="line" id="L2911">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2912">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2913">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2914">        .attribut  = AtrField,</span>
<span class="line" id="L2915">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2916">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2917">    };</span>
<span class="line" id="L2918"></span>
<span class="line" id="L2919">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,xfield.regex,<span class="tok-str">&quot;&quot;</span>)) {</span>
<span class="line" id="L2920">        xfield.regex = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;^[0-9]{s}{d}{s}$&quot;</span>,.{<span class="tok-str">&quot;{1,&quot;</span>,xfield.width,<span class="tok-str">&quot;}&quot;</span>},) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L2921">      }</span>
<span class="line" id="L2922">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex: 0..9&quot;</span> ;</span>
<span class="line" id="L2923"></span>
<span class="line" id="L2924">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2925">  }</span>
<span class="line" id="L2926"></span>
<span class="line" id="L2927">  <span class="tok-comment">// New Field DIGIT  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2928">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2929">  <span class="tok-comment">// .DIGIT SIGNED</span>
</span>
<span class="line" id="L2930">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldDigit</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2931">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2932">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2933">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2934">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2935">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2936">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2937">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2938"></span>
<span class="line" id="L2939">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2940">        .name   = vname,</span>
<span class="line" id="L2941">        .posx   = vposx,</span>
<span class="line" id="L2942">        .posy   = vposy,</span>
<span class="line" id="L2943">        .reftyp = dds.REFTYP.DIGIT,</span>
<span class="line" id="L2944">        .width  = vwidth,</span>
<span class="line" id="L2945">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L2946">        .nbrcar = <span class="tok-number">0</span>,</span>
<span class="line" id="L2947">        .tofill  = vtofill,</span>
<span class="line" id="L2948">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2949">        .pading  = <span class="tok-null">true</span>,</span>
<span class="line" id="L2950">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2951">        .regex  = vregex,</span>
<span class="line" id="L2952">        .errmsg = verrmsg,</span>
<span class="line" id="L2953">        .help   = vhelp,</span>
<span class="line" id="L2954">        .text   = vtext,</span>
<span class="line" id="L2955">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L2956">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2957">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2958">        .attribut  = AtrField,</span>
<span class="line" id="L2959">        .atrProtect = AtrProtect,</span>
<span class="line" id="L2960">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L2961">    };</span>
<span class="line" id="L2962">      xfield.nbrcar = xfield.width + xfield.scal  + <span class="tok-number">1</span> ;</span>
<span class="line" id="L2963">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,xfield.regex,<span class="tok-str">&quot;&quot;</span>)) {</span>
<span class="line" id="L2964">        xfield.regex = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;^[+-][0-9]{s}{d}{s}$&quot;</span>,.{<span class="tok-str">&quot;{1,&quot;</span>,xfield.width,<span class="tok-str">&quot;}&quot;</span>},) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L2965">      }</span>
<span class="line" id="L2966">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex: +0..9&quot;</span> ;</span>
<span class="line" id="L2967"></span>
<span class="line" id="L2968">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L2969">  }</span>
<span class="line" id="L2970"></span>
<span class="line" id="L2971">  <span class="tok-comment">// New Field Decimal  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L2972">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L2973">  <span class="tok-comment">// .DECIMAL UNSIGNED</span>
</span>
<span class="line" id="L2974">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldUDecimal</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2975">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L2976">                    vwidth:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2977">                    vscal:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L2978">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2979">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L2980">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2981">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L2982">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L2983"></span>
<span class="line" id="L2984">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L2985">        .name   = vname,</span>
<span class="line" id="L2986">        .posx   = vposx,</span>
<span class="line" id="L2987">        .posy   = vposy,</span>
<span class="line" id="L2988">        .reftyp = dds.REFTYP.UDECIMAL,</span>
<span class="line" id="L2989">        .width  = vwidth,</span>
<span class="line" id="L2990">        .scal   = vscal,</span>
<span class="line" id="L2991">        .nbrcar = <span class="tok-number">0</span>,</span>
<span class="line" id="L2992">        .tofill  = vtofill,</span>
<span class="line" id="L2993">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L2994">        .pading  = <span class="tok-null">true</span>,</span>
<span class="line" id="L2995">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L2996">        .regex  = vregex,</span>
<span class="line" id="L2997">        .errmsg = verrmsg,</span>
<span class="line" id="L2998">        .help   = vhelp,</span>
<span class="line" id="L2999">        .text   = vtext,</span>
<span class="line" id="L3000">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L3001">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3002">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3003">        .attribut  = AtrField,</span>
<span class="line" id="L3004">        .atrProtect = AtrProtect,</span>
<span class="line" id="L3005">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L3006">    };</span>
<span class="line" id="L3007"></span>
<span class="line" id="L3008">    <span class="tok-comment">// caculate len = width add scal add .  </span>
</span>
<span class="line" id="L3009">    <span class="tok-kw">if</span> (vscal == <span class="tok-number">0</span> ) xfield.nbrcar = xfield.width </span>
<span class="line" id="L3010">    <span class="tok-kw">else</span> xfield.nbrcar = xfield.width + xfield.scal  + <span class="tok-number">1</span> ;</span>
<span class="line" id="L3011"></span>
<span class="line" id="L3012">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,xfield.regex,<span class="tok-str">&quot;&quot;</span>)) {</span>
<span class="line" id="L3013">      <span class="tok-kw">if</span> (vscal == <span class="tok-number">0</span> ) xfield.regex = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;^[0-9]{s}1,{d}{s}$&quot;</span>,.{<span class="tok-str">&quot;{&quot;</span>,vwidth,<span class="tok-str">&quot;}&quot;</span>},)  <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span></span>
<span class="line" id="L3014">      <span class="tok-kw">else</span> xfield.regex = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;^[0-9]{s}1,{d}{s}[.][0-9]{s}{d}{s}$&quot;</span>,.{<span class="tok-str">&quot;{&quot;</span>,vwidth,<span class="tok-str">&quot;}&quot;</span>,<span class="tok-str">&quot;{&quot;</span>,vscal,<span class="tok-str">&quot;}&quot;</span>},)  <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3015">    }</span>
<span class="line" id="L3016">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex: 12301 or 123.01&quot;</span> ;</span>
<span class="line" id="L3017"></span>
<span class="line" id="L3018">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L3019">  }</span>
<span class="line" id="L3020"></span>
<span class="line" id="L3021">  <span class="tok-comment">// New Field Decimal  ---&gt; arraylist panel-lfield</span>
</span>
<span class="line" id="L3022">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L3023">  <span class="tok-comment">// .DECIMAL SIGNED</span>
</span>
<span class="line" id="L3024">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldDecimal</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3025">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L3026">                    vwidth: <span class="tok-type">usize</span>,</span>
<span class="line" id="L3027">                    vscal:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L3028">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3029">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L3030">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3031">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3032">                    vregex: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L3033"></span>
<span class="line" id="L3034">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L3035">        .name   = vname,</span>
<span class="line" id="L3036">        .posx   = vposx,</span>
<span class="line" id="L3037">        .posy   = vposy,</span>
<span class="line" id="L3038">        .reftyp = dds.REFTYP.DECIMAL,</span>
<span class="line" id="L3039">        .width  = vwidth,</span>
<span class="line" id="L3040">        .scal   = vscal,</span>
<span class="line" id="L3041">        .nbrcar = <span class="tok-number">0</span>,</span>
<span class="line" id="L3042">        .tofill  = vtofill,</span>
<span class="line" id="L3043">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L3044">        .pading  = <span class="tok-null">true</span>,</span>
<span class="line" id="L3045">        .edtcar =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3046">        .regex  = vregex,</span>
<span class="line" id="L3047">        .errmsg = verrmsg,</span>
<span class="line" id="L3048">        .help   = vhelp,</span>
<span class="line" id="L3049">        .text   = vtext,</span>
<span class="line" id="L3050">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L3051">        .procfunc  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3052">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3053">        .attribut  = AtrField,</span>
<span class="line" id="L3054">        .atrProtect = AtrProtect,</span>
<span class="line" id="L3055">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L3056">    };</span>
<span class="line" id="L3057"></span>
<span class="line" id="L3058">    <span class="tok-comment">// caculate len = width add scal add + . </span>
</span>
<span class="line" id="L3059">    <span class="tok-kw">if</span> (vscal == <span class="tok-number">0</span> ) xfield.nbrcar = xfield.width + <span class="tok-number">1</span></span>
<span class="line" id="L3060">    <span class="tok-kw">else</span> xfield.nbrcar = xfield.width + xfield.scal  + <span class="tok-number">2</span> ;</span>
<span class="line" id="L3061">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>,xfield.regex,<span class="tok-str">&quot;&quot;</span>)) {</span>
<span class="line" id="L3062">      <span class="tok-kw">if</span> (vscal == <span class="tok-number">0</span> ) xfield.regex =  std.fmt.allocPrint(allocator,<span class="tok-str">&quot;^[+-][0-9]{s}1,{d}{s}$&quot;</span>,.{<span class="tok-str">&quot;{&quot;</span>,vwidth,<span class="tok-str">&quot;}&quot;</span>},)  <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span></span>
<span class="line" id="L3063">      <span class="tok-kw">else</span> xfield.regex = std.fmt.allocPrint(allocator,<span class="tok-str">&quot;^[+-][0-9]{s}1,{d}{s}[.][0-9]{s}{d}{s}$&quot;</span>,.{<span class="tok-str">&quot;{&quot;</span>,vwidth,<span class="tok-str">&quot;}&quot;</span>,<span class="tok-str">&quot;{&quot;</span>,vscal,<span class="tok-str">&quot;}&quot;</span>},) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3064">    }</span>
<span class="line" id="L3065">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot;ex: +12301 or +123.01&quot;</span> ;</span>
<span class="line" id="L3066"></span>
<span class="line" id="L3067">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L3068">  }</span>
<span class="line" id="L3069"></span>
<span class="line" id="L3070"></span>
<span class="line" id="L3071">  <span class="tok-comment">// New Field Switch ---&gt; arraylist panel-field</span>
</span>
<span class="line" id="L3072">  <span class="tok-comment">// refence type</span>
</span>
<span class="line" id="L3073">  <span class="tok-comment">// FUNC,</span>
</span>
<span class="line" id="L3074">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">newFieldFunc</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3075">                    vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L3076">                    vwidth: <span class="tok-type">usize</span>,</span>
<span class="line" id="L3077">                    vtext: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3078">                    vtofill: <span class="tok-type">bool</span>,</span>
<span class="line" id="L3079">                    vprocfunc:  [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3080">                    verrmsg: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L3081">                    vhelp: []<span class="tok-kw">const</span> <span class="tok-type">u8</span>) FIELD {</span>
<span class="line" id="L3082"></span>
<span class="line" id="L3083">    <span class="tok-kw">var</span> xfield = FIELD {   </span>
<span class="line" id="L3084">        .name   = vname,</span>
<span class="line" id="L3085">        .posx   = vposx,</span>
<span class="line" id="L3086">        .posy   = vposy,</span>
<span class="line" id="L3087">        .reftyp = dds.REFTYP.FUNC,</span>
<span class="line" id="L3088">        .width  = vwidth,</span>
<span class="line" id="L3089">        .scal   = <span class="tok-number">0</span>,</span>
<span class="line" id="L3090">        .nbrcar = vwidth,</span>
<span class="line" id="L3091">        .tofill  = vtofill,</span>
<span class="line" id="L3092">        .protect = <span class="tok-null">false</span>,</span>
<span class="line" id="L3093">        .pading  = <span class="tok-null">false</span>,</span>
<span class="line" id="L3094">        .edtcar = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3095">        .regex  = <span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3096">        .errmsg = verrmsg,</span>
<span class="line" id="L3097">        .help   = vhelp,</span>
<span class="line" id="L3098">        .text   = vtext,</span>
<span class="line" id="L3099">        .zwitch = <span class="tok-null">false</span>,</span>
<span class="line" id="L3100">        .procfunc  =vprocfunc,</span>
<span class="line" id="L3101">        .proctask  =<span class="tok-str">&quot;&quot;</span>,</span>
<span class="line" id="L3102">        .attribut  = AtrField,</span>
<span class="line" id="L3103">        .atrProtect = AtrProtect,</span>
<span class="line" id="L3104">        .actif  = <span class="tok-null">true</span></span>
<span class="line" id="L3105">    };</span>
<span class="line" id="L3106"></span>
<span class="line" id="L3107">    <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, vhelp, <span class="tok-str">&quot;&quot;</span>)) xfield.help = <span class="tok-str">&quot; Select espace bar &quot;</span> ;</span>
<span class="line" id="L3108">    <span class="tok-kw">return</span> xfield;</span>
<span class="line" id="L3109"></span>
<span class="line" id="L3110">  }</span>
<span class="line" id="L3111">  <span class="tok-comment">//========================================================================</span>
</span>
<span class="line" id="L3112">  <span class="tok-comment">//========================================================================</span>
</span>
<span class="line" id="L3113">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getIndex</span>(vpnl: *pnl.PANEL , name: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> )  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L3114">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L3115">    <span class="tok-kw">for</span> (vpnl.field.items) |f | {</span>
<span class="line" id="L3116">      <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, f.name, name)) <span class="tok-kw">return</span> idx;</span>
<span class="line" id="L3117">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L3118">    }</span>
<span class="line" id="L3119">    <span class="tok-kw">return</span> ErrForms.fld_getIndex_Name_Field_Invalide;</span>
<span class="line" id="L3120">  }</span>
<span class="line" id="L3121"></span>
<span class="line" id="L3122">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getName</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>) ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3123">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].name;</span>
<span class="line" id="L3124">    <span class="tok-kw">return</span> ErrForms.fld_getName_Index_invalide ;</span>
<span class="line" id="L3125"></span>
<span class="line" id="L3126">  }</span>
<span class="line" id="L3127">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosx</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L3128">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].posx;</span>
<span class="line" id="L3129">    <span class="tok-kw">return</span> ErrForms.fld_getPosx_Index_invalide ;</span>
<span class="line" id="L3130">  }</span>
<span class="line" id="L3131">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosy</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L3132">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].posy;</span>
<span class="line" id="L3133">    <span class="tok-kw">return</span> ErrForms.fld_getPosy_Index_invalide ;</span>
<span class="line" id="L3134">  }</span>
<span class="line" id="L3135">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getRefType</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! dds.REFTYP {</span>
<span class="line" id="L3136">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].reftyp;</span>
<span class="line" id="L3137">    <span class="tok-kw">return</span> ErrForms.fld_getRefType_Index_invalide ;</span>
<span class="line" id="L3138">  }</span>
<span class="line" id="L3139">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getWidth</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L3140">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].width;</span>
<span class="line" id="L3141">    <span class="tok-kw">return</span> ErrForms.fld_getWidth_Index_invalide ;</span>
<span class="line" id="L3142">  }</span>
<span class="line" id="L3143">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getScal</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L3144">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].scal;</span>
<span class="line" id="L3145">    <span class="tok-kw">return</span> ErrForms.fld_getScal_Index_invalide ;</span>
<span class="line" id="L3146">  }</span>
<span class="line" id="L3147">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getNbrCar</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">usize</span> {</span>
<span class="line" id="L3148">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].nbrcar;</span>
<span class="line" id="L3149">    <span class="tok-kw">return</span> ErrForms.fld_getNbrCar_Index_invalide ;</span>
<span class="line" id="L3150">  }</span>
<span class="line" id="L3151">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">gettofill</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L3152">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].tofill;</span>
<span class="line" id="L3153">    <span class="tok-kw">return</span> ErrForms.fld_gettofill_Index_invalide ;</span>
<span class="line" id="L3154">  }</span>
<span class="line" id="L3155">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getProtect</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L3156">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].protect;</span>
<span class="line" id="L3157">    <span class="tok-kw">return</span> ErrForms.fld_getProtect_Index_invalide ;</span>
<span class="line" id="L3158">  }</span>
<span class="line" id="L3159">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPading</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L3160">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].pading;</span>
<span class="line" id="L3161">    <span class="tok-kw">return</span> ErrForms.fld_getPading_Index_invalide ;</span>
<span class="line" id="L3162">  }</span>
<span class="line" id="L3163">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getEdtcar</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3164">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].edtcar;</span>
<span class="line" id="L3165">    <span class="tok-kw">return</span> ErrForms.fld_getEdtcar_Index_invalide ;</span>
<span class="line" id="L3166">  }</span>
<span class="line" id="L3167">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getRegex</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3168">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].regex;</span>
<span class="line" id="L3169">    <span class="tok-kw">return</span> ErrForms.fld_getRegex_Index_invalide ;</span>
<span class="line" id="L3170">  }</span>
<span class="line" id="L3171">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getErrMsg</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3172">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].errmsg;</span>
<span class="line" id="L3173">    <span class="tok-kw">return</span> ErrForms.fld_getErrMsg_Index_invalide ;</span>
<span class="line" id="L3174">  }</span>
<span class="line" id="L3175">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getHelp</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3176">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].help;</span>
<span class="line" id="L3177">    <span class="tok-kw">return</span> ErrForms.fld_getHelp_Index_invalide ;</span>
<span class="line" id="L3178">  }</span>
<span class="line" id="L3179">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getText</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3180">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].text;</span>
<span class="line" id="L3181">    <span class="tok-kw">return</span> ErrForms.fld_getText_Index_invalide ;</span>
<span class="line" id="L3182">  }</span>
<span class="line" id="L3183">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getSwitch</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L3184">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].zwitch;</span>
<span class="line" id="L3185">    <span class="tok-kw">return</span> ErrForms.fld_getSwitch_Index_invalide ;</span>
<span class="line" id="L3186">  }</span>
<span class="line" id="L3187">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getErr</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L3188">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].err;</span>
<span class="line" id="L3189">    <span class="tok-kw">return</span> ErrForms.fld_getErr_Index_invalide ;</span>
<span class="line" id="L3190">  }</span>
<span class="line" id="L3191">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getFunc</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3192">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].procfunc;</span>
<span class="line" id="L3193">    <span class="tok-kw">return</span> ErrForms.fld_getFunc_Index_invalide ;</span>
<span class="line" id="L3194">  }</span>
<span class="line" id="L3195">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getTask</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3196">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].proctask;</span>
<span class="line" id="L3197">    <span class="tok-kw">return</span> ErrForms.fld_getTask_Index_invalide ;</span>
<span class="line" id="L3198">  }</span>
<span class="line" id="L3199"></span>
<span class="line" id="L3200">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getAttribut</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! dds.ZONATRB {</span>
<span class="line" id="L3201">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].atribut;</span>
<span class="line" id="L3202">    <span class="tok-kw">return</span> ErrForms.fld_getAttribut_Index_invalide ;</span>
<span class="line" id="L3203">  }</span>
<span class="line" id="L3204">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getAtrProtect</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! dds.ZONATRB {</span>
<span class="line" id="L3205">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].atrProtect;</span>
<span class="line" id="L3206">    <span class="tok-kw">return</span> ErrForms.fld_AtrProtect_Index_invalide ;</span>
<span class="line" id="L3207">  }</span>
<span class="line" id="L3208">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getActif</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>)  ErrForms ! <span class="tok-type">bool</span> {</span>
<span class="line" id="L3209">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) <span class="tok-kw">return</span> vpnl.field.items[n].actif;</span>
<span class="line" id="L3210">    <span class="tok-kw">return</span> ErrForms.fld_getActif_Index_invalide ;</span>
<span class="line" id="L3211">  }</span>
<span class="line" id="L3212"></span>
<span class="line" id="L3213"></span>
<span class="line" id="L3214">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setText</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val:[] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3215">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) vpnl.field.items[n].text = val</span>
<span class="line" id="L3216">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_setText_Index_invalide;</span>
<span class="line" id="L3217">  }</span>
<span class="line" id="L3218"></span>
<span class="line" id="L3219">  <span class="tok-comment">//  Input Field </span>
</span>
<span class="line" id="L3220">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setSwitch</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :<span class="tok-type">bool</span>)  ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3221">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) {</span>
<span class="line" id="L3222">      vpnl.field.items[n].zwitch = val;</span>
<span class="line" id="L3223">      vpnl.field.items[n].text = utl.boolToCbool(val);</span>
<span class="line" id="L3224">    }</span>
<span class="line" id="L3225">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_setSwitch_Index_invalide;</span>
<span class="line" id="L3226"></span>
<span class="line" id="L3227">  }</span>
<span class="line" id="L3228">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setProtect</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :<span class="tok-type">bool</span>)  ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3229">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len)  vpnl.field.items[n].protect = val</span>
<span class="line" id="L3230">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_setProtect_Index_invalide;</span>
<span class="line" id="L3231">  }</span>
<span class="line" id="L3232">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setEdtcar</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val:[] <span class="tok-kw">const</span> <span class="tok-type">u8</span>)  ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3233">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) vpnl.field.items[n].edtcar = val</span>
<span class="line" id="L3234">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_setEdtcar_Index_invalide;</span>
<span class="line" id="L3235">  }</span>
<span class="line" id="L3236">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setRegex</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val:[] <span class="tok-kw">const</span> <span class="tok-type">u8</span>)  ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3237">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) vpnl.field.items[n].reftyp = val</span>
<span class="line" id="L3238">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_setRegex_Index_invalide;</span>
<span class="line" id="L3239">  }</span>
<span class="line" id="L3240">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setTask</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :[]<span class="tok-kw">const</span> <span class="tok-type">u8</span>)  ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3241">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) vpnl.field.items[n].proctask = val</span>
<span class="line" id="L3242">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_setActif_Index_invalide;</span>
<span class="line" id="L3243">  }</span>
<span class="line" id="L3244">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setActif</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>, val :<span class="tok-type">bool</span>)  ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3245">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len) vpnl.field.items[n].actif = val</span>
<span class="line" id="L3246">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_setActif_Index_invalide;</span>
<span class="line" id="L3247">  }</span>
<span class="line" id="L3248"></span>
<span class="line" id="L3249">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">dltRows</span>(vpnl: *pnl.PANEL,  n :<span class="tok-type">usize</span> ) ErrForms ! <span class="tok-type">void</span> {</span>
<span class="line" id="L3250">    <span class="tok-kw">if</span> ( n &lt; vpnl.field.items.len)  _= vpnl.field.orderedRemove(n)</span>
<span class="line" id="L3251">    <span class="tok-kw">else</span> <span class="tok-kw">return</span> ErrForms.fld_dltRows_Index_invalide;</span>
<span class="line" id="L3252">  }</span>
<span class="line" id="L3253"></span>
<span class="line" id="L3254"></span>
<span class="line" id="L3255">  <span class="tok-comment">// clear value ALL FIELD</span>
</span>
<span class="line" id="L3256">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">clearAll</span>(vpnl: *pnl.PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L3257">    <span class="tok-kw">var</span> n : <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L3258">    <span class="tok-kw">for</span> (vpnl.field.items) |_ | {</span>
<span class="line" id="L3259">      vpnl.field.items[n].text = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L3260">      vpnl.field.items[n].zwitch = <span class="tok-null">false</span>;</span>
<span class="line" id="L3261">      n += <span class="tok-number">1</span> ;</span>
<span class="line" id="L3262">    }</span>
<span class="line" id="L3263">  }</span>
<span class="line" id="L3264">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">clearField</span>(vpnl: *pnl.PANEL , n: <span class="tok-type">usize</span>,)  <span class="tok-type">void</span> {</span>
<span class="line" id="L3265">    <span class="tok-kw">if</span> ( n &gt; vpnl.field.items.len) <span class="tok-kw">return</span>;</span>
<span class="line" id="L3266">    vpnl.field.items[n].text = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L3267">    vpnl.field.items[n].zwitch = <span class="tok-null">false</span>;</span>
<span class="line" id="L3268">  }</span>
<span class="line" id="L3269"></span>
<span class="line" id="L3270"></span>
<span class="line" id="L3271">  <span class="tok-comment">// matrix cleaning from Field</span>
</span>
<span class="line" id="L3272">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">clsField</span>(vpnl: *pnl.PANEL, vfld : FIELD )  <span class="tok-type">void</span> {</span>
<span class="line" id="L3273">    <span class="tok-comment">// display matrice PANEL</span>
</span>
<span class="line" id="L3274">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L3275">    <span class="tok-kw">if</span> (vfld.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L3276">      <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = vfld.posx - <span class="tok-number">1</span>;</span>
<span class="line" id="L3277">      <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = vfld.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L3278">      <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L3279">      <span class="tok-kw">var</span> npos :<span class="tok-type">usize</span> = (vpnl.cols * vfld.posx) + vfld.posy - <span class="tok-number">1</span> ;</span>
<span class="line" id="L3280">      <span class="tok-kw">while</span> (n &lt; vfld.nbrcar) : (n += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3281">        vpnl.buf.items[npos].ch = <span class="tok-str">&quot; &quot;</span>;</span>
<span class="line" id="L3282">        vpnl.buf.items[npos].attribut  = vpnl.attribut;</span>
<span class="line" id="L3283">        vpnl.buf.items[npos].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L3284">        term.gotoXY(x + vpnl.posx   , y + vpnl.posy - n  );</span>
<span class="line" id="L3285">        term.writeStyled(vpnl.buf.items[npos].ch,vpnl.buf.items[npos].attribut);</span>
<span class="line" id="L3286">        npos += <span class="tok-number">1</span>;</span>
<span class="line" id="L3287">      }</span>
<span class="line" id="L3288">  }</span>
<span class="line" id="L3289"></span>
<span class="line" id="L3290"></span>
<span class="line" id="L3291">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printField</span>(vpnl: *pnl.PANEL, vfld : FIELD) <span class="tok-type">void</span> {</span>
<span class="line" id="L3292">    <span class="tok-kw">if</span> ( vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ; </span>
<span class="line" id="L3293">    <span class="tok-comment">// assigne FIELD to matrice for display</span>
</span>
<span class="line" id="L3294">    <span class="tok-kw">var</span> n = (vpnl.cols * (vfld.posx - <span class="tok-number">1</span>)) + vfld.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L3295">    <span class="tok-kw">var</span> nn: <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L3296"></span>
<span class="line" id="L3297">    <span class="tok-kw">while</span> (nn &lt; vfld.nbrcar) : (nn += <span class="tok-number">1</span> ) {</span>
<span class="line" id="L3298">      <span class="tok-kw">if</span> (vfld.actif == <span class="tok-null">true</span>) {</span>
<span class="line" id="L3299">        vpnl.buf.items[n].ch = <span class="tok-str">&quot; &quot;</span> ;</span>
<span class="line" id="L3300">        <span class="tok-kw">if</span> (vfld.protect == <span class="tok-null">false</span>) vpnl.buf.items[n].attribut = vfld.attribut</span>
<span class="line" id="L3301">        <span class="tok-kw">else</span> vpnl.buf.items[n].attribut  = vpnl.attribut;</span>
<span class="line" id="L3302">        vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L3303">      }</span>
<span class="line" id="L3304">      <span class="tok-kw">else</span> {</span>
<span class="line" id="L3305">        vpnl.buf.items[n].ch = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L3306">        vpnl.buf.items[n].attribut  = vpnl.attribut;</span>
<span class="line" id="L3307">        vpnl.buf.items[n].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L3308">      }</span>
<span class="line" id="L3309">      n += <span class="tok-number">1</span>;</span>
<span class="line" id="L3310">    }</span>
<span class="line" id="L3311"></span>
<span class="line" id="L3312">    <span class="tok-comment">// The err field takes precedence, followed by protection, followed by the base attribute</span>
</span>
<span class="line" id="L3313">    n = (vpnl.cols * (vfld.posx - <span class="tok-number">1</span>)) + vfld.posy - <span class="tok-number">1</span>  ;</span>
<span class="line" id="L3314"></span>
<span class="line" id="L3315">    <span class="tok-kw">var</span> nfld = vfld.text;</span>
<span class="line" id="L3316">    <span class="tok-kw">var</span> nile = <span class="tok-null">false</span> ;</span>
<span class="line" id="L3317">    <span class="tok-kw">if</span> (nfld.len == <span class="tok-number">0</span> <span class="tok-kw">and</span> !vfld.protect ) {</span>
<span class="line" id="L3318">      nfld =<span class="tok-str">&quot;_&quot;</span>;</span>
<span class="line" id="L3319">      nile = <span class="tok-null">true</span>;</span>
<span class="line" id="L3320">    }</span>
<span class="line" id="L3321">    <span class="tok-kw">if</span> (vfld.reftyp == dds.REFTYP.SWITCH) {</span>
<span class="line" id="L3322">            nile = <span class="tok-null">false</span>;</span>
<span class="line" id="L3323">            <span class="tok-kw">if</span> ( vfld.zwitch ) nfld = dds.STRUE</span>
<span class="line" id="L3324">            <span class="tok-kw">else</span> nfld= dds.SFALSE;</span>
<span class="line" id="L3325">    } </span>
<span class="line" id="L3326">    <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(nfld);</span>
<span class="line" id="L3327">    <span class="tok-kw">while</span> (iter.next()) |ch| {</span>
<span class="line" id="L3328">      <span class="tok-kw">if</span> (vfld.actif == <span class="tok-null">true</span> ) {</span>
<span class="line" id="L3329">        <span class="tok-kw">if</span> (vfld.reftyp == dds.REFTYP.PASSWORD) vpnl.buf.items[n].ch = <span class="tok-str">&quot;*&quot;</span> </span>
<span class="line" id="L3330">        <span class="tok-kw">else</span> vpnl.buf.items[n].ch = ch ;</span>
<span class="line" id="L3331"></span>
<span class="line" id="L3332">        vpnl.buf.items[n].on = <span class="tok-null">true</span>;</span>
<span class="line" id="L3333"></span>
<span class="line" id="L3334">        <span class="tok-kw">if</span> (vfld.protect) vpnl.buf.items[n].attribut  = vfld.atrProtect</span>
<span class="line" id="L3335">        <span class="tok-kw">else</span> {</span>
<span class="line" id="L3336">            <span class="tok-kw">if</span> (nile)vpnl.buf.items[n].attribut  = AtrNil</span>
<span class="line" id="L3337">            <span class="tok-kw">else</span> vpnl.buf.items[n].attribut = vfld.attribut;</span>
<span class="line" id="L3338">        }</span>
<span class="line" id="L3339"></span>
<span class="line" id="L3340">      }</span>
<span class="line" id="L3341">      n += <span class="tok-number">1</span>;</span>
<span class="line" id="L3342">    }</span>
<span class="line" id="L3343">  }</span>
<span class="line" id="L3344"></span>
<span class="line" id="L3345">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">displayField</span>(vpnl: *pnl.PANEL, vfld : FIELD )  <span class="tok-type">void</span> {</span>
<span class="line" id="L3346">    <span class="tok-comment">// display matrice PANEL</span>
</span>
<span class="line" id="L3347">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L3348">    <span class="tok-kw">if</span> (vfld.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L3349">      <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = vfld.posx - <span class="tok-number">1</span>;</span>
<span class="line" id="L3350">      <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = vfld.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L3351">      <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L3352">      <span class="tok-kw">var</span> npos :<span class="tok-type">usize</span> = (vpnl.cols * (vfld.posx - <span class="tok-number">1</span>)) + vfld.posy - <span class="tok-number">1</span> ;</span>
<span class="line" id="L3353">      <span class="tok-kw">while</span> (n &lt; vfld.nbrcar) : (n += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3354">        term.gotoXY(x + vpnl.posx   , y + vpnl.posy + n  );</span>
<span class="line" id="L3355">        term.writeStyled(vpnl.buf.items[npos].ch,vpnl.buf.items[npos].attribut);</span>
<span class="line" id="L3356">        npos += <span class="tok-number">1</span>;</span>
<span class="line" id="L3357">      }</span>
<span class="line" id="L3358">  }</span>
<span class="line" id="L3359"></span>
<span class="line" id="L3360"></span>
<span class="line" id="L3361">  <span class="tok-comment">//----------------------------------------------------==</span>
</span>
<span class="line" id="L3362">  <span class="tok-comment">// Input buffer management modeled on 5250/3270</span>
</span>
<span class="line" id="L3363">  <span class="tok-comment">// inspiration ncurse</span>
</span>
<span class="line" id="L3364">  <span class="tok-comment">// application hold principe and new langage</span>
</span>
<span class="line" id="L3365">  <span class="tok-comment">//----------------------------------------------------==</span>
</span>
<span class="line" id="L3366"></span>
<span class="line" id="L3367">  <span class="tok-kw">var</span> e_FIELD : std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L3368">  <span class="tok-kw">var</span> e_switch: <span class="tok-type">bool</span> = <span class="tok-null">false</span>;</span>
<span class="line" id="L3369"></span>
<span class="line" id="L3370"></span>
<span class="line" id="L3371">  <span class="tok-kw">fn</span> <span class="tok-fn">nbrCarField</span>() <span class="tok-type">usize</span> {</span>
<span class="line" id="L3372">    <span class="tok-kw">var</span> wl : <span class="tok-type">usize</span> =<span class="tok-number">0</span>;</span>
<span class="line" id="L3373">    <span class="tok-kw">var</span> iter = utl.iteratStr.iterator(utl.listToStr(e_FIELD));</span>
<span class="line" id="L3374">    <span class="tok-kw">while</span> (iter.next()) |_|  { wl += <span class="tok-number">1</span> ;}</span>
<span class="line" id="L3375">    <span class="tok-kw">return</span> wl;</span>
<span class="line" id="L3376">  }</span>
<span class="line" id="L3377"></span>
<span class="line" id="L3378">  <span class="tok-kw">fn</span> <span class="tok-fn">delete</span>(n : <span class="tok-type">usize</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L3379">    _=e_FIELD.orderedRemove(n);</span>
<span class="line" id="L3380">    e_FIELD.append(<span class="tok-str">&quot; &quot;</span>) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3381">  }</span>
<span class="line" id="L3382"></span>
<span class="line" id="L3383">  <span class="tok-kw">fn</span> <span class="tok-fn">insert</span>(c: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> , n : <span class="tok-type">usize</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L3384">    _=e_FIELD.orderedRemove(nbrCarField() - <span class="tok-number">1</span>);</span>
<span class="line" id="L3385">    </span>
<span class="line" id="L3386">    <span class="tok-kw">var</span> x_FIELD : std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L3387">    x_FIELD = std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>).init(allocator);</span>
<span class="line" id="L3388">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L3389">    <span class="tok-kw">for</span> ( e_FIELD.items) |ch | {</span>
<span class="line" id="L3390">      <span class="tok-kw">if</span> ( n != idx) x_FIELD.append(ch) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span> ;</span>
<span class="line" id="L3391">      <span class="tok-kw">if</span> ( n == idx) { </span>
<span class="line" id="L3392">        x_FIELD.append(c) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span> ;</span>
<span class="line" id="L3393">        x_FIELD.append(ch) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span> ;</span>
<span class="line" id="L3394">      } </span>
<span class="line" id="L3395">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L3396">    }</span>
<span class="line" id="L3397">    e_FIELD.deinit();</span>
<span class="line" id="L3398">    e_FIELD = x_FIELD;</span>
<span class="line" id="L3399">  }</span>
<span class="line" id="L3400"></span>
<span class="line" id="L3401"></span>
<span class="line" id="L3402"></span>
<span class="line" id="L3403">  <span class="tok-kw">fn</span> <span class="tok-fn">istofill</span>() <span class="tok-type">bool</span> {</span>
<span class="line" id="L3404">    <span class="tok-kw">var</span> text = utl.listToStr(e_FIELD);</span>
<span class="line" id="L3405">    text = utl.trimStr(text);</span>
<span class="line" id="L3406"></span>
<span class="line" id="L3407">    <span class="tok-kw">if</span> (text.len == <span class="tok-number">0</span> ) <span class="tok-kw">return</span> <span class="tok-null">true</span> ;</span>
<span class="line" id="L3408">    <span class="tok-kw">return</span> <span class="tok-null">false</span> ;</span>
<span class="line" id="L3409">  }</span>
<span class="line" id="L3410">  </span>
<span class="line" id="L3411">  <span class="tok-comment">/// Check if it is a space</span></span>
<span class="line" id="L3412">  <span class="tok-kw">fn</span> <span class="tok-fn">isSpace</span>(c: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-type">bool</span> { </span>
<span class="line" id="L3413">    <span class="tok-kw">if</span> ( std.mem.eql(<span class="tok-type">u8</span>, c, <span class="tok-str">&quot; &quot;</span>) ) <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L3414">    <span class="tok-kw">return</span> <span class="tok-null">false</span> ;</span>
<span class="line" id="L3415">  }</span>
<span class="line" id="L3416"></span>
<span class="line" id="L3417">  <span class="tok-comment">/// if it is a KEY function</span></span>
<span class="line" id="L3418">  <span class="tok-kw">fn</span> <span class="tok-fn">isfuncKey</span>(vpnl: *pnl.PANEL, e_key: term.Keyboard) <span class="tok-type">bool</span> {</span>
<span class="line" id="L3419">    <span class="tok-kw">for</span> ( vpnl.button.items) |xbtn| {</span>
<span class="line" id="L3420">      <span class="tok-kw">if</span> (xbtn.key == e_key.Key ) <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L3421">    }</span>
<span class="line" id="L3422">    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L3423">  }</span>
<span class="line" id="L3424">  </span>
<span class="line" id="L3425">  <span class="tok-comment">/// if it is a KEY function Check</span></span>
<span class="line" id="L3426">  <span class="tok-kw">fn</span> <span class="tok-fn">ischeckKey</span>(vpnl: *pnl.PANEL, e_key: term.Keyboard) <span class="tok-type">bool</span> {</span>
<span class="line" id="L3427">    <span class="tok-kw">for</span> ( vpnl.button.items) |xbtn| {</span>
<span class="line" id="L3428">      <span class="tok-kw">if</span> (xbtn.key == e_key.Key <span class="tok-kw">and</span> xbtn.check ) <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L3429">    }</span>
<span class="line" id="L3430">    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L3431">  }</span>
<span class="line" id="L3432">  </span>
<span class="line" id="L3433">  <span class="tok-comment">/// Hides the area entered with *</span></span>
<span class="line" id="L3434">  <span class="tok-kw">fn</span> <span class="tok-fn">password</span>(s: std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>)) [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L3435">    <span class="tok-kw">var</span> i: <span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L3436">    <span class="tok-kw">var</span> buf : [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L3437">    <span class="tok-kw">while</span> ( i &lt; s.items.len ) : (i += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3438">        <span class="tok-kw">if</span> ( std.mem.eql(<span class="tok-type">u8</span>,s.items[i],<span class="tok-str">&quot; &quot;</span> )) buf = utl.concatStr(buf,<span class="tok-str">&quot; &quot;</span>) </span>
<span class="line" id="L3439">        <span class="tok-kw">else</span>  buf = utl.concatStr(buf,<span class="tok-str">&quot;*&quot;</span>);</span>
<span class="line" id="L3440">    }</span>
<span class="line" id="L3441">    <span class="tok-kw">return</span> buf;</span>
<span class="line" id="L3442">  }</span>
<span class="line" id="L3443"></span>
<span class="line" id="L3444">  <span class="tok-comment">/// initialize the input field e_FIELD</span></span>
<span class="line" id="L3445">  <span class="tok-comment">/// switch convert bool CTRUE /CFALSE</span></span>
<span class="line" id="L3446">  <span class="tok-comment">/// the buffer displays field the text and completes with blanks</span></span>
<span class="line" id="L3447">  <span class="tok-kw">fn</span> <span class="tok-fn">initData</span>(f:FIELD) <span class="tok-type">void</span> {</span>
<span class="line" id="L3448">    e_FIELD.deinit();</span>
<span class="line" id="L3449">    e_FIELD = std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>).init(allocator);</span>
<span class="line" id="L3450">    <span class="tok-kw">if</span> ( f.reftyp == dds.REFTYP.SWITCH) {</span>
<span class="line" id="L3451">      <span class="tok-kw">if</span> (e_switch == <span class="tok-null">true</span> ) </span>
<span class="line" id="L3452">        e_FIELD = utl.addListStr(e_FIELD  , dds.STRUE) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span> </span>
<span class="line" id="L3453">      <span class="tok-kw">else</span></span>
<span class="line" id="L3454">        e_FIELD = utl.addListStr(e_FIELD  , dds.SFALSE) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3455">    }</span>
<span class="line" id="L3456">    <span class="tok-kw">else</span> {</span>
<span class="line" id="L3457">      e_FIELD = utl.addListStr(e_FIELD  , f.text) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3458">      <span class="tok-kw">var</span> i:<span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L3459">      <span class="tok-kw">while</span> (i &lt; f.nbrcar - f.text.len) : ( i += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3460">        e_FIELD.append(<span class="tok-str">&quot; &quot;</span>) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3461">      }</span>
<span class="line" id="L3462">    }</span>
<span class="line" id="L3463">  }</span>
<span class="line" id="L3464"></span>
<span class="line" id="L3465"></span>
<span class="line" id="L3466">  <span class="tok-kw">fn</span> <span class="tok-fn">msgHelp</span>(vpnl: *pnl.PANEL, f : FIELD ) <span class="tok-type">void</span> {</span>
<span class="line" id="L3467"></span>
<span class="line" id="L3468">    <span class="tok-comment">// define attribut default MSG Error</span>
</span>
<span class="line" id="L3469">    <span class="tok-kw">const</span> MsgHelp : dds.ZONATRB = .{</span>
<span class="line" id="L3470">        .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L3471">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L3472">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L3473">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L3474">        .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L3475">        .foregr = dds.ForegroundColor.fgRed</span>
<span class="line" id="L3476">    };</span>
<span class="line" id="L3477"></span>
<span class="line" id="L3478"></span>
<span class="line" id="L3479">    <span class="tok-kw">var</span> x: <span class="tok-type">usize</span>  = vpnl.lines;</span>
<span class="line" id="L3480">    <span class="tok-kw">var</span> n: <span class="tok-type">usize</span>  = vpnl.cols * (x - <span class="tok-number">2</span>) ;</span>
<span class="line" id="L3481">    <span class="tok-kw">var</span> y: <span class="tok-type">usize</span>  = <span class="tok-number">1</span> ;</span>
<span class="line" id="L3482"></span>
<span class="line" id="L3483">    <span class="tok-kw">var</span> msghlp:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = utl.concatStr(<span class="tok-str">&quot;Help : &quot;</span>, f.help) ;</span>
<span class="line" id="L3484">    <span class="tok-kw">var</span> boucle : <span class="tok-type">bool</span>= <span class="tok-null">true</span> ;</span>
<span class="line" id="L3485"></span>
<span class="line" id="L3486">    <span class="tok-kw">if</span> (vpnl.cols &lt; (msghlp.len) )  msghlp = utl.subStr(msghlp,<span class="tok-number">0</span>,  vpnl.cols - <span class="tok-number">2</span>) <span class="tok-kw">catch</span> |err| {dsperr.errorForms(err); <span class="tok-kw">return</span>;};</span>
<span class="line" id="L3487"></span>
<span class="line" id="L3488">    <span class="tok-comment">// clear line button </span>
</span>
<span class="line" id="L3489">    <span class="tok-kw">while</span> (y &lt;= (vpnl.cols - <span class="tok-number">2</span>) ) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3490">      term.gotoXY(vpnl.posx + x  - <span class="tok-number">2</span>   , y + vpnl.posy );</span>
<span class="line" id="L3491">      term.writeStyled(<span class="tok-str">&quot; &quot;</span>,vpnl.attribut);</span>
<span class="line" id="L3492">    }</span>
<span class="line" id="L3493">    <span class="tok-comment">// display msgerr</span>
</span>
<span class="line" id="L3494">    y = <span class="tok-number">1</span> ;</span>
<span class="line" id="L3495">    term.gotoXY(vpnl.posx + x  - <span class="tok-number">2</span>, y + vpnl.posy );</span>
<span class="line" id="L3496">    term.writeStyled(msghlp,MsgHelp);</span>
<span class="line" id="L3497"></span>
<span class="line" id="L3498">    <span class="tok-kw">while</span> (boucle) {</span>
<span class="line" id="L3499">      <span class="tok-kw">var</span> e_key = kbd.getKEY();</span>
<span class="line" id="L3500"></span>
<span class="line" id="L3501">      <span class="tok-kw">switch</span> ( e_key.Key ) {</span>
<span class="line" id="L3502">        .esc=&gt;boucle = <span class="tok-null">false</span>,</span>
<span class="line" id="L3503">      <span class="tok-kw">else</span> =&gt;  {},</span>
<span class="line" id="L3504">      }</span>
<span class="line" id="L3505">    }</span>
<span class="line" id="L3506"></span>
<span class="line" id="L3507">    <span class="tok-comment">// restore line panel</span>
</span>
<span class="line" id="L3508">    y = <span class="tok-number">1</span> ;</span>
<span class="line" id="L3509">    <span class="tok-kw">while</span> (y &lt;= (vpnl.cols - <span class="tok-number">2</span>)) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3510">      n += <span class="tok-number">1</span>;</span>
<span class="line" id="L3511">      term.gotoXY( vpnl.posx + x  - <span class="tok-number">2</span>, y + vpnl.posy);</span>
<span class="line" id="L3512">      term.writeStyled(vpnl.buf.items[n].ch,vpnl.buf.items[n].attribut);</span>
<span class="line" id="L3513">    }</span>
<span class="line" id="L3514">  }</span>
<span class="line" id="L3515"></span>
<span class="line" id="L3516">  <span class="tok-comment">///------------------------------------------------</span></span>
<span class="line" id="L3517">  <span class="tok-comment">/// Definition of the panel (window) on a lines</span></span>
<span class="line" id="L3518">  <span class="tok-comment">/// Message display</span></span>
<span class="line" id="L3519">  <span class="tok-comment">/// to exit press the Escape key</span></span>
<span class="line" id="L3520">  <span class="tok-comment">/// restoration of the original panel lines</span></span>
<span class="line" id="L3521">  <span class="tok-comment">///------------------------------------------------</span></span>
<span class="line" id="L3522"></span>
<span class="line" id="L3523">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">msgErr</span>(vpnl: *pnl.PANEL, f : FIELD,  info: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> ) <span class="tok-type">void</span> {</span>
<span class="line" id="L3524"></span>
<span class="line" id="L3525">    term.gotoXY(vpnl.posx + f.posx - <span class="tok-number">1</span> , vpnl.posy + f.posy - <span class="tok-number">1</span>);</span>
<span class="line" id="L3526">    term.writeStyled(utl.listToStr(e_FIELD),MsgErr);</span>
<span class="line" id="L3527"></span>
<span class="line" id="L3528"></span>
<span class="line" id="L3529">    <span class="tok-kw">var</span> x: <span class="tok-type">usize</span>  = vpnl.lines;</span>
<span class="line" id="L3530">    <span class="tok-kw">var</span> n: <span class="tok-type">usize</span>  = vpnl.cols * (x - <span class="tok-number">2</span>) ;</span>
<span class="line" id="L3531">    <span class="tok-kw">var</span> y: <span class="tok-type">usize</span>  = <span class="tok-number">1</span> ;</span>
<span class="line" id="L3532"></span>
<span class="line" id="L3533">    <span class="tok-kw">var</span> msgerr:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = utl.concatStr(<span class="tok-str">&quot;Info : &quot;</span>, info) ;</span>
<span class="line" id="L3534">    <span class="tok-kw">var</span> boucle : <span class="tok-type">bool</span>= <span class="tok-null">true</span> ;</span>
<span class="line" id="L3535"></span>
<span class="line" id="L3536">    <span class="tok-kw">if</span> (vpnl.cols &lt; (msgerr.len) )  msgerr = utl.subStr(msgerr, <span class="tok-number">0</span>,  vpnl.cols - <span class="tok-number">2</span>) <span class="tok-kw">catch</span> |err| {dsperr.errorForms(err); <span class="tok-kw">return</span>;};</span>
<span class="line" id="L3537"></span>
<span class="line" id="L3538">    <span class="tok-comment">// clear line button </span>
</span>
<span class="line" id="L3539">    <span class="tok-kw">while</span> (y &lt;= (vpnl.cols - <span class="tok-number">2</span>) ) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3540">      term.gotoXY(vpnl.posx + x  - <span class="tok-number">2</span>   , y + vpnl.posy  );</span>
<span class="line" id="L3541">      term.writeStyled(<span class="tok-str">&quot; &quot;</span>,vpnl.attribut);</span>
<span class="line" id="L3542">    }</span>
<span class="line" id="L3543">    <span class="tok-comment">// display msgerr</span>
</span>
<span class="line" id="L3544">    y = <span class="tok-number">1</span> ;</span>
<span class="line" id="L3545">    term.gotoXY(vpnl.posx + x  - <span class="tok-number">2</span>, y + vpnl.posy   );</span>
<span class="line" id="L3546">    term.writeStyled(msgerr,MsgErr);</span>
<span class="line" id="L3547"></span>
<span class="line" id="L3548">    <span class="tok-kw">while</span> (boucle) {</span>
<span class="line" id="L3549">      <span class="tok-kw">var</span> e_key = kbd.getKEY();</span>
<span class="line" id="L3550"></span>
<span class="line" id="L3551">      <span class="tok-kw">switch</span> ( e_key.Key ) {</span>
<span class="line" id="L3552">        .esc=&gt;boucle = <span class="tok-null">false</span>,</span>
<span class="line" id="L3553">      <span class="tok-kw">else</span> =&gt;  {},</span>
<span class="line" id="L3554">      }</span>
<span class="line" id="L3555">    }</span>
<span class="line" id="L3556"></span>
<span class="line" id="L3557">    <span class="tok-comment">// restore line panel</span>
</span>
<span class="line" id="L3558">    <span class="tok-kw">while</span> (y &lt;= (vpnl.cols - <span class="tok-number">2</span>)) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L3559">      n += <span class="tok-number">1</span>;</span>
<span class="line" id="L3560">      term.gotoXY( vpnl.posx + x  - <span class="tok-number">2</span>, y + vpnl.posy  );</span>
<span class="line" id="L3561">      term.writeStyled(vpnl.buf.items[n].ch,vpnl.buf.items[n].attribut);</span>
<span class="line" id="L3562">    }</span>
<span class="line" id="L3563">  }</span>
<span class="line" id="L3564"></span>
<span class="line" id="L3565"></span>
<span class="line" id="L3566">  <span class="tok-comment">//====================================================</span>
</span>
<span class="line" id="L3567">  <span class="tok-comment">// ioFIELD</span>
</span>
<span class="line" id="L3568">  <span class="tok-comment">//====================================================</span>
</span>
<span class="line" id="L3569">  </span>
<span class="line" id="L3570">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">ioField</span>(vpnl: *pnl.PANEL, vfld : FIELD ) kbd  {</span>
<span class="line" id="L3571">    <span class="tok-kw">if</span> (vfld.protect <span class="tok-kw">or</span> !vfld.actif)  <span class="tok-kw">return</span> kbd.none;</span>
<span class="line" id="L3572"></span>
<span class="line" id="L3573">    <span class="tok-kw">var</span> e_posx :<span class="tok-type">usize</span> = vpnl.posx + vfld.posx - <span class="tok-number">1</span>;</span>
<span class="line" id="L3574">    <span class="tok-kw">var</span> e_posy :<span class="tok-type">usize</span> = vpnl.posy + vfld.posy - <span class="tok-number">1</span>;</span>
<span class="line" id="L3575">    <span class="tok-kw">var</span> e_curs :<span class="tok-type">usize</span> = e_posy ;</span>
<span class="line" id="L3576">    <span class="tok-kw">var</span> e_count :<span class="tok-type">usize</span>  = <span class="tok-number">0</span>;</span>
<span class="line" id="L3577">    <span class="tok-kw">const</span> e_nbrcar:<span class="tok-type">usize</span>  = vfld.nbrcar;</span>
<span class="line" id="L3578">    <span class="tok-kw">var</span> statusCursInsert : <span class="tok-type">bool</span> = <span class="tok-null">false</span> ;</span>
<span class="line" id="L3579">    <span class="tok-kw">var</span> nfield :<span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L3580"></span>
<span class="line" id="L3581">    e_FIELD = std.ArrayList([] <span class="tok-kw">const</span> <span class="tok-type">u8</span>).init(allocator);</span>
<span class="line" id="L3582">    e_switch = vfld.zwitch;</span>
<span class="line" id="L3583">    <span class="tok-kw">defer</span> e_FIELD.deinit();</span>
<span class="line" id="L3584">    <span class="tok-kw">const</span> e_reftyp = vfld.reftyp;</span>
<span class="line" id="L3585"></span>
<span class="line" id="L3586">    <span class="tok-kw">var</span> tampon: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L3587"></span>
<span class="line" id="L3588">    <span class="tok-kw">if</span> ( e_posx == <span class="tok-number">0</span>) <span class="tok-kw">return</span> kbd.enter;</span>
<span class="line" id="L3589">    </span>
<span class="line" id="L3590">    vpnl.keyField = kbd.none;</span>
<span class="line" id="L3591"></span>
<span class="line" id="L3592">    <span class="tok-comment">// prepare the switch edition</span>
</span>
<span class="line" id="L3593">    initData(vfld);</span>
<span class="line" id="L3594"></span>
<span class="line" id="L3595">    <span class="tok-kw">var</span> Fkey : term.Keyboard = <span class="tok-null">undefined</span> ;</span>
<span class="line" id="L3596">    <span class="tok-kw">var</span> boucle : <span class="tok-type">bool</span>= <span class="tok-null">true</span> ;</span>
<span class="line" id="L3597"></span>
<span class="line" id="L3598">    term.defCursor(dds.typeCursor.cBlink);</span>
<span class="line" id="L3599"></span>
<span class="line" id="L3600">    term.onMouse();</span>
<span class="line" id="L3601"></span>
<span class="line" id="L3602"></span>
<span class="line" id="L3603">    <span class="tok-comment">//===========================</span>
</span>
<span class="line" id="L3604">    <span class="tok-comment">// boucle saisie</span>
</span>
<span class="line" id="L3605">    <span class="tok-comment">//===========================</span>
</span>
<span class="line" id="L3606">    <span class="tok-kw">while</span>( boucle == <span class="tok-null">true</span>) {</span>
<span class="line" id="L3607">      </span>
<span class="line" id="L3608"></span>
<span class="line" id="L3609">      term.gotoXY(e_posx ,e_posy);</span>
<span class="line" id="L3610">      <span class="tok-kw">switch</span>(e_reftyp) {</span>
<span class="line" id="L3611">        .PASSWORD =&gt;  term.writeStyled(password(e_FIELD),AtrIO) ,</span>
<span class="line" id="L3612">        .SWITCH   =&gt;  <span class="tok-kw">if</span> (e_switch) term.writeStyled(dds.STRUE,AtrIO)</span>
<span class="line" id="L3613">                      <span class="tok-kw">else</span> term.writeStyled(dds.SFALSE,AtrIO),</span>
<span class="line" id="L3614">        <span class="tok-kw">else</span> =&gt; term.writeStyled(utl.listToStr(e_FIELD),AtrIO)</span>
<span class="line" id="L3615">      }</span>
<span class="line" id="L3616"></span>
<span class="line" id="L3617">      term.gotoXY(e_posx,e_curs);</span>
<span class="line" id="L3618"></span>
<span class="line" id="L3619">      <span class="tok-kw">if</span> (statusCursInsert) term.defCursor(dds.typeCursor.cSteadyBar)  </span>
<span class="line" id="L3620">      <span class="tok-kw">else</span> term.defCursor(dds.typeCursor.cBlink); <span class="tok-comment">// CHANGE CURSOR FORM BAR/BLOCK</span>
</span>
<span class="line" id="L3621"></span>
<span class="line" id="L3622">      <span class="tok-kw">switch</span>(e_reftyp) {</span>
<span class="line" id="L3623">        .PASSWORD =&gt; { </span>
<span class="line" id="L3624">                      <span class="tok-kw">if</span> ( std.mem.eql(<span class="tok-type">u8</span>,e_FIELD.items[e_count] , <span class="tok-str">&quot; &quot;</span>)  ) term.writeStyled(<span class="tok-str">&quot; &quot;</span>, AtrCursor)</span>
<span class="line" id="L3625">                      <span class="tok-kw">else</span> term.writeStyled(<span class="tok-str">&quot;*&quot;</span>, AtrCursor);</span>
<span class="line" id="L3626">        },</span>
<span class="line" id="L3627">        <span class="tok-kw">else</span> =&gt;term.writeStyled(e_FIELD.items[e_count], AtrCursor),</span>
<span class="line" id="L3628">      }</span>
<span class="line" id="L3629">      term.gotoXY(e_posx,e_curs);</span>
<span class="line" id="L3630">      term.cursShow();</span>
<span class="line" id="L3631"></span>
<span class="line" id="L3632">      Fkey = kbd.getKEY();</span>
<span class="line" id="L3633"></span>
<span class="line" id="L3634">      term.resetStyle();</span>
<span class="line" id="L3635"></span>
<span class="line" id="L3636">      <span class="tok-kw">if</span> (isfuncKey(vpnl,Fkey)) boucle = <span class="tok-null">false</span></span>
<span class="line" id="L3637">      <span class="tok-kw">else</span> {</span>
<span class="line" id="L3638">        <span class="tok-kw">if</span> (Fkey.Key == kbd.mouse ) {</span>
<span class="line" id="L3639">          Fkey.Key = kbd.none;</span>
<span class="line" id="L3640"></span>
<span class="line" id="L3641">          <span class="tok-kw">if</span> (term.MouseInfo.scroll ) {</span>
<span class="line" id="L3642">              <span class="tok-kw">switch</span> (term.MouseInfo.scrollDir) {</span>
<span class="line" id="L3643">              term.ScrollDirection.msUp =&gt;    Fkey.Key = kbd.up,</span>
<span class="line" id="L3644">              term.ScrollDirection.msDown =&gt;  Fkey.Key = kbd.down,</span>
<span class="line" id="L3645">              <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L3646">              }</span>
<span class="line" id="L3647">          }</span>
<span class="line" id="L3648">          <span class="tok-kw">else</span> {</span>
<span class="line" id="L3649">        </span>
<span class="line" id="L3650">            <span class="tok-kw">if</span> (term.MouseInfo.action == term.MouseAction.maReleased ) <span class="tok-kw">continue</span>;</span>
<span class="line" id="L3651">            </span>
<span class="line" id="L3652">            <span class="tok-kw">if</span> (myMouse) mMouseXY(vpnl);  <span class="tok-comment">// active display Cursor x/y mouse</span>
</span>
<span class="line" id="L3653"></span>
<span class="line" id="L3654">            <span class="tok-kw">switch</span> (term.MouseInfo.button) {</span>
<span class="line" id="L3655">              term.MouseButton.mbLeft    =&gt;  Fkey.Key = kbd.left,</span>
<span class="line" id="L3656"></span>
<span class="line" id="L3657">              term.MouseButton.mbMiddle  =&gt;  Fkey.Key = kbd.enter,</span>
<span class="line" id="L3658"></span>
<span class="line" id="L3659">              term.MouseButton.mbRight   =&gt;  Fkey.Key = kbd.right,</span>
<span class="line" id="L3660">              <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L3661">            }</span>
<span class="line" id="L3662">          }</span>
<span class="line" id="L3663">        }</span>
<span class="line" id="L3664"></span>
<span class="line" id="L3665"></span>
<span class="line" id="L3666"></span>
<span class="line" id="L3667">        <span class="tok-kw">switch</span>(Fkey.Key) {</span>
<span class="line" id="L3668">          .none =&gt; {</span>
<span class="line" id="L3669">                  term.gotoXY(e_posx,e_curs);</span>
<span class="line" id="L3670">          },</span>
<span class="line" id="L3671">          .esc =&gt; {</span>
<span class="line" id="L3672">                  initData(vfld) ;</span>
<span class="line" id="L3673">          }, </span>
<span class="line" id="L3674">          .ctrlH =&gt; {</span>
<span class="line" id="L3675">            <span class="tok-kw">if</span> (  vfld.help.len &gt; <span class="tok-number">0</span> ) msgHelp(vpnl,vfld);</span>
<span class="line" id="L3676">          },</span>
<span class="line" id="L3677">          .home =&gt; {</span>
<span class="line" id="L3678">            e_count = <span class="tok-number">0</span>;</span>
<span class="line" id="L3679">            e_curs = e_posy;</span>
<span class="line" id="L3680">          },</span>
<span class="line" id="L3681">          .end =&gt; {</span>
<span class="line" id="L3682">            tampon  = utl.listToStr(e_FIELD);</span>
<span class="line" id="L3683">            <span class="tok-kw">if</span> ( utl.trimStr(tampon).len &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L3684">              e_count = utl.trimStr(tampon).len - <span class="tok-number">1</span>;</span>
<span class="line" id="L3685">              e_curs  = e_posy + utl.trimStr(tampon).len - <span class="tok-number">1</span>;</span>
<span class="line" id="L3686">            }</span>
<span class="line" id="L3687">            <span class="tok-kw">else</span> {</span>
<span class="line" id="L3688">              e_count = <span class="tok-number">0</span> ;</span>
<span class="line" id="L3689">              e_curs  = e_posy;</span>
<span class="line" id="L3690">            }</span>
<span class="line" id="L3691">          },</span>
<span class="line" id="L3692">          .right , .tab  =&gt; {</span>
<span class="line" id="L3693">            <span class="tok-kw">if</span> ( e_count &lt; e_nbrcar - <span class="tok-number">1</span> <span class="tok-kw">and</span> !isSpace(e_FIELD.items[<span class="tok-number">0</span>])) {</span>
<span class="line" id="L3694">                e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3695">                e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3696">            }</span>
<span class="line" id="L3697">          },</span>
<span class="line" id="L3698">          .left , .stab=&gt; {</span>
<span class="line" id="L3699">            <span class="tok-kw">if</span>( e_curs &gt; e_posy) {</span>
<span class="line" id="L3700">            e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3701">            e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3702">            }</span>
<span class="line" id="L3703">          },</span>
<span class="line" id="L3704">          .backspace =&gt; {</span>
<span class="line" id="L3705">            <span class="tok-kw">if</span>( e_reftyp != dds.REFTYP.SWITCH) {</span>
<span class="line" id="L3706">              delete(e_count);</span>
<span class="line" id="L3707">              tampon  = utl.listToStr(e_FIELD);</span>
<span class="line" id="L3708">              <span class="tok-kw">if</span>( e_count &gt; <span class="tok-number">0</span> ) {</span>
<span class="line" id="L3709">                e_count = utl.trimStr(tampon).len - <span class="tok-number">1</span> ;</span>
<span class="line" id="L3710">                e_curs  = e_posy + e_count;</span>
<span class="line" id="L3711">              }</span>
<span class="line" id="L3712">              <span class="tok-kw">else</span> {e_count = <span class="tok-number">0</span>; e_curs  = e_posy ;}</span>
<span class="line" id="L3713">            }</span>
<span class="line" id="L3714">          },</span>
<span class="line" id="L3715">          .delete=&gt; {</span>
<span class="line" id="L3716">            <span class="tok-kw">if</span>( e_reftyp != dds.REFTYP.SWITCH) {</span>
<span class="line" id="L3717">              <span class="tok-kw">if</span>( e_count &gt;= <span class="tok-number">0</span>) {</span>
<span class="line" id="L3718">                <span class="tok-kw">if</span> (e_reftyp == dds.REFTYP.DIGIT  <span class="tok-kw">and</span> e_count &gt;= <span class="tok-number">0</span> <span class="tok-kw">or</span>  e_reftyp == dds.REFTYP.DECIMAL <span class="tok-kw">and</span> e_count &gt;= <span class="tok-number">0</span> ) {</span>
<span class="line" id="L3719">                    delete(e_count);</span>
<span class="line" id="L3720">                  }</span>
<span class="line" id="L3721">                  <span class="tok-kw">else</span> <span class="tok-kw">if</span> (e_reftyp != dds.REFTYP.DIGIT   <span class="tok-kw">and</span>  e_reftyp != dds.REFTYP.DECIMAL)  {</span>
<span class="line" id="L3722">                          delete(e_count);</span>
<span class="line" id="L3723">                        }</span>
<span class="line" id="L3724">              }</span>
<span class="line" id="L3725">            }</span>
<span class="line" id="L3726">          },</span>
<span class="line" id="L3727">          .ins=&gt; {</span>
<span class="line" id="L3728">            <span class="tok-kw">if</span>( statusCursInsert )  statusCursInsert = <span class="tok-null">false</span></span>
<span class="line" id="L3729">            <span class="tok-kw">else</span> statusCursInsert = <span class="tok-null">true</span>;</span>
<span class="line" id="L3730">          },</span>
<span class="line" id="L3731">          .enter , .up , .down =&gt; {  <span class="tok-comment">// enrg to Field</span>
</span>
<span class="line" id="L3732"></span>
<span class="line" id="L3733">            <span class="tok-comment">//check tofill and field.len &gt; 0</span>
</span>
<span class="line" id="L3734">            <span class="tok-kw">if</span> (vfld.tofill <span class="tok-kw">and</span> utl.trimStr(utl.listToStr(e_FIELD)).len == <span class="tok-number">0</span> ) {</span>
<span class="line" id="L3735">              msgErr(vpnl,vfld,vfld.errmsg);</span>
<span class="line" id="L3736">              e_curs = e_posy;</span>
<span class="line" id="L3737">              e_count = <span class="tok-number">0</span>;</span>
<span class="line" id="L3738">              <span class="tok-kw">continue</span>;</span>
<span class="line" id="L3739">            }</span>
<span class="line" id="L3740"></span>
<span class="line" id="L3741">            <span class="tok-comment">//check tofill and field.len &gt; 0 and regexLen &gt; 0 execute regex</span>
</span>
<span class="line" id="L3742">            <span class="tok-kw">if</span> ( vfld.regex.len &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> vfld.tofill <span class="tok-kw">and</span> utl.trimStr(utl.listToStr(e_FIELD)).len &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L3743">                <span class="tok-kw">if</span> ( ! reg.isMatch(utl.trimStr(utl.listToStr(e_FIELD)) ,vfld.regex) ) {</span>
<span class="line" id="L3744">                  msgErr(vpnl,vfld,vfld.errmsg);</span>
<span class="line" id="L3745">                  e_curs = e_posy;</span>
<span class="line" id="L3746">                  e_count = <span class="tok-number">0</span> ;</span>
<span class="line" id="L3747">                  <span class="tok-kw">continue</span>;</span>
<span class="line" id="L3748">                }</span>
<span class="line" id="L3749">            }</span>
<span class="line" id="L3750"></span>
<span class="line" id="L3751"></span>
<span class="line" id="L3752">            <span class="tok-comment">//write value keyboard to field.text return key</span>
</span>
<span class="line" id="L3753">            nfield = getIndex(vpnl,vfld.name) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3754"></span>
<span class="line" id="L3755">            <span class="tok-kw">if</span> (vfld.reftyp == dds.REFTYP.SWITCH) setSwitch(vpnl, nfield, e_switch ) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span></span>
<span class="line" id="L3756">            </span>
<span class="line" id="L3757">            <span class="tok-kw">else</span> setText(vpnl, nfield, utl.trimStr(utl.listToStr(e_FIELD))) <span class="tok-kw">catch</span> <span class="tok-kw">unreachable</span>;</span>
<span class="line" id="L3758"></span>
<span class="line" id="L3759">            vpnl.keyField = Fkey.Key; </span>
<span class="line" id="L3760">            <span class="tok-comment">// control is task </span>
</span>
<span class="line" id="L3761">            <span class="tok-kw">if</span> ( vfld.proctask.len &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L3762">              Fkey.Key = kbd.task;</span>
<span class="line" id="L3763">              <span class="tok-kw">break</span>; </span>
<span class="line" id="L3764">            }</span>
<span class="line" id="L3765">            </span>
<span class="line" id="L3766"></span>
<span class="line" id="L3767">            <span class="tok-kw">break</span>;          </span>
<span class="line" id="L3768">          },</span>
<span class="line" id="L3769">          .char=&gt; {</span>
<span class="line" id="L3770">            <span class="tok-kw">if</span> (utl.isCarOmit(Fkey.Char) == <span class="tok-null">false</span> ) </span>
<span class="line" id="L3771">              <span class="tok-kw">switch</span>(e_reftyp) {</span>
<span class="line" id="L3772">                .TEXT_FREE=&gt; {</span>
<span class="line" id="L3773">                  <span class="tok-kw">if</span> ( (e_count &lt; e_nbrcar <span class="tok-kw">and</span> isSpace(Fkey.Char) == <span class="tok-null">false</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3774">                    (isSpace(Fkey.Char) == <span class="tok-null">true</span> <span class="tok-kw">and</span> e_count &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> e_count &lt; e_nbrcar) ) {</span>
<span class="line" id="L3775">                    </span>
<span class="line" id="L3776">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3777">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3778"></span>
<span class="line" id="L3779">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3780">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3781">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3782">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3783">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3784">                    }</span>
<span class="line" id="L3785">                    </span>
<span class="line" id="L3786"></span>
<span class="line" id="L3787">                  }</span>
<span class="line" id="L3788">                },</span>
<span class="line" id="L3789">                .TEXT_FULL=&gt; {</span>
<span class="line" id="L3790">                  <span class="tok-kw">if</span> ( (e_count &lt; e_nbrcar <span class="tok-kw">and</span> isSpace(Fkey.Char) == <span class="tok-null">false</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3791">                    (utl.isLetterStr(Fkey.Char) <span class="tok-kw">or</span> utl.isDigitStr(Fkey.Char) <span class="tok-kw">or</span> utl.isSpecialStr(Fkey.Char)) <span class="tok-kw">or</span></span>
<span class="line" id="L3792">                    (isSpace(Fkey.Char) == <span class="tok-null">true</span> <span class="tok-kw">and</span> e_count &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> e_count &lt; e_nbrcar) ) {</span>
<span class="line" id="L3793">                    </span>
<span class="line" id="L3794">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3795">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3796"></span>
<span class="line" id="L3797">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3798">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3799">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3800">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3801">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3802">                    }</span>
<span class="line" id="L3803">                    </span>
<span class="line" id="L3804"></span>
<span class="line" id="L3805">                  }</span>
<span class="line" id="L3806">                },</span>
<span class="line" id="L3807">                .ALPHA, .ALPHA_UPPER =&gt; {</span>
<span class="line" id="L3808">                  <span class="tok-kw">if</span> ( (e_count &lt; e_nbrcar <span class="tok-kw">and</span> isSpace(Fkey.Char) == <span class="tok-null">false</span> ) <span class="tok-kw">and</span></span>
<span class="line" id="L3809">                  (utl.isLetterStr(Fkey.Char) <span class="tok-kw">or</span> std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>)) <span class="tok-kw">or</span></span>
<span class="line" id="L3810">                  (isSpace(Fkey.Char) == <span class="tok-null">true</span> <span class="tok-kw">and</span> e_count &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> e_count &lt; e_nbrcar) ) {</span>
<span class="line" id="L3811">                    </span>
<span class="line" id="L3812">                    <span class="tok-kw">if</span> (vfld.reftyp == .ALPHA_UPPER) Fkey.Char = utl.upperStr(Fkey.Char);</span>
<span class="line" id="L3813"></span>
<span class="line" id="L3814">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3815">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3816"></span>
<span class="line" id="L3817">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3818">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3819">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3820">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3821">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3822">                    }</span>
<span class="line" id="L3823">                  }</span>
<span class="line" id="L3824">                },</span>
<span class="line" id="L3825">                .ALPHA_NUMERIC, .ALPHA_NUMERIC_UPPER =&gt; {</span>
<span class="line" id="L3826">                  <span class="tok-kw">if</span> ( (e_count &lt; e_nbrcar <span class="tok-kw">and</span> isSpace(Fkey.Char) == <span class="tok-null">false</span> ) <span class="tok-kw">and</span></span>
<span class="line" id="L3827">                  (utl.isLetterStr(Fkey.Char) <span class="tok-kw">or</span> utl.isDigitStr(Fkey.Char) <span class="tok-kw">or</span> std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>)) <span class="tok-kw">or</span></span>
<span class="line" id="L3828">                  (isSpace(Fkey.Char) == <span class="tok-null">true</span> <span class="tok-kw">and</span> e_count &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> e_count &lt; e_nbrcar) ) {</span>
<span class="line" id="L3829"></span>
<span class="line" id="L3830">                    <span class="tok-kw">if</span> (vfld.reftyp == .ALPHA_NUMERIC_UPPER) Fkey.Char = utl.upperStr(Fkey.Char);</span>
<span class="line" id="L3831"></span>
<span class="line" id="L3832">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3833">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3834"></span>
<span class="line" id="L3835">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3836">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3837">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3838">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3839">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3840">                    }</span>
<span class="line" id="L3841">                  }</span>
<span class="line" id="L3842">                },</span>
<span class="line" id="L3843">                .PASSWORD =&gt; {</span>
<span class="line" id="L3844">                  <span class="tok-kw">if</span> ( (e_count &lt; e_nbrcar <span class="tok-kw">and</span> isSpace(Fkey.Char) == <span class="tok-null">false</span> ) <span class="tok-kw">and</span></span>
<span class="line" id="L3845">                  (utl.isPassword(Fkey.Char) ) ) {</span>
<span class="line" id="L3846"></span>
<span class="line" id="L3847">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3848">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3849"></span>
<span class="line" id="L3850">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3851">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3852">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3853">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3854">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3855">                    }</span>
<span class="line" id="L3856">                  }</span>
<span class="line" id="L3857">                },</span>
<span class="line" id="L3858">                .YES_NO =&gt; {</span>
<span class="line" id="L3859">                  <span class="tok-kw">if</span> (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;Y&quot;</span>)  <span class="tok-kw">or</span></span>
<span class="line" id="L3860">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;y&quot;</span>)  <span class="tok-kw">or</span> </span>
<span class="line" id="L3861">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;N&quot;</span>)  <span class="tok-kw">or</span> </span>
<span class="line" id="L3862">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;n&quot;</span>)  ) {</span>
<span class="line" id="L3863">                    </span>
<span class="line" id="L3864">                    Fkey.Char = utl.upperStr(Fkey.Char);</span>
<span class="line" id="L3865"></span>
<span class="line" id="L3866">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3867">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3868">                    }</span>
<span class="line" id="L3869">                },</span>
<span class="line" id="L3870">                .UDIGIT =&gt; {</span>
<span class="line" id="L3871">                  <span class="tok-kw">if</span> (e_count &lt; e_nbrcar <span class="tok-kw">and</span> utl.isDigitStr(Fkey.Char)  <span class="tok-kw">and</span> </span>
<span class="line" id="L3872">                    ! std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>) <span class="tok-kw">and</span></span>
<span class="line" id="L3873">                    ! std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;+&quot;</span>)  ) {</span>
<span class="line" id="L3874">                    </span>
<span class="line" id="L3875">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3876">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3877"></span>
<span class="line" id="L3878">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3879">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3880">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3881">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3882">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3883">                    }</span>
<span class="line" id="L3884">                  }</span>
<span class="line" id="L3885">                },</span>
<span class="line" id="L3886">                .DIGIT =&gt; {</span>
<span class="line" id="L3887">                  <span class="tok-kw">if</span> (e_count &lt; e_nbrcar <span class="tok-kw">and</span> utl.isDigitStr(Fkey.Char) <span class="tok-kw">or</span></span>
<span class="line" id="L3888">                    (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">0</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3889">                    (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;+&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">0</span>)) {</span>
<span class="line" id="L3890">                    </span>
<span class="line" id="L3891">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3892">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3893"></span>
<span class="line" id="L3894">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3895">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3896">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3897">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3898">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3899">                    }</span>
<span class="line" id="L3900">                  }</span>
<span class="line" id="L3901">                },</span>
<span class="line" id="L3902">                .UDECIMAL =&gt; {</span>
<span class="line" id="L3903">                  <span class="tok-kw">if</span> (e_count &lt; e_nbrcar <span class="tok-kw">and</span> utl.isDigitStr(Fkey.Char) <span class="tok-kw">or</span> </span>
<span class="line" id="L3904">                    (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;.&quot;</span>) <span class="tok-kw">and</span> e_count &gt; <span class="tok-number">1</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3905">                    !std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>) <span class="tok-kw">and</span> ! std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;+&quot;</span>) ) {</span>
<span class="line" id="L3906"></span>
<span class="line" id="L3907">                    <span class="tok-kw">if</span> (vfld.scal == <span class="tok-number">0</span> <span class="tok-kw">and</span> std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;.&quot;</span>) ) <span class="tok-kw">continue</span> ;</span>
<span class="line" id="L3908">                    </span>
<span class="line" id="L3909"></span>
<span class="line" id="L3910">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3911">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3912"></span>
<span class="line" id="L3913">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3914">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3915">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3916">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3917">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3918">                    }</span>
<span class="line" id="L3919">                    </span>
<span class="line" id="L3920">                  }</span>
<span class="line" id="L3921">                },</span>
<span class="line" id="L3922">                .DECIMAL =&gt; {</span>
<span class="line" id="L3923">                  <span class="tok-kw">if</span> (e_count &lt; e_nbrcar <span class="tok-kw">and</span> utl.isDigitStr(Fkey.Char) <span class="tok-kw">or</span> </span>
<span class="line" id="L3924">                    (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;.&quot;</span>) <span class="tok-kw">and</span> e_count &gt; <span class="tok-number">1</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3925">                    (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">0</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3926">                    (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;+&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">0</span>)) {</span>
<span class="line" id="L3927"></span>
<span class="line" id="L3928">                    <span class="tok-kw">if</span> (vfld.scal == <span class="tok-number">0</span> <span class="tok-kw">and</span> std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;.&quot;</span>) ) <span class="tok-kw">continue</span>;                 </span>
<span class="line" id="L3929"></span>
<span class="line" id="L3930">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3931">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3932"></span>
<span class="line" id="L3933">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3934">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3935">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3936">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3937">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3938">                    }</span>
<span class="line" id="L3939">                    </span>
<span class="line" id="L3940">                  }</span>
<span class="line" id="L3941">                },</span>
<span class="line" id="L3942">                .DATE_ISO =&gt; {</span>
<span class="line" id="L3943">                  <span class="tok-kw">if</span> (e_count &lt; e_nbrcar) {</span>
<span class="line" id="L3944">                    <span class="tok-kw">if</span> (( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count &lt;= <span class="tok-number">3</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3945">                        ( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count == <span class="tok-number">5</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3946">                        ( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count == <span class="tok-number">6</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3947">                        ( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count == <span class="tok-number">8</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3948">                        ( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count == <span class="tok-number">9</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3949">                        (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">4</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3950">                        (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">7</span>) ) {</span>
<span class="line" id="L3951">                    </span>
<span class="line" id="L3952">                      <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3953">                      <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3954"></span>
<span class="line" id="L3955">                      e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3956">                      e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3957">                      <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3958">                        e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3959">                        e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3960">                      }</span>
<span class="line" id="L3961">                    }</span>
<span class="line" id="L3962">                  }</span>
<span class="line" id="L3963">                },</span>
<span class="line" id="L3964">                .DATE_FR , .DATE_US  =&gt; {</span>
<span class="line" id="L3965">                  <span class="tok-kw">if</span> (e_count &lt; e_nbrcar ) {</span>
<span class="line" id="L3966">                    <span class="tok-kw">if</span> (( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count &lt;= <span class="tok-number">1</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3967">                        ( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count == <span class="tok-number">3</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3968">                        ( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count == <span class="tok-number">4</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3969">                        ( utl.isDigitStr(Fkey.Char) <span class="tok-kw">and</span> e_count &gt;= <span class="tok-number">6</span> ) <span class="tok-kw">or</span></span>
<span class="line" id="L3970">                        (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;/&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">2</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3971">                        (std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;/&quot;</span>) <span class="tok-kw">and</span> e_count == <span class="tok-number">5</span>) ) {</span>
<span class="line" id="L3972">                      </span>
<span class="line" id="L3973">                      <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3974">                      <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3975"></span>
<span class="line" id="L3976">                      e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3977">                      e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L3978">                      <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L3979">                        e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3980">                        e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L3981">                      }</span>
<span class="line" id="L3982">                    }</span>
<span class="line" id="L3983">                  }</span>
<span class="line" id="L3984">                },</span>
<span class="line" id="L3985">                .TELEPHONE=&gt; {</span>
<span class="line" id="L3986">                  <span class="tok-kw">if</span> ((e_count &lt; e_nbrcar ) <span class="tok-kw">and</span></span>
<span class="line" id="L3987">                      (utl.isDigitStr(Fkey.Char) <span class="tok-kw">or</span> </span>
<span class="line" id="L3988">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;(&quot;</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3989">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;)&quot;</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3990">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot; &quot;</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3991">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;+&quot;</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3992">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;-&quot;</span>) <span class="tok-kw">or</span></span>
<span class="line" id="L3993">                      std.mem.eql(<span class="tok-type">u8</span>, Fkey.Char, <span class="tok-str">&quot;.&quot;</span>) ) ){</span>
<span class="line" id="L3994">                    </span>
<span class="line" id="L3995">                    <span class="tok-kw">if</span> (statusCursInsert) insert(Fkey.Char,e_count)</span>
<span class="line" id="L3996">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L3997"></span>
<span class="line" id="L3998">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L3999">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L4000">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L4001">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L4002">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L4003">                    }</span>
<span class="line" id="L4004">                  }</span>
<span class="line" id="L4005">                },</span>
<span class="line" id="L4006">                .MAIL_ISO =&gt; {</span>
<span class="line" id="L4007">                  <span class="tok-kw">if</span> (e_count &lt; e_nbrcar <span class="tok-kw">and</span> isSpace(Fkey.Char) == <span class="tok-null">false</span> <span class="tok-kw">and</span> </span>
<span class="line" id="L4008">                    utl.isMailStr(Fkey.Char)) {</span>
<span class="line" id="L4009">                    </span>
<span class="line" id="L4010">                    <span class="tok-kw">if</span> (statusCursInsert <span class="tok-kw">and</span> e_count &lt; e_nbrcar - <span class="tok-number">1</span>) insert(Fkey.Char,e_count)</span>
<span class="line" id="L4011">                    <span class="tok-kw">else</span>  e_FIELD.items[e_count] = Fkey.Char;</span>
<span class="line" id="L4012"></span>
<span class="line" id="L4013">                    e_count += <span class="tok-number">1</span>;</span>
<span class="line" id="L4014">                    e_curs  += <span class="tok-number">1</span>;</span>
<span class="line" id="L4015">                    <span class="tok-kw">if</span> (e_count == e_nbrcar) {</span>
<span class="line" id="L4016">                      e_count -= <span class="tok-number">1</span>;</span>
<span class="line" id="L4017">                      e_curs  -= <span class="tok-number">1</span>;</span>
<span class="line" id="L4018">                    }</span>
<span class="line" id="L4019">                    </span>
<span class="line" id="L4020"></span>
<span class="line" id="L4021">                  }</span>
<span class="line" id="L4022">                },</span>
<span class="line" id="L4023">                .SWITCH =&gt; {</span>
<span class="line" id="L4024">                  <span class="tok-kw">if</span> (isSpace(Fkey.Char)) {</span>
<span class="line" id="L4025">                    </span>
<span class="line" id="L4026">                    <span class="tok-kw">if</span> (e_switch == <span class="tok-null">false</span>) {</span>
<span class="line" id="L4027">                      e_FIELD.items[e_count] = dds.STRUE;</span>
<span class="line" id="L4028">                      e_switch = <span class="tok-null">true</span>;</span>
<span class="line" id="L4029">                    }</span>
<span class="line" id="L4030">                    <span class="tok-kw">else</span> {</span>
<span class="line" id="L4031">                      e_FIELD.items[e_count] = dds.SFALSE;</span>
<span class="line" id="L4032">                      e_switch = <span class="tok-null">false</span>;</span>
<span class="line" id="L4033">                    }</span>
<span class="line" id="L4034">                  }</span>
<span class="line" id="L4035">                },</span>
<span class="line" id="L4036">                .FUNC =&gt; {</span>
<span class="line" id="L4037">                  Fkey.Key =kbd.func;</span>
<span class="line" id="L4038">                  <span class="tok-kw">break</span>;},</span>
<span class="line" id="L4039">                <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L4040">              };</span>
<span class="line" id="L4041">              </span>
<span class="line" id="L4042">          },</span>
<span class="line" id="L4043">          <span class="tok-kw">else</span> =&gt; {},</span>
<span class="line" id="L4044">          </span>
<span class="line" id="L4045">        }</span>
<span class="line" id="L4046">      }</span>
<span class="line" id="L4047">    }</span>
<span class="line" id="L4048"></span>
<span class="line" id="L4049"></span>
<span class="line" id="L4050">    <span class="tok-kw">return</span> Fkey.Key;</span>
<span class="line" id="L4051">  }</span>
<span class="line" id="L4052"></span>
<span class="line" id="L4053">};</span>
<span class="line" id="L4054"></span>
<span class="line" id="L4055"></span>
<span class="line" id="L4056"><span class="tok-comment">// defined Panel</span>
</span>
<span class="line" id="L4057"><span class="tok-kw">pub</span> <span class="tok-kw">const</span>  pnl = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L4058"></span>
<span class="line" id="L4059">  <span class="tok-comment">// define attribut default PANEL</span>
</span>
<span class="line" id="L4060">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> AtrPanel : dds.ZONATRB = .{</span>
<span class="line" id="L4061">      .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.styleDim),</span>
<span class="line" id="L4062">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L4063">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L4064">                    <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L4065">      .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L4066">      .foregr = dds.ForegroundColor.fgWhite</span>
<span class="line" id="L4067">  };</span>
<span class="line" id="L4068"></span>
<span class="line" id="L4069"></span>
<span class="line" id="L4070">  <span class="tok-kw">pub</span> <span class="tok-kw">var</span> MsgErr : dds.ZONATRB = .{</span>
<span class="line" id="L4071">        .styled=[_]<span class="tok-type">u32</span>{<span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L4072">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L4073">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle),</span>
<span class="line" id="L4074">                      <span class="tok-builtin">@enumToInt</span>(dds.Style.notStyle)},</span>
<span class="line" id="L4075">        .backgr = dds.BackgroundColor.bgBlack,</span>
<span class="line" id="L4076">        .foregr = dds.ForegroundColor.fgRed</span>
<span class="line" id="L4077">    };</span>
<span class="line" id="L4078"></span>
<span class="line" id="L4079"></span>
<span class="line" id="L4080"></span>
<span class="line" id="L4081"></span>
<span class="line" id="L4082"></span>
<span class="line" id="L4083">  <span class="tok-comment">/// define PANEL</span></span>
<span class="line" id="L4084">  <span class="tok-kw">pub</span> <span class="tok-kw">const</span> PANEL = <span class="tok-kw">struct</span> {</span>
<span class="line" id="L4085">    name:   [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L4086">    posx:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L4087">    posy:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L4088"></span>
<span class="line" id="L4089">    lines:  <span class="tok-type">usize</span>,</span>
<span class="line" id="L4090">    cols:   <span class="tok-type">usize</span>,</span>
<span class="line" id="L4091"></span>
<span class="line" id="L4092">    attribut: dds.ZONATRB,</span>
<span class="line" id="L4093"></span>
<span class="line" id="L4094">    frame: frm.FRAME ,</span>
<span class="line" id="L4095"></span>
<span class="line" id="L4096">    <span class="tok-comment">//frame: std.ArrayList(frame.FRAME).init(allocator),</span>
</span>
<span class="line" id="L4097"></span>
<span class="line" id="L4098">    label: std.ArrayList(lbl.LABEL),</span>
<span class="line" id="L4099"></span>
<span class="line" id="L4100">    button: std.ArrayList(btn.BUTTON),</span>
<span class="line" id="L4101"></span>
<span class="line" id="L4102">    menu: std.ArrayList(mnu.MENU),</span>
<span class="line" id="L4103"></span>
<span class="line" id="L4104">    grid: std.ArrayList(grd.GRID),</span>
<span class="line" id="L4105"></span>
<span class="line" id="L4106">    field: std.ArrayList(fld.FIELD),</span>
<span class="line" id="L4107"></span>
<span class="line" id="L4108">    linev: std.ArrayList(lnv.LINE),</span>
<span class="line" id="L4109"></span>
<span class="line" id="L4110">    lineh: std.ArrayList(lnh.LINE),</span>
<span class="line" id="L4111"></span>
<span class="line" id="L4112">    <span class="tok-comment">// double buffer screen</span>
</span>
<span class="line" id="L4113">    buf:std.ArrayList(TERMINAL_CHAR),</span>
<span class="line" id="L4114"></span>
<span class="line" id="L4115">    idxfld: <span class="tok-type">usize</span>,</span>
<span class="line" id="L4116"></span>
<span class="line" id="L4117">    key   : kbd ,     <span class="tok-comment">// Func task</span>
</span>
<span class="line" id="L4118"></span>
<span class="line" id="L4119">    keyField : kbd ,  <span class="tok-comment">// enter up down</span>
</span>
<span class="line" id="L4120"></span>
<span class="line" id="L4121">    actif: <span class="tok-type">bool</span></span>
<span class="line" id="L4122">  };</span>
<span class="line" id="L4123"></span>
<span class="line" id="L4124"></span>
<span class="line" id="L4125"></span>
<span class="line" id="L4126">  <span class="tok-kw">fn</span> <span class="tok-fn">newPanel</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L4127">                  vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L4128">                  vlines: <span class="tok-type">usize</span>,</span>
<span class="line" id="L4129">                  vcols: <span class="tok-type">usize</span>,</span>
<span class="line" id="L4130">                  vcadre : dds.CADRE,</span>
<span class="line" id="L4131">                  vtitle: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> ) ErrForms! PANEL {</span>
<span class="line" id="L4132"></span>
<span class="line" id="L4133">    <span class="tok-kw">var</span> xpanel = PANEL {</span>
<span class="line" id="L4134">          .name   = vname,</span>
<span class="line" id="L4135">          .posx   = vposx,</span>
<span class="line" id="L4136">          .posy   = vposy,</span>
<span class="line" id="L4137">          .lines  = vlines,</span>
<span class="line" id="L4138">          .cols   = vcols,</span>
<span class="line" id="L4139">          .attribut = AtrPanel,</span>
<span class="line" id="L4140">          .frame = <span class="tok-null">undefined</span>,</span>
<span class="line" id="L4141">          .label  = std.ArrayList(lbl.LABEL).init(allocator),</span>
<span class="line" id="L4142">          .button = std.ArrayList(btn.BUTTON).init(allocator),</span>
<span class="line" id="L4143">          .menu   = std.ArrayList(mnu.MENU).init(allocator),</span>
<span class="line" id="L4144">          .grid   = std.ArrayList(grd.GRID).init(allocator),</span>
<span class="line" id="L4145">          .field  = std.ArrayList(fld.FIELD).init(allocator),</span>
<span class="line" id="L4146">          .linev  = std.ArrayList(lnv.LINE).init(allocator),</span>
<span class="line" id="L4147">          .lineh  = std.ArrayList(lnh.LINE).init(allocator),</span>
<span class="line" id="L4148">          .buf    = std.ArrayList(TERMINAL_CHAR).init(allocator),</span>
<span class="line" id="L4149">          .idxfld = <span class="tok-number">9999</span>,</span>
<span class="line" id="L4150">          .key    =  kbd.none,</span>
<span class="line" id="L4151">          .keyField = kbd.none,</span>
<span class="line" id="L4152">          .actif  = <span class="tok-null">true</span>,</span>
<span class="line" id="L4153">    };</span>
<span class="line" id="L4154"></span>
<span class="line" id="L4155">    <span class="tok-comment">// INIT doublebuffer</span>
</span>
<span class="line" id="L4156">    <span class="tok-kw">var</span> i:<span class="tok-type">usize</span> = (xpanel.lines+<span class="tok-number">1</span>) * (xpanel.cols+<span class="tok-number">1</span>);</span>
<span class="line" id="L4157">    <span class="tok-kw">var</span> doublebuffer = TERMINAL_CHAR  { .ch =  <span class="tok-str">&quot; &quot;</span>,</span>
<span class="line" id="L4158">                                        .attribut = xpanel.attribut,</span>
<span class="line" id="L4159">                                        .on = <span class="tok-null">false</span>};</span>
<span class="line" id="L4160"></span>
<span class="line" id="L4161">    <span class="tok-comment">// init matrix</span>
</span>
<span class="line" id="L4162">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L4163">        <span class="tok-kw">if</span> (i == <span class="tok-number">0</span>) <span class="tok-kw">break</span> ;</span>
<span class="line" id="L4164">        xpanel.buf.append(doublebuffer) <span class="tok-kw">catch</span> {<span class="tok-kw">return</span> ErrForms.Invalide_Panel;};</span>
<span class="line" id="L4165">        i -=<span class="tok-number">1</span> ;</span>
<span class="line" id="L4166">    }</span>
<span class="line" id="L4167"></span>
<span class="line" id="L4168"></span>
<span class="line" id="L4169">    <span class="tok-comment">// init frame Panel</span>
</span>
<span class="line" id="L4170">    xpanel.frame = frm.newFrame(xpanel.name,</span>
<span class="line" id="L4171">                              <span class="tok-number">1</span> , <span class="tok-number">1</span>,  <span class="tok-comment">// border panel</span>
</span>
<span class="line" id="L4172">                              xpanel.lines, xpanel.cols,</span>
<span class="line" id="L4173">                              vcadre, frm.AtrFrame,</span>
<span class="line" id="L4174">                              vtitle, frm.AtrTitle );</span>
<span class="line" id="L4175"></span>
<span class="line" id="L4176">    <span class="tok-kw">return</span> xpanel;</span>
<span class="line" id="L4177"></span>
<span class="line" id="L4178">  }</span>
<span class="line" id="L4179"></span>
<span class="line" id="L4180">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">initPanel</span>(vname: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>,</span>
<span class="line" id="L4181">                  vposx: <span class="tok-type">usize</span>, vposy: <span class="tok-type">usize</span>,</span>
<span class="line" id="L4182">                  vlines: <span class="tok-type">usize</span>,</span>
<span class="line" id="L4183">                  vcols: <span class="tok-type">usize</span>,</span>
<span class="line" id="L4184">                  vcadre : dds.CADRE,</span>
<span class="line" id="L4185">                  vtitle: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) PANEL {</span>
<span class="line" id="L4186"></span>
<span class="line" id="L4187">      <span class="tok-kw">var</span> result_1 = pnl.newPanel(vname, vposx , vposy ,</span>
<span class="line" id="L4188">                                  vlines , vcols,</span>
<span class="line" id="L4189">                                  vcadre,</span>
<span class="line" id="L4190">                                  vtitle</span>
<span class="line" id="L4191">                                  ) <span class="tok-kw">catch</span>  blk: {</span>
<span class="line" id="L4192">                                      std.debug.print(<span class="tok-str">&quot;newPanel err={}\n&quot;</span>, .{ErrForms.Invalide_Panel});</span>
<span class="line" id="L4193">                                      _= kbd.getKEY(); </span>
<span class="line" id="L4194">                                      <span class="tok-kw">break</span> :blk <span class="tok-null">null</span>;</span>
<span class="line" id="L4195">                                    };</span>
<span class="line" id="L4196"></span>
<span class="line" id="L4197">      <span class="tok-kw">var</span> panel : PANEL = <span class="tok-null">undefined</span>;</span>
<span class="line" id="L4198">      <span class="tok-kw">if</span> (result_1) |xpanel| {</span>
<span class="line" id="L4199">        panel = xpanel;</span>
<span class="line" id="L4200">      }</span>
<span class="line" id="L4201">      <span class="tok-kw">return</span> panel ;</span>
<span class="line" id="L4202">  }</span>
<span class="line" id="L4203"></span>
<span class="line" id="L4204">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getName</span>(vpnl: *PANEL)  [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L4205">    <span class="tok-kw">return</span> vpnl.name;</span>
<span class="line" id="L4206">  }</span>
<span class="line" id="L4207">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosx</span>(vpnl: *PANEL) <span class="tok-type">usize</span> {</span>
<span class="line" id="L4208">    <span class="tok-kw">return</span> vpnl.posx;</span>
<span class="line" id="L4209">  }</span>
<span class="line" id="L4210">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getPosy</span>(vpnl: *PANEL) <span class="tok-type">usize</span> {</span>
<span class="line" id="L4211">    <span class="tok-kw">return</span> vpnl.posy;</span>
<span class="line" id="L4212">  }</span>
<span class="line" id="L4213">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getCols</span>(vpnl: *PANEL) <span class="tok-type">usize</span> {</span>
<span class="line" id="L4214">    <span class="tok-kw">return</span> vpnl.cols;</span>
<span class="line" id="L4215">  }</span>
<span class="line" id="L4216">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getLines</span>(vpnl: *PANEL) <span class="tok-type">usize</span> {</span>
<span class="line" id="L4217">    <span class="tok-kw">return</span> vpnl.lines;</span>
<span class="line" id="L4218">  }</span>
<span class="line" id="L4219">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getTitle</span>(vpnl: *PANEL)  [] <span class="tok-kw">const</span> <span class="tok-type">u8</span> {</span>
<span class="line" id="L4220">    <span class="tok-kw">return</span> vpnl.frame.title;</span>
<span class="line" id="L4221">  }</span>
<span class="line" id="L4222">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getIdxfld</span>(vpnl: *PANEL) <span class="tok-type">usize</span> {</span>
<span class="line" id="L4223">    <span class="tok-kw">return</span> vpnl.idxfld;</span>
<span class="line" id="L4224">  }</span>
<span class="line" id="L4225">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">getActif</span>(vpnl: *PANEL) <span class="tok-type">bool</span> {</span>
<span class="line" id="L4226">    <span class="tok-kw">return</span> vpnl.actif;</span>
<span class="line" id="L4227">  }</span>
<span class="line" id="L4228"></span>
<span class="line" id="L4229">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setIdxfld</span>(vpnl: *PANEL , n :<span class="tok-type">usize</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L4230">    vpnl.idxfld = n ;</span>
<span class="line" id="L4231">  }</span>
<span class="line" id="L4232">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">setActif</span>(vpnl: *PANEL , b :<span class="tok-type">bool</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L4233">    vpnl.items.actif = b ;</span>
<span class="line" id="L4234">  }</span>
<span class="line" id="L4235"></span>
<span class="line" id="L4236"></span>
<span class="line" id="L4237">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">displayPanel</span>(vpnl: *PANEL)  <span class="tok-type">void</span> {</span>
<span class="line" id="L4238">    <span class="tok-comment">// display matrice PANEL</span>
</span>
<span class="line" id="L4239">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span> ;</span>
<span class="line" id="L4240">      <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = <span class="tok-number">1</span>;</span>
<span class="line" id="L4241">      <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4242">      <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4243"></span>
<span class="line" id="L4244">      <span class="tok-kw">while</span> (x &lt;= vpnl.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4245">        y = <span class="tok-number">1</span>;</span>
<span class="line" id="L4246">        <span class="tok-kw">while</span> (y &lt;= vpnl.cols) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4247">          term.gotoXY(x + vpnl.posx - <span class="tok-number">1</span>  , y + vpnl.posy - <span class="tok-number">1</span> );</span>
<span class="line" id="L4248">          term.writeStyled(vpnl.buf.items[n].ch,vpnl.buf.items[n].attribut);</span>
<span class="line" id="L4249">          n += <span class="tok-number">1</span>;</span>
<span class="line" id="L4250">        }</span>
<span class="line" id="L4251">      }</span>
<span class="line" id="L4252">  }</span>
<span class="line" id="L4253"></span>
<span class="line" id="L4254"></span>
<span class="line" id="L4255">  <span class="tok-comment">// clear matrix</span>
</span>
<span class="line" id="L4256">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">clsPanel</span>( vpnl : *PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L4257">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4258">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4259">    <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4260"></span>
<span class="line" id="L4261">    <span class="tok-kw">while</span> (x &lt; vpnl.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4262">        y = <span class="tok-number">1</span>;</span>
<span class="line" id="L4263">        <span class="tok-kw">while</span> (y &lt;= vpnl.cols) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4264">          vpnl.buf.items[n].ch = <span class="tok-str">&quot; &quot;</span>;</span>
<span class="line" id="L4265">          vpnl.buf.items[n].attribut  = vpnl.attribut;</span>
<span class="line" id="L4266">          vpnl.buf.items[n].on = <span class="tok-null">false</span>;</span>
<span class="line" id="L4267">          n += <span class="tok-number">1</span>;</span>
<span class="line" id="L4268">        }</span>
<span class="line" id="L4269">      }</span>
<span class="line" id="L4270">    displayPanel(vpnl);</span>
<span class="line" id="L4271">  }</span>
<span class="line" id="L4272">  </span>
<span class="line" id="L4273">  <span class="tok-comment">// clear Panel</span>
</span>
<span class="line" id="L4274">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">clearPanel</span>( vpnl : *PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L4275"></span>
<span class="line" id="L4276">    vpnl.idxfld =<span class="tok-number">9999</span>;</span>
<span class="line" id="L4277"></span>
<span class="line" id="L4278">    vpnl.keyField =kbd.none;</span>
<span class="line" id="L4279">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L4280">    <span class="tok-kw">for</span> (vpnl.field.items) |_| {</span>
<span class="line" id="L4281">      vpnl.field.items[idx].text =<span class="tok-str">&quot;&quot;</span>;</span>
<span class="line" id="L4282">      vpnl.field.items[idx].zwitch =<span class="tok-null">false</span>;</span>
<span class="line" id="L4283">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L4284">    }</span>
<span class="line" id="L4285">  }</span>
<span class="line" id="L4286">  <span class="tok-comment">// restor -panel  MATRIX to terminal ---&gt; arraylist panel</span>
</span>
<span class="line" id="L4287">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">rstPanel</span>( vsrc : *PANEL , vdst : *PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L4288">    <span class="tok-kw">if</span> (vdst.actif == <span class="tok-null">false</span>)  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L4289">    <span class="tok-kw">if</span> (vsrc.posx + vsrc.lines &gt; vdst.posx + vdst.lines  )  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L4290">    <span class="tok-kw">if</span> (vsrc.posy + vsrc.cols  &gt; vdst.posy + vdst.cols  )  <span class="tok-kw">return</span> ;</span>
<span class="line" id="L4291">    <span class="tok-kw">var</span> x :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4292">    <span class="tok-kw">var</span> y :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4293">    <span class="tok-kw">var</span> n :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4294">    <span class="tok-kw">var</span> npos : <span class="tok-type">usize</span> =  vdst.posx - vsrc.posx;</span>
<span class="line" id="L4295">    </span>
<span class="line" id="L4296">    <span class="tok-kw">while</span> (x &lt; vsrc.lines) : (x += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4297">        n = (vdst.cols * npos) + (vdst.posy - vsrc.posy) ;</span>
<span class="line" id="L4298">        y = <span class="tok-number">0</span>;</span>
<span class="line" id="L4299">        <span class="tok-kw">while</span> (y &lt; vsrc.cols) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4300">          term.gotoXY(x + vsrc.posx   , (y + vsrc.posy) );</span>
<span class="line" id="L4301">          term.writeStyled(vdst.buf.items[n].ch,vdst.buf.items[n].attribut);</span>
<span class="line" id="L4302">          n += <span class="tok-number">1</span>;</span>
<span class="line" id="L4303">        }</span>
<span class="line" id="L4304">      npos += <span class="tok-number">1</span>;</span>
<span class="line" id="L4305">    }</span>
<span class="line" id="L4306">  }</span>
<span class="line" id="L4307"></span>
<span class="line" id="L4308">  <span class="tok-comment">/// print PANEL</span></span>
<span class="line" id="L4309">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">printPanel</span>  (vpnl: *PANEL) <span class="tok-type">void</span> {</span>
<span class="line" id="L4310">    <span class="tok-kw">if</span> ( vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span>; </span>
<span class="line" id="L4311"></span>
<span class="line" id="L4312">    <span class="tok-comment">// assigne PANEL and all OBJECT to matrix for display</span>
</span>
<span class="line" id="L4313"></span>
<span class="line" id="L4314">    <span class="tok-comment">// cursor HIDE par défault</span>
</span>
<span class="line" id="L4315">    term.cursHide();</span>
<span class="line" id="L4316"></span>
<span class="line" id="L4317">    <span class="tok-comment">// clear matrix</span>
</span>
<span class="line" id="L4318">    clsPanel(vpnl);</span>
<span class="line" id="L4319"></span>
<span class="line" id="L4320">    <span class="tok-comment">// FRAME (window panel)</span>
</span>
<span class="line" id="L4321">    frm.printFrame(vpnl,vpnl.frame);</span>
<span class="line" id="L4322"></span>
<span class="line" id="L4323">    <span class="tok-comment">// LABEL</span>
</span>
<span class="line" id="L4324">    <span class="tok-kw">for</span> (vpnl.label.items) |lblprt| {</span>
<span class="line" id="L4325">      <span class="tok-kw">if</span> (lblprt.actif) lbl.printLabel(vpnl, lblprt);</span>
<span class="line" id="L4326">    }</span>
<span class="line" id="L4327"></span>
<span class="line" id="L4328">    <span class="tok-comment">// FIELD</span>
</span>
<span class="line" id="L4329">    <span class="tok-kw">for</span> (vpnl.field.items) |fldprt| {</span>
<span class="line" id="L4330">      <span class="tok-kw">if</span> (fldprt.actif) fld.printField(vpnl, fldprt);</span>
<span class="line" id="L4331">    }</span>
<span class="line" id="L4332"></span>
<span class="line" id="L4333">    <span class="tok-comment">// BUTTON</span>
</span>
<span class="line" id="L4334">    <span class="tok-kw">if</span> (vpnl.button.items.len &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L4335"></span>
<span class="line" id="L4336">      btn.printButton(vpnl);</span>
<span class="line" id="L4337">    }</span>
<span class="line" id="L4338">    </span>
<span class="line" id="L4339">    <span class="tok-comment">// LINE Vertical</span>
</span>
<span class="line" id="L4340">    <span class="tok-kw">for</span> (vpnl.linev.items) |lnvprt| {</span>
<span class="line" id="L4341">      <span class="tok-kw">if</span> (lnvprt.actif) lnv.printLine(vpnl, lnvprt);</span>
<span class="line" id="L4342">    }</span>
<span class="line" id="L4343">        </span>
<span class="line" id="L4344">    <span class="tok-comment">// LINE Horizontal</span>
</span>
<span class="line" id="L4345">    <span class="tok-kw">for</span> (vpnl.lineh.items) |lnhprt| {</span>
<span class="line" id="L4346">      <span class="tok-kw">if</span> (lnhprt.actif) lnh.printLine(vpnl, lnhprt);</span>
<span class="line" id="L4347">    }</span>
<span class="line" id="L4348"></span>
<span class="line" id="L4349"></span>
<span class="line" id="L4350"></span>
<span class="line" id="L4351">    displayPanel(vpnl);</span>
<span class="line" id="L4352">    term.flushIO();</span>
<span class="line" id="L4353">  }</span>
<span class="line" id="L4354"></span>
<span class="line" id="L4355">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">msgErr</span>(vpnl: *PANEL, info: [] <span class="tok-kw">const</span> <span class="tok-type">u8</span>) <span class="tok-type">void</span> {</span>
<span class="line" id="L4356"></span>
<span class="line" id="L4357">    <span class="tok-kw">var</span> x: <span class="tok-type">usize</span>  = vpnl.lines;</span>
<span class="line" id="L4358">    <span class="tok-kw">var</span> n: <span class="tok-type">usize</span>  = vpnl.cols * (x - <span class="tok-number">2</span>) ;</span>
<span class="line" id="L4359">    <span class="tok-kw">var</span> y: <span class="tok-type">usize</span>  = <span class="tok-number">1</span> ;</span>
<span class="line" id="L4360"></span>
<span class="line" id="L4361"></span>
<span class="line" id="L4362">    <span class="tok-kw">var</span> msgerr:[]<span class="tok-kw">const</span> <span class="tok-type">u8</span> = utl.concatStr(<span class="tok-str">&quot;Info : &quot;</span>, info);</span>
<span class="line" id="L4363"></span>
<span class="line" id="L4364">    <span class="tok-kw">if</span> (vpnl.cols &lt; (msgerr.len) )  msgerr = utl.subStr(msgerr, <span class="tok-number">0</span>, vpnl.cols - <span class="tok-number">2</span>) <span class="tok-kw">catch</span> |err| {dsperr.errorForms(err); <span class="tok-kw">return</span>;};</span>
<span class="line" id="L4365"></span>
<span class="line" id="L4366"></span>
<span class="line" id="L4367">    <span class="tok-kw">while</span> (y &lt;= (vpnl.cols - <span class="tok-number">2</span>) ) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4368">      term.gotoXY(vpnl.posx + x  - <span class="tok-number">2</span>  , y + vpnl.posy  );</span>
<span class="line" id="L4369">      term.writeStyled(<span class="tok-str">&quot; &quot;</span>,vpnl.attribut);</span>
<span class="line" id="L4370">    }</span>
<span class="line" id="L4371">    y = <span class="tok-number">1</span> ;</span>
<span class="line" id="L4372">    term.gotoXY(vpnl.posx + x  - <span class="tok-number">2</span> , y + vpnl.posy   );</span>
<span class="line" id="L4373">    term.writeStyled(msgerr,MsgErr);</span>
<span class="line" id="L4374"></span>
<span class="line" id="L4375">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L4376">      <span class="tok-kw">var</span> e_key = kbd.getKEY();</span>
<span class="line" id="L4377">      <span class="tok-kw">switch</span> ( e_key.Key ) {</span>
<span class="line" id="L4378">        .esc =&gt; <span class="tok-kw">break</span>,</span>
<span class="line" id="L4379">      <span class="tok-kw">else</span> =&gt;  {},</span>
<span class="line" id="L4380">      }</span>
<span class="line" id="L4381">    }</span>
<span class="line" id="L4382"></span>
<span class="line" id="L4383"></span>
<span class="line" id="L4384">    <span class="tok-kw">while</span> (y &lt;= (vpnl.cols - <span class="tok-number">2</span>)) : (y += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4385">      n += <span class="tok-number">1</span>;</span>
<span class="line" id="L4386">      term.gotoXY(vpnl.posx + x  - <span class="tok-number">2</span>, y + vpnl.posy  );</span>
<span class="line" id="L4387">      term.writeStyled(vpnl.buf.items[n].ch,vpnl.buf.items[n].attribut);</span>
<span class="line" id="L4388">    }</span>
<span class="line" id="L4389">    </span>
<span class="line" id="L4390">  }</span>
<span class="line" id="L4391"></span>
<span class="line" id="L4392">  <span class="tok-comment">/// Check if it is a KEY function</span></span>
<span class="line" id="L4393">  <span class="tok-kw">fn</span> <span class="tok-fn">isPanelKey</span>(vpnl:  *PANEL, e_key: kbd) <span class="tok-type">bool</span> {</span>
<span class="line" id="L4394">    <span class="tok-kw">for</span> ( vpnl.button.items) |xbtn| {</span>
<span class="line" id="L4395">    <span class="tok-kw">if</span> (xbtn.key == e_key ) <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L4396">    }</span>
<span class="line" id="L4397">    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L4398">  }</span>
<span class="line" id="L4399"></span>
<span class="line" id="L4400">  <span class="tok-comment">/// if it is a KEY function Check</span></span>
<span class="line" id="L4401">  <span class="tok-kw">fn</span> <span class="tok-fn">isPanelCtrl</span>( vpnl: *PANEL, e_key: kbd)  <span class="tok-type">bool</span> {</span>
<span class="line" id="L4402">    <span class="tok-kw">for</span> ( vpnl.button.items) |xbtn| {</span>
<span class="line" id="L4403">    <span class="tok-kw">if</span> ( xbtn.check <span class="tok-kw">and</span> xbtn.key == e_key ) <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L4404">    }</span>
<span class="line" id="L4405">    <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L4406">  }</span>
<span class="line" id="L4407"></span>
<span class="line" id="L4408">  <span class="tok-comment">///search there available field</span></span>
<span class="line" id="L4409">  <span class="tok-kw">fn</span> <span class="tok-fn">isNextIO</span>(vpnl: *PANEL, idx : <span class="tok-type">usize</span> ) <span class="tok-type">usize</span> {</span>
<span class="line" id="L4410">    <span class="tok-kw">var</span> i : <span class="tok-type">usize</span> = idx + <span class="tok-number">1</span>;</span>
<span class="line" id="L4411">    <span class="tok-kw">while</span> ( i &lt; vpnl.field.items.len) : (i += <span class="tok-number">1</span>) {</span>
<span class="line" id="L4412">      <span class="tok-kw">if</span> (vpnl.field.items[i].actif)</span>
<span class="line" id="L4413">        <span class="tok-kw">if</span> (!vpnl.field.items[i].protect ) <span class="tok-kw">break</span> ;</span>
<span class="line" id="L4414">    }</span>
<span class="line" id="L4415">    <span class="tok-kw">return</span> i;</span>
<span class="line" id="L4416">  }</span>
<span class="line" id="L4417"></span>
<span class="line" id="L4418">  <span class="tok-comment">///search there available field</span></span>
<span class="line" id="L4419">  <span class="tok-kw">fn</span> <span class="tok-fn">isPriorIO</span>(vpnl: *PANEL, idx : <span class="tok-type">usize</span>) <span class="tok-type">usize</span> {</span>
<span class="line" id="L4420">    <span class="tok-kw">var</span> i : <span class="tok-type">usize</span> = idx - <span class="tok-number">1</span>;</span>
<span class="line" id="L4421">    <span class="tok-kw">if</span> ( i &lt; <span class="tok-number">0</span>) i = <span class="tok-number">0</span>;</span>
<span class="line" id="L4422">    <span class="tok-kw">while</span> ( i &gt; <span class="tok-number">0</span> ) : (i -= <span class="tok-number">1</span>) {</span>
<span class="line" id="L4423">      <span class="tok-kw">if</span> (vpnl.field.items[i].actif)</span>
<span class="line" id="L4424">        <span class="tok-kw">if</span> (!vpnl.field.items[i].protect ) <span class="tok-kw">break</span> ;</span>
<span class="line" id="L4425">    }</span>
<span class="line" id="L4426">    <span class="tok-kw">return</span> i;</span>
<span class="line" id="L4427">  }</span>
<span class="line" id="L4428"></span>
<span class="line" id="L4429"></span>
<span class="line" id="L4430">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">isValide</span>(vpnl: *PANEL) <span class="tok-type">bool</span> {</span>
<span class="line" id="L4431">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span>  <span class="tok-null">false</span> ;</span>
<span class="line" id="L4432"></span>
<span class="line" id="L4433">    <span class="tok-comment">// recherche erreur</span>
</span>
<span class="line" id="L4434">    <span class="tok-kw">var</span> idx : <span class="tok-type">usize</span> = <span class="tok-number">0</span> ;</span>
<span class="line" id="L4435">    <span class="tok-kw">for</span> (vpnl.field.items) |f| {</span>
<span class="line" id="L4436">      <span class="tok-kw">if</span> ( !f.protect <span class="tok-kw">and</span> f.actif) {</span>
<span class="line" id="L4437">        <span class="tok-comment">//check tofill and field.len &gt; 0</span>
</span>
<span class="line" id="L4438">        <span class="tok-kw">if</span> (f.tofill <span class="tok-kw">and</span> utl.trimStr(f.text).len == <span class="tok-number">0</span> ) {</span>
<span class="line" id="L4439">            vpnl.idxfld = idx;</span>
<span class="line" id="L4440">            <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L4441">        }</span>
<span class="line" id="L4442">        <span class="tok-comment">//check tofill and field.len &gt; 0 and regexLen &gt; 0 execute regex</span>
</span>
<span class="line" id="L4443">        <span class="tok-kw">if</span> ( f.regex.len &gt; <span class="tok-number">0</span> <span class="tok-kw">and</span> f.tofill <span class="tok-kw">and</span> utl.trimStr(f.text).len &gt; <span class="tok-number">0</span>) {</span>
<span class="line" id="L4444">            <span class="tok-kw">if</span> ( !reg.isMatch(utl.trimStr(f.text) ,f.regex)) {</span>
<span class="line" id="L4445">              vpnl.idxfld = idx;</span>
<span class="line" id="L4446">              <span class="tok-kw">return</span> <span class="tok-null">false</span>;</span>
<span class="line" id="L4447">            }</span>
<span class="line" id="L4448">        }</span>
<span class="line" id="L4449">        <span class="tok-comment">// function call proctask            </span>
</span>
<span class="line" id="L4450">      }</span>
<span class="line" id="L4451">      idx += <span class="tok-number">1</span>;</span>
<span class="line" id="L4452">    }</span>
<span class="line" id="L4453">    vpnl.idxfld = <span class="tok-number">0</span>;</span>
<span class="line" id="L4454">    <span class="tok-kw">return</span> <span class="tok-null">true</span>;</span>
<span class="line" id="L4455"></span>
<span class="line" id="L4456">  }</span>
<span class="line" id="L4457"></span>
<span class="line" id="L4458">  <span class="tok-comment">///------------------------------------------------------</span></span>
<span class="line" id="L4459">  <span class="tok-comment">/// Format management including zones</span></span>
<span class="line" id="L4460">  <span class="tok-comment">/// idxfld == 9999 print panel else position field</span></span>
<span class="line" id="L4461">  <span class="tok-comment">/// keyboard proction keys are returned to the calling procedure</span></span>
<span class="line" id="L4462">  <span class="tok-comment">///</span></span>
<span class="line" id="L4463">  <span class="tok-comment">/// only the key CtrlH = Aide / Help for field</span></span>
<span class="line" id="L4464">  <span class="tok-comment">///</span></span>
<span class="line" id="L4465">  <span class="tok-comment">/// Reserved keys for FIELD management</span></span>
<span class="line" id="L4466">  <span class="tok-comment">/// traditionally  UP, DOWN, TAB, STAB, CtrlA,</span></span>
<span class="line" id="L4467">  <span class="tok-comment">/// ENTER, HOME, END, RIGTH, LEFt, BACKSPACE, DELETE, INSERT</span></span>
<span class="line" id="L4468">  <span class="tok-comment">/// FUNC Triggered by ioField function</span></span>
<span class="line" id="L4469">  <span class="tok-comment">/// predefined and customizable REGEX control</span></span>
<span class="line" id="L4470">  <span class="tok-comment">/// CALL to be planned in the future with  call execve job</span></span>
<span class="line" id="L4471">  <span class="tok-comment">/// ATTN to be planned in the future with thread job</span></span>
<span class="line" id="L4472">  <span class="tok-comment">///------------------------------------------------------</span></span>
<span class="line" id="L4473">  <span class="tok-kw">pub</span> <span class="tok-kw">fn</span> <span class="tok-fn">ioPanel</span>(vpnl: *PANEL) kbd {</span>
<span class="line" id="L4474">    <span class="tok-kw">if</span> (vpnl.actif == <span class="tok-null">false</span> ) <span class="tok-kw">return</span>  kbd.none;</span>
<span class="line" id="L4475"></span>
<span class="line" id="L4476">    <span class="tok-kw">var</span> nField :<span class="tok-type">usize</span> = <span class="tok-number">0</span>;</span>
<span class="line" id="L4477">    <span class="tok-kw">var</span> fld_key : kbd =  kbd.enter;</span>
<span class="line" id="L4478">    <span class="tok-kw">var</span> nbrFieldIO : <span class="tok-type">usize</span> = vpnl.field.items.len;</span>
<span class="line" id="L4479"></span>
<span class="line" id="L4480"></span>
<span class="line" id="L4481">    <span class="tok-kw">if</span> ( vpnl.idxfld == <span class="tok-number">9999</span>) {</span>
<span class="line" id="L4482">        printPanel(vpnl); </span>
<span class="line" id="L4483">        nField = <span class="tok-number">0</span>;</span>
<span class="line" id="L4484">    } <span class="tok-kw">else</span> {</span>
<span class="line" id="L4485"></span>
<span class="line" id="L4486">      <span class="tok-kw">switch</span>(vpnl.key ) { </span>
<span class="line" id="L4487">        .func =&gt; nField = vpnl.idxfld,</span>
<span class="line" id="L4488">        .task =&gt; {</span>
<span class="line" id="L4489">              nField = vpnl.idxfld;</span>
<span class="line" id="L4490">              <span class="tok-kw">switch</span>(vpnl.keyField) {</span>
<span class="line" id="L4491">                .enter =&gt; {</span>
<span class="line" id="L4492">                  <span class="tok-kw">if</span> ( nField + <span class="tok-number">1</span> &gt; nbrFieldIO - <span class="tok-number">1</span> ) nField = <span class="tok-number">0</span></span>
<span class="line" id="L4493">                  <span class="tok-kw">else</span> nField= isNextIO(vpnl,nField);</span>
<span class="line" id="L4494">                  vpnl.idxfld = nField;</span>
<span class="line" id="L4495">                },</span>
<span class="line" id="L4496">                .up  =&gt; {</span>
<span class="line" id="L4497">                  <span class="tok-kw">if</span> (nField == <span class="tok-number">0</span>) nField = nbrFieldIO - <span class="tok-number">1</span></span>
<span class="line" id="L4498">                  <span class="tok-kw">else</span> nField= isPriorIO(vpnl,nField);</span>
<span class="line" id="L4499">                  vpnl.idxfld = nField;</span>
<span class="line" id="L4500">                },</span>
<span class="line" id="L4501">                .down  =&gt; {</span>
<span class="line" id="L4502">                  <span class="tok-kw">if</span> (nField  + <span class="tok-number">1</span> &gt; nbrFieldIO - <span class="tok-number">1</span>) nField = <span class="tok-number">0</span></span>
<span class="line" id="L4503">                  <span class="tok-kw">else</span> nField= isNextIO(vpnl,nField);</span>
<span class="line" id="L4504">                  vpnl.idxfld = nField;</span>
<span class="line" id="L4505">                },</span>
<span class="line" id="L4506">                <span class="tok-kw">else</span> =&gt; nField = vpnl.idxfld,</span>
<span class="line" id="L4507">              }</span>
<span class="line" id="L4508">            },</span>
<span class="line" id="L4509">        <span class="tok-kw">else</span> =&gt; nField = vpnl.idxfld,    </span>
<span class="line" id="L4510">      }</span>
<span class="line" id="L4511">    }</span>
<span class="line" id="L4512"></span>
<span class="line" id="L4513">    vpnl.keyField = kbd.none; </span>
<span class="line" id="L4514">    </span>
<span class="line" id="L4515"></span>
<span class="line" id="L4516">    <span class="tok-kw">while</span> (<span class="tok-null">true</span>) {</span>
<span class="line" id="L4517"></span>
<span class="line" id="L4518">      <span class="tok-kw">if</span> (nbrFieldIO == <span class="tok-number">0</span>)  {</span>
<span class="line" id="L4519">        <span class="tok-kw">var</span> vKey= kbd.getKEY();</span>
<span class="line" id="L4520">        <span class="tok-kw">if</span> (isPanelKey(vpnl,vKey.Key)) {</span>
<span class="line" id="L4521">          vpnl.idxfld = <span class="tok-number">9999</span>;</span>
<span class="line" id="L4522">          <span class="tok-kw">return</span> vKey.Key;</span>
<span class="line" id="L4523">        }</span>
<span class="line" id="L4524">        <span class="tok-kw">continue</span> ;</span>
<span class="line" id="L4525">      }</span>
<span class="line" id="L4526">      <span class="tok-kw">else</span> </span>
<span class="line" id="L4527">        <span class="tok-kw">if</span> ( !vpnl.field.items[nField ].protect <span class="tok-kw">and</span> vpnl.field.items[nField ].actif) {</span>
<span class="line" id="L4528"></span>
<span class="line" id="L4529">          fld.printField(vpnl,vpnl.field.items[nField ]);</span>
<span class="line" id="L4530">          fld.displayField(vpnl,vpnl.field.items[nField ]);</span>
<span class="line" id="L4531"></span>
<span class="line" id="L4532">          fld_key = fld.ioField(vpnl,vpnl.field.items[nField ]);</span>
<span class="line" id="L4533"></span>
<span class="line" id="L4534">          fld.printField(vpnl,vpnl.field.items[nField ]);</span>
<span class="line" id="L4535">          fld.displayField(vpnl,vpnl.field.items[nField ]);</span>
<span class="line" id="L4536">        </span>
<span class="line" id="L4537">          vpnl.key = kbd.none;</span>
<span class="line" id="L4538"></span>
<span class="line" id="L4539">          <span class="tok-comment">// function call procfunc            </span>
</span>
<span class="line" id="L4540">          <span class="tok-kw">if</span> (fld_key == kbd.func ) {</span>
<span class="line" id="L4541">            vpnl.idxfld = nField;</span>
<span class="line" id="L4542">            vpnl.key = kbd.func;</span>
<span class="line" id="L4543">            <span class="tok-kw">return</span> fld_key;</span>
<span class="line" id="L4544">          }</span>
<span class="line" id="L4545">          <span class="tok-comment">// function call proctask            </span>
</span>
<span class="line" id="L4546">          <span class="tok-kw">if</span> (fld_key == kbd.task) {</span>
<span class="line" id="L4547">            vpnl.idxfld = nField;</span>
<span class="line" id="L4548">            vpnl.key = kbd.task;</span>
<span class="line" id="L4549">            <span class="tok-kw">return</span> fld_key;</span>
<span class="line" id="L4550">          }</span>
<span class="line" id="L4551"></span>
<span class="line" id="L4552"></span>
<span class="line" id="L4553">          </span>
<span class="line" id="L4554"></span>
<span class="line" id="L4555">          </span>
<span class="line" id="L4556">          <span class="tok-comment">// control validity</span>
</span>
<span class="line" id="L4557">          <span class="tok-kw">if</span> (isPanelKey(vpnl,fld_key )) {</span>
<span class="line" id="L4558">            <span class="tok-kw">if</span> (!isPanelCtrl(vpnl,fld_key)){</span>
<span class="line" id="L4559">                vpnl.idxfld = nField ;</span>
<span class="line" id="L4560">                <span class="tok-kw">return</span> fld_key;</span>
<span class="line" id="L4561">              }</span>
<span class="line" id="L4562">            <span class="tok-kw">else</span> {</span>
<span class="line" id="L4563">              <span class="tok-kw">if</span> (isValide(vpnl)) {</span>
<span class="line" id="L4564">                <span class="tok-kw">return</span> fld_key;</span>
<span class="line" id="L4565">              }</span>
<span class="line" id="L4566">              <span class="tok-kw">else</span> { </span>
<span class="line" id="L4567">                msgErr(vpnl,<span class="tok-str">&quot;Format invalide&quot;</span>);</span>
<span class="line" id="L4568">                nField = vpnl.idxfld ;</span>
<span class="line" id="L4569">                fld_key = kbd.none ;</span>
<span class="line" id="L4570">              }</span>
<span class="line" id="L4571">            }</span>
<span class="line" id="L4572"></span>
<span class="line" id="L4573">          }</span>
<span class="line" id="L4574">        }</span>
<span class="line" id="L4575"></span>
<span class="line" id="L4576">      <span class="tok-kw">switch</span>(fld_key) {</span>
<span class="line" id="L4577">        .enter  =&gt; {</span>
<span class="line" id="L4578">          <span class="tok-kw">if</span> ( nField + <span class="tok-number">1</span> &gt; nbrFieldIO - <span class="tok-number">1</span> ) nField = <span class="tok-number">0</span></span>
<span class="line" id="L4579">          <span class="tok-kw">else</span> nField= isNextIO(vpnl,nField);</span>
<span class="line" id="L4580">          vpnl.idxfld = nField;</span>
<span class="line" id="L4581">        },</span>
<span class="line" id="L4582">        .up  =&gt; {</span>
<span class="line" id="L4583">          <span class="tok-kw">if</span> (nField == <span class="tok-number">0</span>) nField = nbrFieldIO - <span class="tok-number">1</span></span>
<span class="line" id="L4584">          <span class="tok-kw">else</span> nField= isPriorIO(vpnl,nField);</span>
<span class="line" id="L4585">          vpnl.idxfld = nField;</span>
<span class="line" id="L4586">        },</span>
<span class="line" id="L4587">        .down  =&gt; {</span>
<span class="line" id="L4588">          <span class="tok-kw">if</span> (nField  + <span class="tok-number">1</span> &gt; nbrFieldIO - <span class="tok-number">1</span>) nField = <span class="tok-number">0</span></span>
<span class="line" id="L4589">          <span class="tok-kw">else</span> nField= isNextIO(vpnl,nField);</span>
<span class="line" id="L4590">          vpnl.idxfld = nField;</span>
<span class="line" id="L4591">        },</span>
<span class="line" id="L4592">        <span class="tok-kw">else</span> =&gt; {}</span>
<span class="line" id="L4593"></span>
<span class="line" id="L4594">      }</span>
<span class="line" id="L4595">    }</span>
<span class="line" id="L4596">  }                  </span>
<span class="line" id="L4597"></span>
<span class="line" id="L4598">};</span>
<span class="line" id="L4599"></span>
</code></pre></body>
</html>